var pageManager=function(){"use strict";var t="",i="",r="",u="",f="",n=!1,s=function(){l();h()},h=function(){$("#btnSearchAll").click(function(e){e.preventDefault();t=$("#Buyer").val();i=$("#ChassisN").val();r=commonManger.dateFormat($("#From").val());u=commonManger.dateFormat($("#To").val());f=$("#ClientID").val();n=$(".buyerGrouping").is(":checked");o()});$("#CreateReceiptPayment").on("show.bs.modal",function(){var n=0,t=0,i=0,r=null,u=[];$('input[name="payReceipt"]').each(function(){n+=parseFloat($(this).val());u.push($(this).attr("data-id"));i++;var f=$(this).attr("data-buyer");f!==r&&(t++,r=f)});$("#IDs").val(u.join(","));$("#noCars").val(i);$("#noBuyers").val(t);$("#totalAmount").val(n);e()});$("#Fines").on("blur change keyup",function(){e()});$("#CreateReceiptPayment .modal-footer .btn-success").click(function(n){n.preventDefault();var i=$("#IDs").val(),t=$("#totalAmountDhs").val();t>0?window.location.href="ReceiptPaymentsAdd.aspx?pamount="+t+"&ids="+i:$(".modal").modal("hide")});$("#cancelModal .modal-footer .btn-danger").on("click",function(n){var r,u;n.preventDefault();var t=$("#cancelCarID").val(),i=$("#cancelNotes").val(),f=function(n){n=n.d;$("div[id$=Modal].modal").modal("hide");commonManger.showMessage("تم تنفيذ الإجراء:",n.message);n.Status&&o()};t&&i!=""?(r="aspnetForm",u={actionName:"CarsData_Delete",names:["CarID","Reason"],values:[t,i]},commonManger.doWork("cancelModal",r,sUrl+"saveData",u,f,commonManger.errorException)):(commonManger.showMessage("بيانات مطلوبة","يرجي التحقق من رقم السيارة وسبب الحذف أولاً."),$("#cancelNotes").focus())})},e=function(){var n=$("#totalAmount").val(),t=$("#noBuyers").val(),i=$("#Fines").val(),r=$("#commission").val(),u=(parseFloat(n)+parseFloat(i))*3.674+parseInt(t)*parseFloat(r);$("#totalAmountDhs").val(u.toFixed())},o=function(){$("#listItems").DataTable().draw()},a=function(n){return"?"+Object.keys(n).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(n[t])}).join("&")},c=function(){$(".ace-tooltip").tooltip()},l=function(){var e=$("#listItems").DataTable({sDom:"<'row-fluid'<'span6'l><'span6 lft-pane'BT>r>t<'row-fluid'<'span6'i><'span6'p>>",buttons:[{extend:"csv",text:"تصدير إكسيل"},{extend:"copy",text:"نسـخ"},{text:"طباعة",action:function(){$(".dataTables_length,.form-horizontal").closest("div.row-fluid").addClass("hidden-print");window.print()}}],serverSide:!0,processing:!0,stateSave:!0,deferRender:!0,responsive:!0,bRetrieve:!1,bDestroy:!0,sAjaxSource:sUrl+"LoadDataTablesXML",fnServerParams:function(n){n.push({name:"funName",value:"InvoicePay_DeletedList"},{name:"names",value:"Buyer~Chassis~From~To~ClientID"},{name:"values",value:t+"~"+i+"~"+r+"~"+u+"~"+f})},fnServerData:function(n,t,i){dataService.callAjax("GET",t,n,function(n){var f=commonManger.comp2json(n.d),u=f.list,r=f.list1,e;r=r?$.map(r,function(n){return n}):[0];e={sEcho:t.sEcho?t.sEcho:0,iTotalRecords:r[0],iTotalDisplayRecords:r[0],aaData:$.isArray(u)?u:$.makeArray(u)};i(e);r&&$(".sum-total-all").text(numeral(r[1]).format("0,0"));c()},commonManger.errorException)},drawCallback:function(){if(n){var t=this.api(),r=t.rows({page:"current"}).nodes(),i=null;t.column(1,{page:"current"}).data().each(function(n,t){i!==n&&($(r).eq(t).before('<tr class="alert alert-success"><td colspan="100%" title="رقم الباير واسم المزاد"><strong>رقم الباير: <\/strong>'+n+"<\/td><\/tr>"),i=n)})}},fnRowCallback:function(n,t){t.PayInvTypeID===3&&$(n).addClass("car-relist")},fnFooterCallback:function(n,t){for(var r=0,i=0;i<t.length;i++)r+=t[i].PayPrice*1;$(n).find("th:eq(1)").html(numeral(r).format("0,0.00"))},iDisplayLength:50,aaSorting:[],aoColumns:[{mDataProp:"MainPicture",bSortable:!1,render:function(n,t,i){return'<a title="صور السيارة رقم: '+i.CarID+'" href="images.aspx?id='+i.CarID+'">'+(i.MainPicture&&i.MainPicture!==null?'<img alt="car" src="/public/cars/'+i.CarID+"/_thumb/"+i.MainPicture+'" />':'<img alt="car" src="/public/cars/noimage.gif" />')+"<\/a>"}},{bSortable:!1,bVisible:!n,mData:function(n){return n.PayInvTypeID===3?(n.BuyerName?n.BuyerName+" - ":"")+n.full_name:(n.BuyerName?n.BuyerName+" - ":"")+(n.AuctionName?n.AuctionName+" - ":"")+n.full_name}},{mDataProp:"CarID",bSortable:!0,sType:"numeric"},{mDataProp:"InvoiceDate",bSortable:!0,mData:function(n){return commonManger.formatJSONDateCal(n.InvoiceDate,"dd/MM/yyyy")}},{mDataProp:"LotNo",bSortable:!1},{mDataProp:"TypeNameEn",bSortable:!1,mData:function(n){return'<a title="تفاصيل السيارة" href="CarDetailsPrint.aspx?id='+n.CarID+'">'+n.MakerNameEn+" - "+n.TypeNameEn+" - "+n.Year+(n.PayInvTypeID==3?" - Relist":"")+"<\/a>"}},{mDataProp:"ChassisNo",bSortable:!1},{mData:function(n){return(n.ShipCompanyNameEn?n.ShipCompanyNameEn:"")+(n.DeleteReason?' <i title="'+n.DeleteReason+'" class="ace-tooltip icon-info-sign red pull-left"><\/i>':"")},bSortable:!1},{mData:function(n){return numeral(n.PayPrice).format("0,0.00")},bSortable:!1}]})};return{Init:s}}();
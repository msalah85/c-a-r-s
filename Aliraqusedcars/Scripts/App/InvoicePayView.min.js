var pageManager=function(){"use strict";var i="",n="",r="",u="",f="",e="",t=!1,s=function(){var t=commonManger.getQueryStrs().paid;t&&(n=t,$("#Paid").val(t));c();h()},h=function(){$("#btnSearchAll").click(function(s){s.preventDefault();i=$("#Buyer").val();r=$("#ChassisN").val();n=$("#Paid").val();u=commonManger.dateFormat($("#From").val());f=commonManger.dateFormat($("#To").val());e=$("#ClientID").val();t=$(".buyerGrouping").is(":checked");commonManger.showOptionPrintTitle($("#Paid option:selected").text());o()});$("#cancelModal .modal-footer .btn-danger").on("click",function(n){var r,u;n.preventDefault();var t=$("#cancelCarID").val(),i=$("#cancelNotes").val(),f=function(n){n=n.d;$("div[id$=Modal].modal").modal("hide");commonManger.showMessage("تم تنفيذ الإجراء:",n.message);n.Status&&o()};t&&i!=""?(r="aspnetForm",u={actionName:"CarsData_Delete",names:["CarID","Reason"],values:[t,i]},commonManger.doWork("cancelModal",r,sUrl+"saveData",u,f,commonManger.errorException)):(commonManger.showMessage("بيانات مطلوبة","يرجي التحقق من رقم السيارة وسبب الحذف أولاً."),$("#cancelNotes").focus())})},l=function(){var n=$("#totalAmount").val(),t=$("#noBuyers").val(),i=$("#Fines").val(),r=$("#commission").val(),u=(parseFloat(n)+parseFloat(i))*3.674+parseInt(t)*parseFloat(r);$("#totalAmountDhs").val(u.toFixed())},o=function(){$("#listItems").DataTable().draw()},a=function(n){return"?"+Object.keys(n).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(n[t])}).join("&")},c=function(){var o=$("#listItems").DataTable({sDom:"<'row-fluid'<'span6'l><'span6 lft-pane'BT>r>t<'row-fluid'<'span6'i><'span6'p>>",buttons:[{extend:"csv",text:"تصدير إكسيل"},{extend:"copy",text:"نسـخ"},{text:"طباعة",action:function(){$(".dataTables_length,.form-horizontal").closest("div.row-fluid").addClass("hidden-print");window.print()}}],serverSide:!0,processing:!0,stateSave:!0,deferRender:!0,responsive:!0,bRetrieve:!1,bDestroy:!0,sAjaxSource:sUrl+"LoadDataTablesXML",fnServerParams:function(t){t.push({name:"funName",value:"InvoicePay_SelectList"},{name:"names",value:"Buyer~Paid~Chassis~From~To~ClientID"},{name:"values",value:i+"~"+n+"~"+r+"~"+u+"~"+f+"~"+e})},fnServerData:function(n,t,i){dataService.callAjax("GET",t,n,function(n){var f=commonManger.comp2json(n.d),u=f.list,r=f.list1,e;r=r?$.map(r,function(n){return n}):[0];e={sEcho:t.sEcho?t.sEcho:0,iTotalRecords:r[0],iTotalDisplayRecords:r[0],aaData:$.isArray(u)?u:$.makeArray(u)};i(e);r&&$(".sum-total-all").text(numeral(r[1]).format("0,0"))},commonManger.errorException)},drawCallback:function(){if(t){var n=this.api(),r=n.rows({page:"current"}).nodes(),i=null;n.column(1,{page:"current"}).data().each(function(n,t){i!==n&&($(r).eq(t).before('<tr class="alert alert-success"><td colspan="100%" title="رقم الباير واسم المزاد"><strong>رقم الباير: <\/strong>'+n+"<\/td><\/tr>"),i=n)})}},fnRowCallback:function(n,t){t.PayInvTypeID===3&&$(n).addClass("car-relist")},fnFooterCallback:function(n,t){for(var r=0,i=0;i<t.length;i++)r+=t[i].PayPrice*1;$(n).find("th:eq(1)").html(numeral(r).format("0,0.00"))},iDisplayLength:50,aaSorting:[],aoColumns:[{mDataProp:"MainPicture",bSortable:!1,render:function(n,t,i){return'<a title="صور السيارة رقم: '+i.CarID+'" href="images.aspx?id='+i.CarID+'">'+(i.MainPicture&&i.MainPicture!==null?'<img alt="car" src="/public/cars/'+i.CarID+"/_thumb/"+i.MainPicture+'" />':'<img alt="car" src="/public/cars/noimage.gif" />')+"<\/a>"}},{bSortable:!1,bVisible:!t,mData:function(n){return n.PayInvTypeID===3?(n.BuyerName?n.BuyerName+" - ":"")+n.full_name:(n.BuyerName?n.BuyerName+" - ":"")+(n.AuctionName?n.AuctionName+" - ":"")+n.full_name}},{mDataProp:"CarID",bSortable:!0,sType:"numeric"},{mDataProp:"InvoiceDate",bSortable:!0,mData:function(n){return commonManger.formatJSONDateCal(n.InvoiceDate,"dd/MM/yyyy")}},{mDataProp:"LotNo",bSortable:!1},{mDataProp:"TypeNameEn",bSortable:!1,mData:function(n){return'<a title="تفاصيل السيارة" href="CarDetailsPrint.aspx?id='+n.CarID+'">'+n.MakerNameEn+" - "+n.TypeNameEn+" - "+n.Year+(n.PayInvTypeID==3?" - Relist":"")+"<\/a>"}},{mDataProp:"ChassisNo",bSortable:!1},{mData:function(n){return n.ShipCompanyNameEn?n.ShipCompanyNameEn:""},bSortable:!1},{mData:function(n){return numeral(n.PayPrice).format("0,0.00")},bSortable:!1},{bSortable:!1,sClass:"hidden-print",mData:function(n){var t=commonManger.fullRoles();return n.SaleClientName&&n.PayInvoicePaymentsID&&n.IsShippingCarPaid?"---":'<div class="tools pull-left hidden-print"><a href="pay/'+n.CarID+'/InvoicePayAdd.aspx" class="hidden-print btn btn-mini btn-info" data-rel="tooltip" data-placement="top" title="تعــديل" data-original-title="تعــديل"><i class="icon-edit icon-only"><\/i><\/a> '+(t?'<button class="btn btn-mini btn-danger remove" data-rel="tooltip" data-placement="top" data-original-title="حــذف" title="حــذف"><i class="icon-remove icon-only"><\/i><\/button>':"")+"<\/div>"}}]});$("#listItems tbody").delegate("tr button","click",function(n){n.preventDefault();var i=$(this),r=i.closest("tr").index(),t;r!==null&&i.hasClass("remove")&&(t=o.row(r).data(),$("#cancelCarID").val(t.CarID),$("#cancelCarModel").val(t.MakerNameEn+" - "+t.TypeNameEn+" - "+t.Year),$("#cancelNotes").val(""),$("#cancelModal").modal("show"))})};return{Init:s}}();
var ReceiptVoucher=function(){var n={cid:"",BankID:"",from:"",to:"",groupID:""},i=function(){e();r()},r=function(){$("#SearchAll").on("click",function(i){i.preventDefault();n.cid=$("#ClientID").val();n.BankID=$("#BankID").val()!=""?$("#BankID").val():"";n.from=commonManger.dateFormat($("#From").val())!=""?commonManger.dateFormat($("#From").val()):"";n.to=commonManger.dateFormat($("#To").val())!=""?commonManger.dateFormat($("#To").val()):"";n.groupID=$("#ExpenseTypeGroupID").val();t()});$("#cancelModal .modal-footer .btn-danger").on("click",function(n){var t,i;if(n.preventDefault(),t=$("#ReceiptID").val(),i=$("#DeleteReason").val(),t&&i!=""){var r=[t,i],f={actionName:"ReceiptVouchers_Delete",names:["ReceiptID","DeleteReason"],values:r};dataService.callAjax("Post",JSON.stringify(f),sUrl+"saveData",u,commonManger.errorException)}else commonManger.showMessage("حقول مطلوبة","يرجي ادخال سبب الإلغاء أولاً."),$("#DeleteReason").focus()})},u=function(n){n=n.d;$(".modal").modal("hide");commonManger.showMessage("تم تنفيذ الإجراء بنجاح.",n.message);n.Status&&t()},f=function(){var n=commonManger.fullRoles();return n?'<button class="btn btn-minier btn-danger remove" data-rel="tooltip" data-placement="top" data-original-title="حــذف"><i class="icon-remove"><\/i><\/button> ':""},t=function(){$("#listItems").DataTable().draw()},e=function(){var t=$("#listItems").DataTable({sDom:"<'row-fluid'<'span6'l><'span6 lft-pane'BT>r>t<'row-fluid'<'span6'i><'span6'p>>",buttons:[{extend:"csv",text:"تصدير إكسيل"},{text:"طباعة",action:function(){$(".dataTables_length,.form-horizontal").closest("div.row-fluid").addClass("hidden-print");window.print()}}],bDestroy:!0,bServerSide:!0,responsive:!0,stateSave:!0,sAjaxSource:sUrl+"LoadDataTablesXML",fnServerParams:function(t){var i=n.cid+"~"+n.BankID+"~"+n.from+"~"+n.to+"~"+n.groupID;t.push({name:"funName",value:"ReceiptVouchers_SelectList"},{name:"names",value:"ClientID~BankID~From~To~GroupID"},{name:"values",value:i})},fnServerData:function(n,t,i){dataService.callAjax("GET",t,n,function(n){commonManger.setData2Grid(n,t.sEcho,i)},commonManger.errorException)},fnFooterCallback:function(n,t){for(var r=0,i=0;i<t.length;i++)r+=t[i].Amount*1;$("strong.debit").text(numeral(r).format("0,0"))},fnRowCallback:function(n,t){t.DeleteFromClientBalance==="true"&&$(n).addClass("warning").attr("title","ملغي من رصيد العميل");t.HideClientBalance==="false"&&t.full_name&&$(n).find("td:eq(2)").append("<i title='لم يعتمد فى رصيد العميل' class='icon-exclamation-sign blue pull-left'><\/i>")},aaSorting:[],iDisplayLength:50,aoColumns:[{mDataProp:"ReceiptID",bSortable:!0,type:"number"},{mDataProp:"AddDate",bSortable:!0,mData:function(n){return commonManger.formatJSONDateCal(n.AddDate)}},{mDataProp:"RecieptTypeName",bSortable:!0,mData:function(n){return n.RecieptTypeName?n.RecieptTypeName:""}},{mDataProp:"FromName",bSortable:!0,mData:function(n){return(n.full_name?n.full_name:n.FromName)+(n.IsSig==="1"?'<i data-rel="tooltip" title="تم التوقيع" class="pull-left orange icon-pencil"><\/i>':"")+(n.PayTypeID==="3"?'<i data-rel="tooltip" title="حـوالــة" class="pull-left icon-briefcase"><\/i>':"")}},{mDataProp:"BankCheckNo",bSortable:!1,mData:function(n){return n.BankCheckNo?n.BankCheckNo:""}},{mDataProp:"BankName",bSortable:!1,mData:function(n){return n.BankName?n.BankName:""}},{mDataProp:"Amount",bSortable:!1,mData:function(n){return numeral(n.Amount).format("0,0")}},{mDataProp:"AmountDhs",bSortable:!1,mData:function(n){return numeral(n.AmountDhs).format("0,0.00")}},{sClass:"hidden-print",bSortable:!1,mData:function(n){var t="";return n.Revised==="false"&&n.HideClientBalance==="false"&&(t='<a class="btn btn-minier btn-info" href="ReceiptVoucherAdd.aspx?id='+n.ReceiptID+'" title="تعديل"><i class="icon-edit"><\/i><\/a> '+f()),t+'<a href="ReceiptVoucherPrint.aspx?id='+n.ReceiptID+'" class="btn btn-minier btn-success" data-rel="tooltip" title="طباعة" data-original-title="طباعة"><i class="icon-print"><\/i><\/a>'}}]});$("#listItems tbody").delegate("tr button","click",function(n){var r,u,i,f,e;n.preventDefault();r=$(this);u=r.closest("tr").index();u!=null&&r.hasClass("remove")&&(f="إلغاء إيداع عميل",e="cancelModal",i=t.row(u).data(),$("#ReceiptID").val(i.ReceiptID),$("#AddDate").val(commonManger.formatJSONDateCal(i.AddDate)),$("#Amount").val(i.Amount),commonManger.showPopUpDialog(f,"",e))})};return{Init:i}}();
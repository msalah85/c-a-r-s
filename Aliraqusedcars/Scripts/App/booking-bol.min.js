var pageManager=pageManager||{},pageManager=function(){var n="",t="",r=function(){var i=commonManger.getUrlVars();i&&(n=i.ids?i.ids:null,t=i.id?i.id:null,h());u()},u=function(){$(".btnFinish").click(function(n){var i,r,t;n.preventDefault();i=commonManger.applyValidation("aspnetForm");i&&(r=["ShippInvoiceID","CarID","Towing"],t=$($("#listItems tbody tr")).map(function(n,t){return $(t).find("td:nth-child(1)").attr("data-billdetailsid")+","+$(t).find("td:nth-child(1)").text()+","+$(t).find("td:nth-child(5)").text().replace(",","")}).get(),t.length?commonManger.SaveDataMasterDetails("","masterForm",s,"",r,t,"ShippInvoices_Save","1"):commonManger.showMessage("اختر سيارات أولا","برجاء اختيار سيارات للحاوية."))});$("#listItems tbody").delegate("tr a","click",function(n){n.preventDefault();var t=$(this),i=t.closest("tr");o(i)});$("#addNewCar").click(function(n){var t,i;n.preventDefault();t=$("#CarID").val();t!=""?f(t)?commonManger.showMessage("السيارة موجودة","السيارة موجودة بالفعل، يرجي اختيار سيارة أخري."):(i={actionName:"Booking_GetCarByLot",names:["lot"],values:[t]},dataService.callAjax("Post",JSON.stringify(i),sUrl+"GetDataList",e,commonManger.errorException)):commonManger.showMessage("مطلوب","يرجي اختيار رقم اللوت أولاً.")})},f=function(n){var t=!1;return $("#listItems tbody").find("tr").find("td:nth-child(1)").each(function(){$(this).text()==n&&(t=!0)}),t},e=function(n){var u=commonManger.comp2json(n.d),t=u.list,r;t&&(r=$(t).map(function(n,t){return"<tr><td data-billdetailsid="+(t.BillDetailsID?t.BillDetailsID:0)+' title="رقم السيارة">'+t.CarID+'<\/td><td title="LOT - Year - Maker - Model">'+(t.LotNo+" - "+t.Year+" - "+t.MakerNameEn+" - "+t.TypeNameEn)+"<\/td><td>"+t.ShipCompanyNameEn+"<\/td><td>"+t.RegionEn+"<\/td><td>"+numeral(t.Towing).format("0,0.00")+'<\/td><td><a class="btn btn-mini btn-danger remove" data-rel="tooltip" title="حذف السيارة"><i class="icon-remove"><\/i><\/a><\/td><\/tr>'}).get(),$("#listItems tbody").append(r),i())},o=function(n){n.css({transition:"background-color 1s","background-color":"red"}).fadeOut("slow").promise().done(function(){n.remove()})},s=function(n){n=n.d;n.Status?window.location.href="InvoicesShippBolView.aspx":console.log(n)},h=function(){var r=function(n){var r=commonManger.comp2json(n.d),h=r.list,u=r.list1,f=r.list2,e=$("#NavigationCoID"),o,t,s;e.append($("<option>"));$.each(h,function(){e.append($("<option>").text(this.NavigationCoName).attr("value",this.NavigationCoID))});u&&(o=$(u).map(function(n,t){return"<tr><td data-billdetailsid="+(t.BillDetailsID?t.BillDetailsID:0)+' title="رقم السيارة">'+t.CarID+'<\/td><td title="LOT - Year - Maker - Model">'+(t.LotNo+" - "+t.Year+" - "+t.MakerNameEn+" - "+t.TypeNameEn)+"<\/td><td>"+t.ShipCompanyNameEn+"<\/td><td>"+t.RegionEn+"<\/td><td>"+numeral(t.Towing).format("0,0.00")+'<\/td><td><a class="btn btn-mini btn-danger remove" data-rel="tooltip" title="حذف السيارة"><i class="icon-remove"><\/i><\/a><\/td><\/tr>'}).get(),$("#listItems tbody").append(o),t=[],$(u).each(function(n,i){n===0&&t.push(i)}),$("#ShippInvoiceID").val(t[0].ShippInvoiceID?t[0].ShippInvoiceID:0),$("#DistinationID").val(t[0].DistinationID),$("#ShipperID").val(t[0].ShipperID),$("#ArrivalDate").val(commonManger.formatJSONDateCal(t[0].ArrivalDate)),$("#ContainerNo").val(t[0].ContainerNo),$("#NavigationCoID").val(t[0].NavigationCoID),$("#ContainerSize").val(t[0].ContainerSize),$("#Bol").val(t[0].Bol),$("#ContainersNotes").val(t[0].ContainersNotes),$("#ShippPrice").val(t[0].ShippPrice?t[0].ShippPrice:0),$("#LoadingPrice").val(t[0].LoadingPrice?t[0].LoadingPrice:0),i());f&&(s=$(f).map(function(n,t){return $("<option />").val(t.CarID).text(t.LotNo)}).get(),$("#CarID").append(s).trigger("chosen:updated"))},u={actionName:"Booking_Properties",names:["Ids","Id"],values:[n,t]};dataService.callAjax("Post",JSON.stringify(u),sUrl+"GetDataList",r,commonManger.errorException)},i=function(){$("#CarsNo").val($("#listItems tbody tr").length)},c=function(n,t,i){var r,u;for(i=i||",",r=n.split(i),u=0;u<r.length;u++)if(r[u]==t)return r.splice(u,1),r.join(i);return n};return{Init:r}}();pageManager.Init();
var pageManager=function(){var t="",i="",r="",n=document.createElement("a"),u=function(t){var r=$(t).clone()[0],i;return r.nodeName.toLowerCase()==="link"&&(n.href=r.href,i=n.host,i.indexOf("/")===-1&&n.pathname.indexOf("/")!==0&&(i+="/"),r.href=n.protocol+"//"+i+n.pathname+n.search),r.nodeName.toLowerCase()==="img"&&(n.href=r.src,i=n.host,i.indexOf("/")===-1&&n.pathname.indexOf("/")!==0&&(i+="/"),r.src=n.protocol+"//"+i+n.pathname+n.search),r.outerHTML},f=function(t){var r,u=$(t).clone()[0],i;return u.nodeName.toLowerCase()==="img"&&(n.href=u.src,i=n.host,i.indexOf("/")===-1&&n.pathname.indexOf("/")!==0&&(i+="/"),r=n.protocol+"//"+i+n.pathname+n.search),r},e=function(){h();o()},o=function(){$("#btnSearchAll").click(function(n){n.preventDefault();t=$("#client").val();i=commonManger.dateFormat($("#From").val());r=commonManger.dateFormat($("#To").val());s()});$("#listItems tbody").live("tr button","click",function(n){n.preventDefault();var t=$(this),i=t.closest("tr").index(),r;i!==null&&t.hasClass("remove")&&DeleteConfirmation(function(){r=pTable.data(i).data();var n=r.SaleInvoiceID;commonManger.deleteData("anyThing",commonManger.successDeleted,commonManger.errorException,"CarSaleInvoices","SaleInvoiceID",n)})});$(".print-all-selected").click(function(n){var i;if(n.preventDefault(),i=$("input.select:checked").map(function(){return $(this).val()}).get(),i.length<=0){alert("يرجي اختيار فاتورة أو أكثر أولاً لطباعتها");return}var r="",o=function(){var n=function(n){var u=commonManger.comp2json(n.d),l=u.list,f=u.list1,o=u.list2,i="",h=$(r).clone(!0),a=h.filter("div.container"),c=function(n,r,u,f){var e=$("<div />",{html:i});e.find(n+" ."+r+"-list tbody").html(t(u)).closest("div.span6").removeClass("hidden").find(".carTotal").text(numeral(f).format("0,0"));i=e.html()};$(l).each(function(n,t){var r=n===0?h:a,v;$(r).attr("id","InvoiceNo_"+n);$("#ContentPlaceHolder1_divInvoiceNo",r).text(t.SaleInvoiceID);$("#ContentPlaceHolder1_clientAccount",r).text(t.full_name);$("#ContentPlaceHolder1_toDay",r).text(commonManger.formatJSONDateCal(t.InvoiceDate));$("#ContentPlaceHolder1_divModel",r).text(t.MakerNameEn+" - "+t.TypeNameEn);$("#ContentPlaceHolder1_divYear",r).text(t.Year);$("#ContentPlaceHolder1_CarID",r).text(t.CarID);$("#ContentPlaceHolder1_divLotNo",r).text(t.LotNo);$("#ContentPlaceHolder1_divChassis",r).text(t.ChassisNo);$("#ContentPlaceHolder1_divStatus",r).text(t.WorkingStatusName);$("#ContentPlaceHolder1_divColor",r).text(t.ColorNameEn);$("#ContentPlaceHolder1_DivGear",r).text(t.TransmissionNameEn);$("#ContentPlaceHolder1_divArriveDate",r).text(commonManger.formatJSONDateCal(t.ArrivalDate));$("#ContentPlaceHolder1_divSaleTypeName",r).text(t.SaleTypeName);$("#ContentPlaceHolder1_divNotes",r).text(t.Notes);$("#ContentPlaceHolder1_divPrice",r).text(numeral(t.PayPrice).format("0,0"));$(".ace-thumbnails",r).html(`<img class="thumb" src="/public/cars/${t.CarID}/${t.MainPicture}" />`);v=e(r);i+=v+"<br>";var u=t.PayPrice*1,y="#InvoiceNo_"+n,p=t.CarID,s=[],l=[];f&&(l=$(f).map(function(n,i){if(i.CarID===t.CarID)return u+=i.ExtraAmount*1,{Notes:i.Notes,Amount:i.ExtraAmount}}));o&&(s=$(o).map(function(n,i){if(i.CarID===t.CarID)return u-=i.DiscountAmount*1,{Notes:i.Notes,Amount:i.DiscountAmount}}));s.length>0&&c(y,"disc",s,u);l.length>0&&c(y,"extra",l,u)});s(i)},t=function(n){return $(n).map(function(n,t){return`<tr><td>${numeral(t.Amount).format("0,0")}</td><td>${t.Notes}</td></tr>`}).get().join("")},u={actionName:"CarSaleInvoices_Selectd",names:["IDs"],values:[i.join()]};dataService.callAjax("POST",JSON.stringify(u),sUrl+"GetDataList",n,commonManger.errorException)},t=function(n,t){var i=$("<div>"+n+"<\/div>");return i.find(t).remove(),i.html()},s=function(n){var t=window.open("",""),r="<title>طباعة فواتير البيع<\/title>",i;$(n).filter("link").each(function(){r+=u(this)});i=$(n).clone(!0);$("img",i).attr("src",function(){return f(this)});t.document.close();$(t.document.head).html(r);$(t.document.body).html('<div id="content">'+e(i)+"<\/div>")},e=function(n){var t=document.createElement("div");return $(t).html(n),$(t).html()},h=function(n){n=t(n,"title,div.stickyFooter.hidden-print,button,.printme,.delete-wpr,.widget-box");n=t(n,'script[src*="/Scripts/App/carsaleInvoicesManager"]');n=t(n,'script[src*="signature/js/canvg"]');n=t(n,'script[src*="signature/js/jquery.signature"]');r=n+`<style> 
                                                    @media print {
                                                        @page { margin: 0; }
                                                        .container{ page-break-before: always; }
                                                    }
                                                  </style>`;o()};$.get("/admin-admin-2015/InvoiceSalePrint.aspx",h,"html")});var n="active";$("#listItems thead").on("click",".select-all",function(){var t=this.checked;$(this).closest("table").find("tbody > tr").each(function(){var i=this;t?$(i).addClass(n).find("input[type=checkbox]").eq(0).prop("checked",!0):$(i).removeClass(n).find("input[type=checkbox]").eq(0).prop("checked",!1)})});$("#listItems").on("click","td input[type=checkbox]",function(){var t=$(this).closest("tr");t.is(".detail-row ")||(this.checked?t.addClass(n):t.removeClass(n))})},s=function(){$("#listItems").DataTable().draw()},h=function(){var n=$("#listItems").DataTable({sDom:"<'row-fluid'<'span6'l><'span6 lft-pane'BT>r>t<'row-fluid'<'span6'i><'span6'p>>",buttons:[{extend:"csv",text:"تصدير إكسيل"},{extend:"copy",text:"نسـخ"},{text:"طباعة",action:function(){$(".dataTables_length,.form-horizontal").closest("div.row-fluid").addClass("hidden-print");window.print()}}],bProcessing:!0,bServerSide:!0,responsive:!0,bDestroy:!0,sAjaxSource:sUrl+"LoadDataTablesXML",fnServerParams:function(n){n.push({name:"funName",value:"InvoicesSale_SelectList"},{name:"names",value:"Client~From~To"},{name:"values",value:`${t}~${i}~${r}`})},fnServerData:function(n,t,i){dataService.callAjax("GET",t,n,function(n){var f=commonManger.comp2json(n.d),u=f.list,r=f.list1,e;r=r?$.map(r,function(n){return n}):[0];e={sEcho:t.sEcho?t.sEcho:0,iTotalRecords:r[0],iTotalDisplayRecords:r[0],aaData:$.isArray(u)?u:$.makeArray(u)};i(e);r&&$(".sum-total-all").text(numeral(r[1]).format("0,0"))},commonManger.errorException)},fnFooterCallback:function(n,t){for(var r=0,i=0;i<t.length;i++)r+=t[i].SalePrice*1;$(n).find("th:eq(1)").html(numeral(r).format("0,0"))},aaSorting:[],iDisplayLength:50,aoColumns:[{mDataProp:"SaleInvoiceID",bSortable:!0,mData:function(n){return'<a target="_blank" href="InvoiceSalePrint.aspx?id='+n.SaleInvoiceID+'" title="طباعة السيارة">'+n.SaleInvoiceID+"<\/a>"}},{mDataProp:"CarID",bSortable:!1},{mDataProp:"InvoiceDate",bSortable:!0,mData:function(n){return commonManger.formatJSONDateCal(n.InvoiceDate)}},{mDataProp:"full_name",bSortable:!0,mData:function(n){return'<a href="ClientCars.aspx?id='+n.ClientID+'" title="حساب العميل">'+n.full_name+"<\/a>"}},{mDataProp:"TypeNameEn",bSortable:!0,mData:function(n){return n.MakerNameEn+" - "+n.TypeNameEn}},{mDataProp:"ArrivalDate",bSortable:!0,mData:function(n){return n.ArrivalDate?commonManger.formatJSONDateCal(n.ArrivalDate):""}},{bSortable:!1,mData:function(n){return n.DistinationNameAr?n.DistinationNameAr:""}},{bSortable:!1,mData:function(n){return numeral(n.SalePrice).format("0,0")}},{bSortable:!1,sClass:"hidden-print text-center",mData:function(n){return`<input type="checkbox" class="select" data-carid="${n.SaleInvoiceID}" value="${n.SaleInvoiceID}" />`}},{bSortable:!1,sClass:"hidden-print",mData:function(n){return'<div class="btn-group"><button data-toggle="dropdown" class="btn btn-small btn-info dropdown-toggle">اخـتـر <i class="icon-angle-down icon-on-right"><\/i><\/button>                                    <ul class="dropdown-menu pull-right">                                        <li><a target="_blank" href="signature/signature.aspx?id='+n.SaleInvoiceID+'&type=1" title="طباعة استلام أوراق السيارة">طباعة استلام أوراق السيارة<\/a>                                        <\/li>                                        <li>                                            <a target="_blank" href="signature/signature.aspx?id='+n.SaleInvoiceID+'&type=2" title="طباعة استلام VCC">طباعة استلام VCC<\/a>                                        <\/li>                                        <li>                                            <a target="_blank" href="InvoiceSalePrint.aspx?sig=1&id='+n.SaleInvoiceID+'" title="طباعة الفاتورة">طباعة الفاتورة<\/a>                                        <\/li><\/div>'}}]})};return{Init:e}}();
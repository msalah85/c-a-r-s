var $clients=$("#Clients"),successData=function(n){var i=commonManger.comp2json(n.d),t=i.list;t&&($(t).each(function(n,t){$clients.append($("<option />").text(t.full_name).val(t.phone))}),$clients.trigger("chosen:updated"))},enaleControl=function(n,t){t?$("#"+n).removeAttr("disabled").html('<i class="icon-save"><\/i> ارسـل رسالة'):$("#"+n).removeAttr("disabled").text("جاري التنفيذ ...")},setCode=function(n){var t=$("#Message");t.val(t.val()+" "+n)},fillClients=function(){var n=sUrl+"/GetDataDirect";dataService.callAjax("Post",JSON.stringify({actionName:"SMSTemplates_Properties"}),n,successData,commonManger.errorException)},targetdata;modalDialog="addModal";tableName="SMSTemplates";pKey="ID";gridId="listItems";gridColumns=[];formName="aspnetForm";gridColumns.push({mDataProp:"Message",bSortable:!0},{bSortable:!1,mData:function(){return'<button class="btn btn-primary btn-mini edit" title="تعديل"><i class="icon-pencil"><\/i><\/button> <button class="btn btn-warning btn-mini sms" title="ارسل SMS"><i class="icon-envelope"><\/i><\/button> <button class="btn btn-danger btn-mini remove" title="حذف"><i class="icon-trash"><\/i><\/button>'}});successSentData=function(n){n=n.d;n.indexOf("Successful")>0?(commonManger.showMessage("تم الارسال بنجاح.","تم ارسال الرسالة بنجاح."),$(".modal").modal("hide")):commonManger.showMessage("خطأ بالارسال:","لقد حدث خطأ أثناء تنفيذ العملية:"+n)};SendingSMS=function(n,t){var i={phones:n.join(),message:t};dataService.callAjax("Post",JSON.stringify(i),"sms-templates.aspx/SendSMS",successSentData,commonManger.errorException);enaleControl("send-sms",!0)};DefaultGridManager.Init();$.fn.beforeSave=function(){return!0};$.fn.afterLoadData=function(n){targetdata=n};fillClients();$("#"+gridId+" tbody").delegate("tr button.sms","click",function(n){n.preventDefault();$("#smsForm")[0].reset();var t=$(this),i=t.closest("tr").find("td:eq(0)").text();$("#msg").val("").val(i);commonManger.showPopUpDialog("ارسال رسالة","sms","addSMS")});$("#sendAll").on("click",function(){var n=$("select[id$=Clients]").get(0);n.hasAttribute("disabled")?n.removeAttribute("disabled"):n.setAttribute("disabled","disabled");$("select[id$=Clients]").trigger("chosen:updated").trigger("liszt:updated")});$("#addSMS .modal-footer .btn-primary").click(function(n){n.preventDefault();var t=$("select[id$=Clients]"),i=t.is(":disabled")?$.map(t.find("option"),function(n){return n.value}):t.chosen().val();i?(enaleControl("send-sms",!1),SendingSMS(i,$("#msg").val())):commonManger.showMessage("بيانات مطلوبة","برجاء اختيار العميل والتأكد من نص الرسالة.")});
var printSaleCarsBill=printSaleCarsBill||{};(function(){var n=document.createElement("a"),u=function(t){var r=$(t).clone()[0],i;return r.nodeName.toLowerCase()==="link"&&(n.href=r.href,i=n.host,i.indexOf("/")===-1&&n.pathname.indexOf("/")!==0&&(i+="/"),r.href=n.protocol+"//"+i+n.pathname+n.search),r.nodeName.toLowerCase()==="img"&&(n.href=r.src,i=n.host,i.indexOf("/")===-1&&n.pathname.indexOf("/")!==0&&(i+="/"),r.src=n.protocol+"//"+i+n.pathname+n.search),r.outerHTML},f=function(t){var r,u=$(t).clone()[0],i;return u.nodeName.toLowerCase()==="img"&&(n.href=u.src,i=n.host,i.indexOf("/")===-1&&n.pathname.indexOf("/")!==0&&(i+="/"),r=n.protocol+"//"+i+n.pathname+n.search),r},i="",e=function(n){var u=function(n){var f=commonManger.comp2json(n.d),l=f.list,e=f.list1,s=f.list2,u="",h=$(i).clone(!0),a=h.filter("div.container"),c=function(n,i,r,f,e){var o=$("<div />",{html:u});e?o.find(n+" ."+i+"-list tbody").html(t(r)).closest("div.span6").removeClass("hidden"):o.find(n+" ."+i+"-list tbody").html(t(r)).closest("div.span6").remove();o.find(n+" .carTotal").text(numeral(f).format("0,0"));u=o.html()};$(l).each(function(n,t){var i=n===0?h:a,v;$(i).attr("id","InvoiceNo_"+n);$("#ContentPlaceHolder1_divInvoiceNo",i).text(t.SaleInvoiceID);$("#ContentPlaceHolder1_divVatRegistrationNumber",i).text(t.VatRegisterNo);$("#ContentPlaceHolder1_clientAccount",i).text(t.full_name);$("#ContentPlaceHolder1_toDay",i).text(commonManger.formatJSONDateCal(t.InvoiceDate));$("#ContentPlaceHolder1_divModel",i).text(t.MakerNameEn+" - "+t.TypeNameEn);$("#ContentPlaceHolder1_divYear",i).text(t.Year);$("#ContentPlaceHolder1_CarID",i).text(t.CarID);$("#ContentPlaceHolder1_divLotNo",i).text(t.LotNo);$("#ContentPlaceHolder1_divChassis",i).text(t.ChassisNo);$("#ContentPlaceHolder1_divStatus",i).text(t.WorkingStatusName);$("#ContentPlaceHolder1_divColor",i).text(t.ColorNameEn);$("#ContentPlaceHolder1_DivGear",i).text(t.TransmissionNameEn);$("#ContentPlaceHolder1_divArriveDate",i).text(commonManger.formatJSONDateCal(t.ArrivalDate));$("#ContentPlaceHolder1_divSaleTypeName",i).text(t.SaleTypeName);$("#ContentPlaceHolder1_divNotes",i).text(t.Notes);$("#ContentPlaceHolder1_VAT",i).text(numeral(t.VAT).format("0,0")||0);$("#ContentPlaceHolder1_divPrice",i).text(numeral(t.PayPrice).format("0,0"));$(".ace-thumbnails",i).html(`<img class="thumb" src="/public/cars/${t.CarID}/${t.MainPicture}" />`);v=r(i);u+=v+"<br>";var f=t.PayPrice*1+(t.VAT||0)*1,y="#InvoiceNo_"+n,p=t.CarID,o=[],l=[];e&&(l=$(e).map(function(n,i){if(i.CarID===t.CarID)return f+=i.ExtraAmount*1,{Notes:i.Notes,Amount:i.ExtraAmount}}));s&&(o=$(s).map(function(n,i){if(i.CarID===t.CarID)return f-=i.DiscountAmount*1,{Notes:i.Notes,Amount:i.DiscountAmount}}));c(y,"disc",o,f,o.length>0);c(y,"extra",l,f,l.length>0)});o(u)},t=function(n){return $(n).map(function(n,t){return`<tr><td>${numeral(t.Amount).format("0,0")}</td><td>${t.Notes}</td></tr>`}).get().join("")},f={actionName:"CarSaleInvoices_ByBol",value:n};dataService.callAjax("POST",JSON.stringify(f),sUrl+"GetData",u,commonManger.errorException)},t=function(n,t){var i=$("<div>"+n+"<\/div>");return i.find(t).remove(),i.html()},o=function(n){var i=window.open("",""),e="<title>طباعة فواتير البيع<\/title>",t;$(n).filter("link").each(function(){e+=u(this)});t=$(n).clone(!0);$("img",t).attr("src",function(){return f(this)});$(i.document.head).html(e);$(i.document.body).html('<div id="content">'+r(t)+"<\/div>")},r=function(n){var t=document.createElement("div");return $(t).html(n),$(t).html()},s=function(n,r){n=t(n,"title,div.stickyFooter.hidden-print,button,.printme,.delete-wpr,.widget-box");n=t(n,'script[src*="/Scripts/App/carsaleInvoicesManager"]');n=t(n,'script[src*="signature/js/canvg"]');n=t(n,'script[src*="signature/js/jquery.signature"]');i=n+`<style>@media print {@page { margin: 0; }.container{ page-break-before: always; }}</style>`;e(r)};printSaleCarsBill.printBolCars=function(n){$.get("/admin-admin-2015/InvoiceSalePrint.aspx",function(t){s(t,n)},"html")}})();
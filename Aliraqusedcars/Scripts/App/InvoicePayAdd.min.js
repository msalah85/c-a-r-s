var buyInvoiceAddManager=buyInvoiceAddManager||{},buyInvoiceAddManager=function(){var o="InvoicePayAdd.aspx/",u=$("select[id$=ddlSupplier]"),n=$("select[id$=ddlBuyer]"),t=$("#txtChassisNo"),f=$("select[id$=ddlDistination]"),s=$("select[id$=ddlShipper]"),i=$("#txtLotNo"),e=$("#ddlRegion"),c=$("#ddlModel"),y=$("#ddlMaker"),l="aspnetForm",r=function(){$(".chzn-select").chosen({allow_single_deselect:!0,no_results_text:"اختـــر",search_contains:!1}).trigger("chosen:updated")},p=function(n){n=n.d;n.Status?window.location.href="Images.aspx?id="+n.ID:commonManger.showMessage("خطأ بالحفظ:",n.Message)},w=function(n){var t=o+"SaveInvoice",i={_car:n};commonManger.doWork("anyThing",l,t,i,p,commonManger.errorException)},a=function(){var n=f.val(),t=e.val(),i,u;n>0&&t>0?(i=o+"GetShippers",u={region:t,dist:n},dataService.callAjax("POST",JSON.stringify(u),i,function(n){h(n,s)},commonManger.errorException)):r()},b=function(n){if(n>0){var t=o+"GetModels",i={modelId:n};dataService.callAjax("POST",JSON.stringify(i),t,function(n){h(n,c)},commonManger.errorException)}else r()},h=function(t,i){var e=t.d,u,f;i.html("<option><\/option>");$.each(e,function(n,t){t.__type==="Aliraqcars.Domain.Concrete.IShippingCompaniesNames"?$("<option>",{value:t.ShipCompanyID}).html(t.ShipCompanyNameAr).appendTo(i):t.__type==="Aliraqcars.Domain.Data.Buyers_SelectName2Result"?$("<option>",{value:t.BuyerID}).html(t.BuyerName).appendTo(i):t.__type==="Aliraqcars.Domain.Data.CarsModel_SelectRowResult"&&$("<option>",{value:t.ModelID}).html(t.TypeNameEn).appendTo(i)});buyerSelectedVal&&buyerSelectedVal.indexOf("|")>0&&i===n&&(u=buyerSelectedVal.split("|"),f=i.find('option[value="'+u[0]+'"]'),typeof f!="undefined"&&$("<option>",{value:u[0]}).html(u[1]).appendTo(i),i.val(u[0]));r()},k=function(t){if(t!==""){var i={auction:t},u=o+"GetBuyersByAuction";dataService.callAjax("POST",JSON.stringify(i),u,function(t){h(t,n)},commonManger.errorException)}else r()},v=function(){var n=$("span[id$=ddlInvoiceType] input:checked").val(),u;if($("#divSaleTypeID").css("display","block"),n==3){$("#lbltxtPayPrice").html('مبلغ الغرامة <span class="text-error">*<\/span>');$("#divSuplier").css("display","block");$("#divCity,#divSaleTypeID").css("display","none");$("#ddlDistination,#ddlShipper,#ddlRegion").val("");r();var f=commonManger.fullRoles(),t=$("#txtPayPrice"),i=t.is(":disabled");f===!0&&i===!0&&(localStorage.setItem("by_2_rlist_dsbl",i),t.removeClass("aspNetDisabled").removeAttr("disabled"))}else n==2?$("#divSuplier,#divCity,#divSaleTypeID").css("display","none"):$("#divCity,#divSuplier").css("display","block"),$("#lbltxtPayPrice").html('سعر الشراء <span class="text-error">*<\/span>'),u=localStorage.getItem("by_2_rlist_dsbl"),u==="true"&&$("#txtPayPrice").addClass("aspNetDisabled").prop("disabled",!0)},d=function(n){var u=commonManger.comp2json(n.d),r=u.list,i;r?(i="الشاصي الذي أدخلته موجود بالفعل مع السيارة رقم: "+r.CarID,t.attr("title",i).tooltip("show").closest(".control-group").addClass("error"),commonManger.showMessage("الشاصي مكرر",i)):t.attr("title","");t.prop("disabled",!1)},g=function(){var n=sUrl+"GetDataList",i={actionName:"CarsData_CheckChassisExist",names:["CarID","ChassisNo"],values:[$("input[id$=hfId]").val(),t.val()]};dataService.callAjax("POST",JSON.stringify(i),n,d,commonManger.errorException)},nt=function(n){var u=commonManger.comp2json(n.d),r=u.list,t;r?(t="رقم اللوت الذي أدخلته موجود بالفعل للسيارة رقم: "+r.CarID,i.attr("title",t).tooltip("show").closest(".control-group").addClass("error"),commonManger.showMessage("رقم اللوت مكرر",t)):i.attr("title","");i.prop("disabled",!1)},tt=function(){if(i.val()!=""){var n=sUrl+"GetDataList",t={actionName:"CarsData_CheckLotExist",names:["CarID","LotNo"],values:[$("input[id$=hfId]").val(),i.val()]};dataService.callAjax("POST",JSON.stringify(t),n,nt,commonManger.errorException)}},it=function(n){var t=sUrl+"GetDataList",i={actionName:"ClientBuyers_GetClientID",names:["BuyerID"],values:[n]};dataService.callAjax("POST",JSON.stringify(i),t,function(n){var i=commonManger.comp2json(n.d),t=i.list;t&&$("#ToSaleClientID").val(t.ClientID);r()},commonManger.errorException)},rt=function(){localStorage.removeItem("by_2_rlist_dsbl")},ut=function(){$("#addPayPrice").click(function(n){n.preventDefault();var t=$("#txtPayPrice").val();!isNaN(t)&&t*1>0&&$("#txtWebsitePrice").val(t).select()});i.on("blur",function(n){n.preventDefault();$(this).val()!=""&&(i.prop("disabled",!0),tt())});t.on("blur",function(n){n.preventDefault();t.val()!=""&&(t.prop("disabled",!0),g())});n.change(function(){var t=window.location.href.toLowerCase(),n=$(this).val();t.indexOf("2015/invoice")>0&&n!=""&&it(n)});u.change(function(){k($(this).val())});e.change(function(){a()});f.change(function(){a();p()});y.change(function(){b($(this).val())});$("#ddlDocTypes").change(function(){var i=$(this).val(),n=$("#SaleTypeID_1"),t=$("#SaleTypeID_0");n.prop("disabled",!1);i==="2"&&(n.prop("checked",!1),t.prop("checked",!1),n.prop("disabled","disabled"),t.prop("checked",!0))});$("#ddlCarStatus").change(function(){var t=$(this).val(),n=$("#divAccidentStatusID");n.addClass("hide").find("select").val("");t==="3"&&n.removeClass("hide");r()});$("span[id$=ddlInvoiceType] input").change(function(){v()});$("#btnSave").click(function(r){var o,h,a;r.preventDefault();o={};o.PayInvTypeID=$("#ddlInvoiceType").find(":checked").val();o.CarID=$("input[id$=hfId]").val();o.ChassisNo=t.val();o.ColorID=$("#ddlColor").val();o.InvoiceDate=commonManger.dateFormat($("#txtTrxDate").val());o.IsDeleted=!1;o.LotNo=i.val();o.Notes=$("#txtNotes").val();o.Visitors=0;o.ModelID=c.val();o.PayPrice=$("#txtPayPrice").val();o.PayTypeID=$("#ddlDocTypes").val();o.WorkingStatusID=$("#ddlCarStatus").val();o.Year=$("#ddlYear").val();o.TransmissionID=$("#ddlTransmission").val();o.DistinationID=f.val()!==""?f.val():null;o.OwnerID=1;o.view_home=$("#view_home").find(":checked").val();o.view_offer=$("#view_offer").find(":checked").val();o.Arrived=!1;h=$("#view_website").find(":checked").val();o.view_website=h!==undefined&&h!==""?h:null;o.WesitePrice=$("#txtWebsitePrice").val();o.ShippingCalcID=$("#rblHowToCalcShipping").find(":checked").val();o.SaleTypeID=$("#SaleTypeID").find(":checked").val();o.RegionID=e.val();o.ShipperID=s.val()!==""?s.val():null;o.WithoutShipping=$("#WithoutShipping").is(":checked");o.IsGulfOldCars=$("#IsGulfOldCars").is(":checked");o.IsGulfOldCars===!1&&(o.BuyerID=n.val()!==""?n.val():null);o.WorkingStatusID==3&&(o.AccidentStatusID=$("#AccidentStatusID").val().join(","));o.AuctionID=u.val();o.ToSaleClientID=$("#ToSaleClientID").val();o.SalePriceDemand=$("#SalePriceDemand").is(":checked");a=commonManger.applyValidation(l);a&&w(o)});var o=$("#WithoutShipping"),h=$("#IsGulfOldCars"),p=function(){var n=o.is(":checked")?!0:!1,t=f.val()!=="4";n&&t?e.val("").closest("div.region").addClass("hidden"):e.closest("div.region").removeClass("hidden")};h.change(function(){var t=$(this).is(":checked");n.closest("div.control-group").removeClass("hidden");u.closest("div.control-group").removeClass("hidden");t===!0&&(n.val("").trigger("chosen:updated"),u.val("").trigger("chosen:updated"),n.closest("div.control-group").addClass("hidden"),u.closest("div.control-group").addClass("hidden"))});o.change(function(){var n=$(this).is(":checked");$(".withShipping").removeClass("hidden");n?($("#ddlShipper").val("").trigger("chosen:updated"),$("#rblHowToCalcShipping").find('input[value="1"]').prop("checked",!0),$(".withShipping").addClass("hidden"),$(".destinTitle").text("مكان السيارة")):$(".destinTitle").text("جهة الوصول");p()});window.location.href.toLowerCase().indexOf("/pay/")>0&&(o.change(),h.change());v();r();$("#ddlDocTypes").change();$('[data-toggle="popover"]').popover()},ft=function(){rt();ut()};return{Init:ft,$auctionElement:u}}();
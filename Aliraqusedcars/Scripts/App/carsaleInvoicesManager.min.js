var pageManager=function(){var n=function(){var n=commonManger.getUrlVars(),i=n.sig;r(i);t();u()},t=function(){var n=$("span[id$=CarID] a").text(),t;console.log(n);n&&n!==""&&(t={actionName:"CarSaleInvoices_GetDiscountsExtras",value:n},dataService.callAjax("Post",JSON.stringify(t),sUrl+"GetData",i,commonManger.errorException))},i=function(n){var r=commonManger.comp2json(n.d),u=r.list,f=r.list1,t=numeral().unformat($("span[id$=divPrice]").text())*1,i,e;console.log(r);u?(i=$(u).map(function(n,i){return t+=i.ExtraAmount*1,"<tr><td>"+numeral(i.ExtraAmount).format("0,0")+"<\/td><td>"+i.Notes+"<\/td><\/tr>"}).get(),$("table.extra-list tbody").append(i).closest("div.extra-div").removeClass("hidden")):$("div.extra-div").remove();f?(i=$(f).map(function(n,i){return t-=i.DiscountAmount*1,"<tr><td>"+numeral(i.DiscountAmount).format("0,0")+"<\/td><td>"+i.Notes+"<\/td><\/tr>"}).get(),$("table.disc-list tbody").append(i).closest("div.disc-div").removeClass("hidden")):$("div.disc-div").remove();e=numeral().unformat($("span[id$=VAT]").text());t+=e*1;$(".carTotal").text(numeral(t).format("0,0"))},r=function(n){n&&n!==""?$(".hidden,#sig").removeClass("hidden"):$("#client-signature").addClass("hidden")},u=function(){$("#sig").signature({color:"#145394"});$("#clear").click(function(){$("#sig").signature("clear")});$("#SaveSignature").click(function(n){n.preventDefault();e()})},o=function(n,t,i){document.createElement("canvas");var r=document.createElement("canvas");r.width=t||500;r.height=i||500;document.getElementById("sig").innerHTML="";document.getElementById("sig").appendChild(r);typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(r);canvg(r,n,{log:!0,renderCallback:function(n){if(typeof FlashCanvas!="undefined")document.getElementById("sig").innerHTML="svg not supported";else{var t=(new XMLSerializer).serializeToString(n);document.getElementById("sig").innerHTML=t}}});$("#SaveSignature,#clear").addClass("hidden")},f=function(n){n=n.d;n.Status?($("#sig").signature("disable"),commonManger.showMessage("تم الحفظ",n.message)):commonManger.showMessage("خطأ أثناء تنفيذ الإجراء",n.message)},e=function(){var n={ID:$("td[id$=divInvoiceNo]").text(),Picture:$("#sig").signature("toSVG"),actionName:"CarSaleInvoices_ClientSignature"},t={actionName:n.actionName,names:["ID","Sig"],values:[n.ID,n.Picture]};n.ID&&n.Picture!==""?dataService.callAjax("Post",JSON.stringify(t),sUrl+"saveData",f,commonManger.errorException):commonManger.showMessage("بيانات مطلوبة","يرجي التأكد من توقيع العميل اولا.")};return{Init:n}}();pageManager.Init();
var pageManager=pageManager||{},pageManager=function(){"use strict";var i=function(){c();r()},r=function(){$("#CheckNo").on("change blur",function(n){var t,i;n.preventDefault();t=$(this).val();t!=""&&(i={actionName:"ReceiptVouchers_GetSameChecks",value:t},dataService.callAjax("Post",JSON.stringify(i),sUrl+"GetData",f,commonManger.errorException))});$("#AddNewPayment").click(function(n){n.preventDefault();var t=$("#PaymentID").val();t!=""?a(t):commonManger.showMessage("بيانات مطلوبة","يرجي اختيار رقم الايصال أولاً.")});$("#listItems tbody").delegate("tr button","click",function(n){n.preventDefault();var i=$(this).closest("tr");i&&i.css({transition:"background-color 1s","background-color":"red"}).fadeOut("slow").promise().done(function(){i.remove();t()})});$("#SaveAll").click(function(n){n.preventDefault();e()});$("#AddToCashFunds").click(function(n){n.preventDefault();u()})},u=function(){var n=$("#PaymentID").val(),t=function(t){var i=commonManger.comp2json(t.d),r=i.list;r.Saved>0?($("#PaymentID option[value="+n+"]").remove(),$("#PaymentID").trigger("chosen:updated").trigger("liszt:updated"),commonManger.showMessage("تم ترحيل السند","تم ترحيل سند القبض بنجاح.")):commonManger.showMessage("خطأ ترحيل السند","لقد حدث خطأ أثناء ترحيل سند القبض، يرجي المحاوله مرة أخري أو الاتصال بإدارة النظام.")},i=function(){var i={actionName:"ReceiptVoucher_MoveToChash",value:n};dataService.callAjax("Post",JSON.stringify(i),sUrl+"GetData",t,commonManger.errorException)};n!=""?bootbox.confirm("هل أنت متأكد من ترحيل سند القبض الذي قمت باختياره؟",function(n){n&&i()}):commonManger.showMessage("اختر سند قبض:","يرجي اختيار سند القبض الذي تريد ترحيله للصندوق")},f=function(t){var r=commonManger.comp2json(t.d),i=r.list;i&&($("#listItems tbody").html(""),n(i))},n=function(n){var r=r=$("#listItems tbody");if(n){var f=$(n).map(function(n,t){return $("<tr><td>"+t.ReceiptID+"<\/td><td>"+commonManger.formatJSONDateCal(t.AddDate)+"<\/td>                              <td>"+numeral(t.Amount).format("0,0.0")+"<\/td><td>"+numeral(t.AmountDhs).format("0,0.0")+'<\/td>                              <td><button class="btn btn-minier btn-danger remove" data-rel="tooltip" data-placement="top" data-original-title="حــذف" title="حــذف"><i class="icon-remove icon-only"><\/i><\/button><\/td><\/tr>')}).get(),u=!1,i="";$("#listItems tbody tr").each(function(){$(this).children("td:eq(0)").text()==n.ReceiptID&&(u=!0,i=i+n.ReceiptID+",")});u?commonManger.showMessage("سند مكرر:","السند رقم: "+i+" موجود بالفعل من قبل."):(r.append(f),t())}},e=function(){if(o()){var n=$("#listItems tbody tr").map(function(n,t){return $(t).find("td:eq(0)").text()}).get().join(","),t=[$("#ReviewPaymentID").val(),$("#CheckNo").val(),commonManger.dateFormat($("#PaymentDate").val()),$("#AmountDhs").val().replace(",",""),$("#Notes").val(),n,$("#TotalAmountDhs").text().replace(",",""),"",""],i={actionName:"ClientPaymentsReview_Save",names:["ReviewPaymentID","CheckNo","PaymentDate","AmountDhs","Notes","ClientPaymentsIDs","AmountSum","IP","UserID"],values:t};dataService.callAjax("Post",JSON.stringify(i),"ClientPaymentsReview.aspx/saveData",s,commonManger.errorException)}else commonManger.showMessage("بيانات مطلوبة","يرجي التحقق من البيانات أولاً.")},o=function(){var n=!0;return(numeral($("#TotalAmountDhs").text())<=0||$("#listItems tbody tr").length<=0||numeral($("#AmountDhs").val())<=0)&&(n=!1),n},s=function(n){n=n.d;n.Status?window.location.href="ClientPaymentsReviewPrint.aspx?id="+n.ID:commonManger.showMessage("خطأ بالحفظ","لقد حدث خطأ أثناء الحفظ، يرجي الاتصال بمدير النظام.")},h=function(n){var r=commonManger.comp2json(n.d),t=r.list,i;t&&(i=$(t).map(function(n,t){return $("<option />").val(t.ReceiptID).text(t.ReceiptID)}).get(),$("#PaymentID").append(i).trigger("chosen:updated").trigger("liszt:updated"))},c=function(){dataService.callAjax("Post",JSON.stringify({actionName:"ClientsPaymentsReview_Properties"}),sUrl+"GetDataDirect",h,commonManger.errorException)},l=function(t){var r=commonManger.comp2json(t.d),i=r.list;i&&n(i)},t=function(){var n=0;$("#listItems tbody tr").each(function(){n+=numeral($(this).children("td:eq(3)").text())*1});n>0?$("#SaveAll").removeClass("hidden"):$("#SaveAll").addClass("hidden");$("#AmountDhs").val(numeral(n).format("0,0"));n=numeral(n).format("0,0.0");$("#TotalAmountDhs").text(n)},v=function(){$("#aspnetForm")[0].reset();$("#listItems tbody").html("");$("#TotalAmountDhs").text("0")},a=function(n){var t={actionName:"ReceiptVouchers_SelectRow",value:n};dataService.callAjax("Post",JSON.stringify(t),sUrl+"GetData",l,commonManger.errorException)};return{Init:i}}();
var pageManager=pageManager||{},pageManager=function(){var n="",t=null,i=null,u=function(){h();s();f()},f=function(){$("#btnSearchAll").click(function(u){u.preventDefault();n=$("#AuctionType").val();t=commonManger.dateFormat($("#From").val());i=commonManger.dateFormat($("#To").val());r()});$(".bntCancelInvoice").click(function(n){n.preventDefault();var t={id:$("#AuctionCommID").val(),reason:$("#DeleteReason").val(),fun:"AuctionCommissions_Delete",names:["ID","Reason"]},i={actionName:t.fun,names:t.names,values:[t.id,t.reason]};t.reason!=""?dataService.callAjax("Post",JSON.stringify(i),sUrl+"saveData",e,commonManger.errorException):($("#DeleteReason").focus(),commonManger.show("بيانات مطلوبه:","يرجي إدخال سبب الإلغاء."))})},e=function(n){n=n.d;n.Status&&(commonManger.showMessage("تم الحذف بنجاح:","تمت عملية الحذف بنجاح."),$("#cancelModal").modal("hide"),r())},o=function(n,t){for(var i=0;i<n.length;i++)$("#"+t).append($("<option><\/option>").attr("value",n[i].AuctionTypeID).text(n[i].AuctionTypeName));$("#"+t).chosen().trigger("chosen:updated").trigger("liszt:updated")},s=function(){dataService.callAjax("Post",JSON.stringify({actionName:"AuctionCommissions_Properties",value:""}),sUrl+"GetData",function(n){var t=commonManger.comp2json(n.d),i=t.list;o(i,"AuctionType")},commonManger.errorException)},r=function(){$("#listItems").DataTable().draw()},h=function(){var r=$("#listItems").DataTable({sDom:"<'row-fluid'<'span6'l><'span6 lft-pane'BT>r>t<'row-fluid'<'span6'i><'span6'p>>",buttons:[{extend:"csv",text:"تصدير إكسيل"},{extend:"copy",text:"نسـخ"},{text:"طباعة",action:function(){$(".dataTables_length,.form-horizontal").closest("div.row-fluid").addClass("hidden-print");window.print()}}],bProcessing:!0,bServerSide:!0,responsive:!0,bRetrieve:!1,bDestroy:!0,sAjaxSource:"AuctionCommissionView.aspx/LoadData",fnServerParams:function(r){r.push({name:"auction",value:n},{name:"From",value:t},{name:"To",value:i})},fnServerData:function(n,t,i){dataService.callAjax("GET",t,n,function(n){commonManger.setData2Grid(n,t.sEcho,i)},commonManger.errorException)},footerCallback:function(){var n=this.api(),t=n.column(5).data().reduce(function(n,t){return numeral().unformat(n)+numeral().unformat(t)},0),i=n.column(6).data().reduce(function(n,t){return numeral().unformat(n)+numeral().unformat(t)},0);$(n.column(5).footer()).html(numeral(t).format("0,0.00"));$(n.column(6).footer()).html(numeral(i).format("0,0.00"))},iDisplayLength:50,aaSorting:[],aoColumns:[{mDataProp:"AuctionCommID",bSortable:!0,mData:function(n){return'<a title="طباعه" href="AuctionCommissionPrint.aspx?id='+n.AuctionCommID+'">'+n.AuctionCommID+"<\/a>"}},{mData:function(n){return commonManger.dateFormat(n.InvoiceDate,"YYYY/M/D","DD/MM/YYYY")},bSortable:!0},{mDataProp:"AuctionTypeName",bSortable:!0},{mDataProp:"ExchangeCompanyNameAr",bSortable:!0,mData:function(n){return n.CheckNo?n.DeskInvoice?n.ExchangeCompanyNameAr:'<a href="AuctionCommissionPrint.aspx?id='+n.AuctionCommID+'&review=1">تصفير الحوالة<\/a>':"---"}},{mDataProp:"CheckNo",bSortable:!0,mData:function(n){var t='<a title="طباعة السند" href="ReceiptPaymentsPrint.aspx?id='+n.CheckNo+'">'+n.CheckNo+"<\/a>";return n.CheckNo?t:'<a href="ReceiptPaymentsAdd.aspx?acmount='+parseFloat(n.CommAmountDhs).toFixed()+"&ids="+n.AuctionCommID+'">سند صرف<\/a>'}},{mDataProp:"CommAmount",bSortable:!1,mData:function(n){return numeral(n.CommAmount).format("0,0.00")}},{mDataProp:"CommAmountDhs",bSortable:!1,mData:function(n){return numeral(n.CommAmountDhs).format("0,0.00")}},{bSortable:!1,sClass:"hidden-print",mData:function(n){var t=' <a href="AuctionCommissionAdd.aspx?id='+n.AuctionCommID+'" class="btn btn-mini btn-info" data-rel="tooltip" title="تعديل"><i class="icon-edit"><\/i><\/a>',i=commonManger.fullRoles();return'<a href="AuctionCommissionPrint.aspx?id='+n.AuctionCommID+'" class="btn btn-mini btn-grey" data-rel="tooltip" title="طبــاعه"><i class="icon-print icon-only"><\/i><\/a>'+(n.CheckNo?"":t+(i?' <button class="btn btn-mini btn-danger remove" data-rel="tooltip" title="حــذف"><i class="icon-remove icon-only"><\/i><\/button>':""))}}]});$("#listItems tbody").delegate("tr button","click",function(n){n.preventDefault();var i=$(this),u=i.closest("tr"),t;u!=null&&i.hasClass("remove")&&(t=r.row(u).data(),$("#DeleteReason").val(""),$("#AuctionCommID").val(t.AuctionCommID),$("#CommAmount").val(t.CommAmount),$("#InvoiceDate").val(commonManger.formatJSONDate(t.InvoiceDate)),$("#cancelModal").modal("show"))})};return{Init:u}}();
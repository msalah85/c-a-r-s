var ShipperExpensesManager=ShipperExpensesManager||{},ShipperExpensesManager=function(){"use strict";var i=$("#listItems").DataTable(),u="aspnetForm",s="ShippingExpenses.aspx/SaveShippExpense",n={shipper:$("#ShipperSearch").val()!==""?$("#ShipperSearch").val():"",type:$("#expenseTypeSearch").val()!==""?$("#expenseTypeSearch").val():"",distin:$("#distinationSearch").val()!==""?$("#distinationSearch").val():""},h=function(){y();c()},c=function(){$(document).delegate("#listItems tbody tr button.clickMe","click",function(n){var u,f,r;if(n.preventDefault(),u=$(this),f=u.closest("tr"),f!==null)if(u.hasClass("edit"))r=i.row(f).data(),$("#aspnetForm select[id$=ExpenseTypeID]").val(r.ExpenseTypeID),t($("#aspnetForm select[id$=ExpenseTypeID]").val()),$("#aspnetForm #ShipperExpenseID").val(r.ShipperExpenseID),$("#aspnetForm #NavigationCo").val(r.NavigationCoID),$("#aspnetForm #ExpensesCharge").val(numeral(r.ExpensesCharge).format("0.00")),$("#aspnetForm select[id$=ShipCompanyID]").val(r.ShipCompanyID),$("#aspnetForm select[id$=DistinationID]").val($(".title").data("destinationID")),$("#aspnetForm select[id$=CarsNo]").val(r.CarsNo),$("#aspnetForm select[id$=ContainerSize]").val(r.ContainerSize),commonManger.showPopUpDialog("تعديل المصروف","edit","ShipExpenseModal");else u.hasClass("remove")&&DeleteConfirmation(function(){r=i.row(f).data();commonManger.deleteData("anyThing",a,commonManger.errorException,"ShipperExpenses","ShipperExpenseID",r.ShipperExpenseID)})});$("#btnAddNew").on("click",function(){$("#ExpenseTypeID").val("");$("#"+u+" input").val("0");$("#ShipperExpenseID").val("0");commonManger.showPopUpDialog("اضافة مصروف","insert","ShipExpenseModal")});$("table tbody a[data-action=collapse]").live("click",function(n){n.preventDefault();var i=$(this).closest("tr").find("input[type=hidden]").val(),t=$(this).find("i");t.hasClass("icon-chevron-up")?($("table tbody tr[data-id=comp-"+i+"]").hide("slow"),t.addClass("icon-chevron-down").removeClass("icon-chevron-up")):($("table tbody tr[data-id=comp-"+i+"]").show("slow"),t.addClass("icon-chevron-up").removeClass("icon-chevron-down"))});$("table tbody form select[name=ExpenseTypeID]").live("change",function(){var t=$(this).val(),n=$(this).closest("form");n.children("[name=NavigationCoID],[name=ContainerSize],[name=CarsNo],[name=DistinationID]").prop("disabled",!0).val("");t==="3"?n.find("[name=NavigationCoID],[name=DistinationID]").prop("disabled",!1):t==="2"?n.children("[name=NavigationCoID],[name=ContainerSize],[name=DistinationID]").prop("disabled",!1):t==="1"?n.children("[name=CarsNo]").prop("disabled",!1):t==="20"||n.children("[name=DistinationID]").prop("disabled",!1)});$("#aspnetForm #ExpenseTypeID").change(function(){t($(this).val())});$("#ShipExpenseModal .modal-footer .btn-success").on("click",function(n){var t,i,r,f;n.preventDefault();t={};t.ShipperExpenseID=$("#aspnetForm #ShipperExpenseID").val();t.ShipCompanyID=$("#aspnetForm #ShipCompanyID").val();t.ExpenseTypeID=$("#aspnetForm #ExpenseTypeID").val();t.DistinationID=$(".title").data("destinationID");t.ShowTypeID=1;t.ExpenseCalcType=1;t.ExpensesCharge=$("#aspnetForm #ExpensesCharge").val();i=$("#aspnetForm #NavigationCo").val();t.ExpenseTypeID==="1"||t.ExpenseTypeID==="20"||t.ExpenseTypeID==="21"?(t.DistinationID=0,t.ExpenseTypeID==="1"&&(t.CarsNo=$("#aspnetForm #CarsNo").val())):t.ExpenseTypeID==="2"?(t.ContainerSize=$("#aspnetForm #ContainerSize").val(),t.NavigationCoID=i):t.ExpenseTypeID==="3"&&(t.ContainerSize=$("#aspnetForm #ContainerSize").val(),t.NavigationCoID=i);r={scParam:t};f=v();f?commonManger.doWork("ShipExpenseModal",u,s,r,l,commonManger.errorException):commonManger.showMessage("حقول مطلوبة","برجاء ادخال جميع الحقول الاجبارية أولاً.")});$("#ShipperSearch").html($("#ShipCompanyID").html());$("#distinationSearch").html($("#DistinationID").html());$("#expenseTypeSearch").html($("#ExpenseTypeID").html());$("#btnSearchAll").click(function(t){t.preventDefault();n.shipper=$("#ShipperSearch").val()!==""?$("#ShipperSearch").val():"";n.type=$("#expenseTypeSearch").val()!==""?$("#expenseTypeSearch").val():"";n.distin=$("#distinationSearch").val()!==""?$("#distinationSearch").val():"";r()});$(".shippingDiv").on("click","button.btn-light",function(t){t.preventDefault();var i=$(this);$("button.btn-light.btn-light-border").removeClass("btn-light-border");i.addClass("btn-light-border");n.distin=i.data("id");n.shipper=i.closest("p").find(".btn-inverse[id]").data("id");$("#ShipCompanyID").val(n.shipper);$("#DistinationID").val(n.distin);w();f(i.closest("p").find(".btn-inverse[id]").text()+" - "+i.text(),n.distin);e(!0)});$("#finishEdting").click(function(n){n.preventDefault();e(!1);f("")})},f=function(n,t){$(".title").data("destinationID",t).text(n)},e=function(n){n?($("#expList").removeClass("hidden",1e3,"easeInBack").addClass("animateIn"),$("#expFilter").addClass("hidden")):($("#expFilter").removeClass("hidden",1e3,"easeInBack").addClass("animateIn"),$("#expList").addClass("hidden"))},o=function(){$('#aspnetForm input:not([type=radio]),#aspnetForm select:not([id="ShipCompanyID"])').val("");$("#ShipperExpenseID").val(0)},t=function(n){$("#divTrackingLines,#divContainerSize,#divCarsNo,#divDistinationID").addClass("hide").find("select").val("");n==="3"?$("#divTrackingLines,#divDistinationID").removeClass("hide"):n==="2"?$("#divContainerSize,#divTrackingLines,#divDistinationID").removeClass("hide"):n==="1"?$("#divCarsNo").removeClass("hide"):n==="20"||$("#divDistinationID").removeClass("hide")},l=function(n){n=n.d;$("#ShipExpenseModal").modal("hide");commonManger.showMessage("تمت عملية الإضافه بنجاح.",n.Message);n.Status&&(o(),t(0),r())},a=function(n){n=n.d;$("#ShipExpenseModal").modal("hide");commonManger.showMessage("تمت تنفيذ الإجراء بنجاح.",n.message);n.Status&&(o(),t(0),r())},v=function(){var n=!1;return $("#ExpensesCharge").val()!==""&&$("#ExpenseTypeID").val()!==""&&$("select[id$=ShipCompanyID]").val()!==""&&(n=!0),n},y=function(){dataService.callAjax("Post",JSON.stringify({actionName:"ShipperExpenses_Properties"}),sUrl+"GetDataDirect",p,commonManger.errorException)},p=function(n){var t=commonManger.comp2json(n.d),r=t.list,u=t.list1,f=t.list2,i="";i=$(f).map(function(n,t){return'<button class="btn btn-small btn-app btn-light radius-4 hidden" data-id="'+t.DistinationID+'">'+t.DistinationNameEn+"<\/button>"}).get().join("");$(r).each(function(n,t){var r="",f;r=$(u).map(function(n,r){if(r.ShipMainCompanyID===t.ShipMainCompanyID)return'<p><button id="shipper_'+r.ShipCompanyID+'" class="btn btn-app btn-inverse radius-4" data-id="'+r.ShipCompanyID+'">'+r.ShipCompanyNameEn+' <i class="icon-arrow-right pull-right smaller"><\/i><\/button>'+i+"<\/p>"}).get().join("");f='<dt><a href="#accordion'+(n+1)+'" aria-expanded="false" aria-controls="accordion'+(n+1)+'" class="'+t.Color+' accordion-title accordionTitle js-accordionTrigger">'+t.ShipMainCompanyNameEn+'<\/a><\/dt><dd class="accordion-content accordionItem is-collapsed" id="accordion'+(n+1)+'" aria-hidden="true">'+r+"<\/dd>";$("#accord").append(f);ShipperExpensesUtilitiy.Init()})},r=function(){$("#listItems").DataTable().draw()},w=function(){i=$("#listItems").DataTable({responsive:!0,bServerSide:!0,bRetrieve:!1,bDestroy:!0,ordering:!1,sDom:"t",sAjaxSource:sUrl+"LoadDataTablesXML",fnServerParams:function(t){t.push({name:"funName",value:"ShipperExpenses_SelectList"},{name:"names",value:"Shipper~Distin"},{name:"values",value:n.shipper+"~"+n.distin})},fnServerData:function(n,t,i){dataService.callAjax("GET",t,n,function(n){commonManger.setData2Grid(n,t.sEcho,i)},commonManger.errorException)},iDisplayLength:100,aaSorting:[[0,"asc"]],drawCallback:function(){$("a.editable").editable({validate:function(n){return $.trim(n)===""?"مطلوب.":isNaN(n)?"أرقام فقط.":void 0},url:function(n){return n.table=$(this).data("table"),n.id=$(this).data("id"),$.ajax({type:"POST",url:sUrl+"InlineEdit",data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json",async:!0,cache:!1,timeout:1e4,success:function(){commonManger.showMessage("تم الحفظ:","تم حفظ قيمة المصروف بنجاح.")},error:function(){commonManger.showMessage("خطأ:","لقد حدث خطأ فى تنفيذ الإجراء.")}})}})},rowCallback:function(n,t){$(n).attr("data-id","comp-"+t.ShipCompanyID)},aoColumns:[{mDataProp:"ExpenseTypeNameAr",bSortable:!1},{mDataProp:"NavigationCoName",bSortable:!1,mData:function(n){return n.NavigationCoName?n.NavigationCoName:""}},{mDataProp:"ContainerSize",bSortable:!1,mData:function(n){return n.ContainerSize?n.ContainerSize:""}},{mDataProp:"CarsNo",bSortable:!1,mData:function(n){return n.CarsNo?n.CarsNo:""}},{mDataProp:"ExpensesCharge",bSortable:!1,mData:function(n){return'<a title="تعديل المبلغ" data-type="text" data-id="ShipperExpenseID" data-pk="'+n.ShipperExpenseID+'" data-table="ShipperExpenses" data-name="ExpensesCharge" class="editable" href="#" data-placeholder="أدخل المبلغ">'+numeral(n.ExpensesCharge).format("0.00")+"<\/a>"}},{bSortable:!1,sClass:"hidden-print",mData:function(){return'<button class="btn btn-minier btn-info edit clickMe" data-rel="tooltip" data-placement="top" data-original-title="تعديل"><i class="icon-edit"><\/i><\/button> <button class="btn btn-minier btn-danger remove clickMe" data-rel="tooltip" data-placement="top" data-original-title="حــذف"><i class="icon-remove"><\/i><\/button>'}}]})};return{Init:h,showHideLines:t}}();ShipperExpensesManager.Init();
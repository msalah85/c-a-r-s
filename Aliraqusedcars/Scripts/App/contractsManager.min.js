var contractManager=function(){var n={listBody:$("#listItems tbody"),saveAll:$("#SaveAll"),removeAll:$("#DeleteAll"),masterControls:{ClientCommID:$("#ClientCommID"),ClientID:$("#ClientID"),DistinationID:$("#DistinationID"),CommTypeID:$("#CommTypeID"),ShippingCalcID:$("#ShippingCalcID"),ExtraCash:$("#ExtraCash"),ExtraCredit:$("#ExtraCredit"),CommissionCash:$("#CommissionCash"),CommissionCredit:$("#CommissionCredit"),LoadingOFContainer:$("#LoadingOFContainer"),CustomsContainer:$("#CustomsContainer"),CarsNo:$("#CarsNo"),Notes:$("#Notes"),ExtraCreditList:$("#ExtraCreditList")},detailsControls:{ClientTowingID:0,ClientCommID:0,RegionID:0,Towing:0,Partitioning:0,LoadingOF:0,Customs:0,Extra:0},searchParam:["id","cid","dist","cotype","catype"],copyControls:{distin:$("#DistIDCopy"),client:$("#ClientIDCopy"),btnCopy:$("#btn-getCopy"),copyContBtn:$(".add-copy")},repeatControls:{btn:$("#btn-startRepeat"),amount:$("#Amount"),columnIndex:$("#repeatIndex"),startRepeatBtn:$(".repeat-plus"),isPlusAmmount:$("#plusAmount")}},i=function(){var t=commonManger.getQueryStrs(),i=[t.id?t.id:"",t.cid?t.cid:"",t.dist?t.dist:"",t.cotype?t.cotype:"",t.catype?t.catype:"",],u={actionName:"ClientContract_Select",names:n.searchParam,values:i};r(t.id&&t.id!==""?!0:!1);dataService.callAjax("Post",JSON.stringify(u),sUrl+"GetDataList",f,commonManger.errorException)},r=function(n){n&&$("#DeleteAll").removeClass("hidden")},u=function(){$(".money").val(function(){return numeral($(this).val()).format("0")});$("textarea").trigger("autosize")},f=function(i){var f=commonManger.comp2json(i.d),r=f.list,e=f.list1;r&&($.each(r,function(n,t){$("#"+n).text(t);$("#"+n).val(t)}),u(),$("#DistinationNameAr").prepend('<img width="25px" src="/App_Themes/iraq/images/'+r.DistinationNameAr+'.jpg"> '),isMoveExtraCommList()&&$(".ExtraCreditToMove").prependTo(".movedExtraCredit"),r.CommTypeID==="1"?($(".basicContract").removeClass("hidden"),$(".listContract").addClass("hidden")):e&&(t(e),$(".repeat-plus").removeClass("hidden"),n.masterControls.ClientCommID.val()==0&&n.copyControls.copyContBtn.closest("div").removeClass("hidden")))},t=function(t){var i=$(t).map(function(t,i){n.detailsControls.Towing=(i.Towing?numeral(i.Towing).format("0"):0)*1;n.detailsControls.Partitioning=(i.Partitioning?numeral(i.Partitioning).format("0"):0)*1;n.detailsControls.LoadingOF=(i.LoadingOF?numeral(i.LoadingOF).format("0"):0)*1;n.detailsControls.Customs=(i.Customs?numeral(i.Customs).format("0"):0)*1;n.detailsControls.Extra=(i.Extra?numeral(i.Extra).format("0"):0)*1;var r=n.detailsControls.Towing+n.detailsControls.Partitioning+n.detailsControls.LoadingOF+n.detailsControls.Customs+n.detailsControls.Extra;return'<tr><td class="center" data-id="'+(i.ClientTowingID?i.ClientTowingID:0)+'" data-regionid="'+i.RegionID+'">'+(t+1)+"<\/td><td>"+i.RegionEn+'<\/td><td class="edit"><input name="Towing" required class="input-block-level form-control" type="text" value="'+n.detailsControls.Towing+'" /><\/td><td class="edit"><input name="Partitioning" required class="input-block-level form-control" type="text" value="'+n.detailsControls.Partitioning+'" /><\/td><td class="edit"><input name="LoadingOF" required class="input-block-level form-control" type="text" value="'+n.detailsControls.LoadingOF+'" /><\/td><td class="edit"><input name="Customs" required class="input-block-level form-control" type="text" value="'+n.detailsControls.Customs+'" /><\/td><td class="edit"><input name="Extra" required class="input-block-level form-control" type="text" value="'+n.detailsControls.Extra+'" /><\/td><td>'+r+"<\/td><\/tr>"}).get();n.listBody.append(i);fireGridEvents()};return fireGridEvents=function(){$("input[type=text]").on("focus click",function(){$(this).select()});$("#listItems td input[type=text]").bind("keydown","up",function(){var t=$(this).closest("td").index(),n=$(this).closest("tr").prev("tr").find("td:eq("+t+") input[type=text]");return n&&n.focus(),!1}).bind("keydown","down",function(){var t=$(this).closest("td").index(),n=$(this).closest("tr").next("tr").find("td:eq("+t+") input[type=text]");return n&&n.focus(),!1}).bind("keydown","right",function(){var t=$(this).closest("td").index(),n=$(this).closest("tr").find("td:eq("+(t-1)+") input[type=text]");return n&&n.focus(),!1}).bind("keydown","left",function(){var t=$(this).closest("td").index(),n=$(this).closest("tr").find("td:eq("+(t+1)+") input[type=text]");return n&&n.focus(),!1})},Init=function(){i();pageEventsHandlar()},pageEventsHandlar=function(){n.listBody.delegate('input[type="text"]',"keyup change",function(){var n=$(this).closest("tr"),t=0;n.find('input[type="text"]').each(function(){$.isNumeric(this.value)&&(t+=parseFloat(this.value))});n.find("td:eq(7)").text(numeral(t).format("0"))});n.saveAll.on("click",function(n){n.preventDefault();startSaveContract()});n.removeAll.click(function(n){n.preventDefault()});n.removeAll.on("click",function(n){n.preventDefault();bootbox.confirm("هل أنت متأكد من إيقاف العقد الحالى للعميل؟",function(n){n&&removeContract()})});n.copyControls.distin.change(function(){var n=$(this).val();n!=""&&getClients4Copy()});n.copyControls.btnCopy.click(function(n){n.preventDefault();startCopyContract()});n.repeatControls.startRepeatBtn.click(function(){var t=$(this).closest("th").index();n.repeatControls.columnIndex.val(t);n.repeatControls.amount.val(0);n.repeatControls.amount.focus();n.repeatControls.isPlusAmmount.prop("checked",!1)});n.repeatControls.btn.click(function(n){n.preventDefault();startRepeatAmountOnColumn()})},startRepeatAmountOnColumn=function(){var t={amount:n.repeatControls.amount.val(),index:n.repeatControls.columnIndex.val(),isPlus:n.repeatControls.isPlusAmmount.is(":checked")?!0:!1,sumTowings:$("#listItems tbody tr").map(function(){var n=$(this).find("td:eq(2) input[type=text]").val();if($.isNumeric(n)&&n*1>0)return n}).get()};$.isNumeric(t.amount)&&t.index>0?n.listBody.find("tr").each(function(){var n=$(this).find("td:eq("+t.index+") input[type=text]"),i=$(this).find("td:eq(2) input[type=text]");n&&(t.isPlus&&n.val()*1>0?n.val(function(){return t.amount*1+n.val()*1}).change():i&&(t.sumTowings.length!==0||t.index!=6||t.isPlus?i.val()*1>0&&n.val(t.amount).change():n.val(t.amount).change()))}).promise().done(function(){$(".modal").modal("hide")}):(commonManger.showMessage("حقول مطلوبة","يرجي التحقق من القيمة أولاً."),n.repeatControls.amount.focus())},startCopyContract=function(){var t={id:n.copyControls.client.val()!=""?n.copyControls.client.val():"",functionName:"ClientContractList_Copy"};t.id!=""?(dto={actionName:t.functionName,names:["id"],values:[t.id]},dataService.callAjax("Post",JSON.stringify(dto),sUrl+"GetDataList",rebuildContract,commonManger.errorException)):commonManger.showMessage("بيانات مطلوبة","برجاء اختيار العميل وجهة الوصول أولاً.")},rebuildContract=function(i){var u=commonManger.comp2json(i.d),r=u.list;$(".modal").modal("hide");r?(n.listBody.html(""),t(r)):commonManger.showMessage("خطأ فى تحميل العقد","يرجي التأكد من عقد العميل أولاً.")},getClients4Copy=function(t){var i={actionName:"ClientContractList_ToCopy",names:["dist","catype"],values:[t,n.masterControls.ShippingCalcID.val()]};dataService.callAjax("Post",JSON.stringify(i),sUrl+"GetDataList",bindClientsList,commonManger.errorException)},bindClientsList=function(t){var f=commonManger.comp2json(t.d),r=f.list,i=$("<option />"),u;n.copyControls.client.find("option").remove();n.copyControls.client.append(i.val("").text("جاري التحميل..."));r?(u=$(r).map(function(n,t){return $("<option />").val(t.ClientCommID).text(t.full_name)}).get(),n.copyControls.client.append(i.val("").text("")),n.copyControls.client.append(u)):n.copyControls.client.html("").append(i.val("").text(""))},isMoveExtraCommList=function(){return n.masterControls.CommTypeID.val()==2&&n.masterControls.ShippingCalcID.val()==1},applyValidation=function(){var t=!1;return n.masterControls.ClientID.val()>0&&n.masterControls.DistinationID.val()>0&&n.masterControls.ShippingCalcID.val()>0&&n.masterControls.CommTypeID.val()>0&&(t=!0),t},startSaveContract=function(){var t=[],i=[],r=[],u=[],f;$.each(n.masterControls,function(n,r){i.push(n);t.push(r.val())});$.each(n.detailsControls,function(n){r.push(n)});n.listBody.children("tr").each(function(t,i){var r={ClientTowingID:$(i).find("td:eq(0)").data("id"),ClientCommID:n.masterControls.ClientCommID.val(),RegionID:$(i).find("td:eq(0)").data("regionid"),Towing:$(i).find("input:eq(0)").val(),Partitioning:$(i).find("input:eq(1)").val(),LoadingOF:$(i).find("input:eq(2)").val(),Customs:$(i).find("input:eq(3)").val(),Extra:$(i).find("input:eq(4)").val()},f;r.RegionID>0&&(f=r.ClientTowingID+","+r.ClientCommID+","+r.RegionID+","+r.Towing+","+r.Partitioning+","+r.LoadingOF+","+r.Customs+","+r.Extra,u.push(f))});applyValidation()?(f={values:t,actionName:"ClientCommissons_Save",Parm_names:i,fieldsDetails:r,valuesDetails:u,flage:"1"},dataService.callAjax("Post",JSON.stringify(f),mainServiceUrl+"SaveDataMasterDetails",succesSaveCallBack,commonManger.errorException)):commonManger.showMessage("بيانات مطلوبة:","برجاء التأكد من ادخال جميع بنود العقد أولاً.")},succesSaveCallBack=function(n){bootbox.alert(n.d.message);commonManger.showMessage("تم الحفظ بنجاح:",n.d.message);n.d.ID>0&&setTimeout(function(){document.location.href="clients.aspx?id="+n.d.ID},3e3)},removeContract=function(){var t=n.masterControls.ClientCommID.val(),i,r;t!=""&&(i="ClientCommissons_Delete",r={actionName:i,names:["id"],values:[t]},dataService.callAjax("Post",JSON.stringify(r),sUrl+"saveData",successDeleteCallback,commonManger.errorException))},successDeleteCallback=function(n){n=n.d;bootbox.alert(n.message);n.ID>0&&setTimeout(function(){document.location.href="clients.aspx?id="+n.ID},3e3)},{Init:Init}}();contractManager.Init();
//# sourceMappingURL=contractsManager.min.js.map

var CarsViewManager=CarsViewManager||{},CarsViewManager=function(){var t=$.localStorage,n={CarNo:"",Arrived:"",Owner:"",Distination:""},f=function(){l();s();e()},e=function(){$("#viewAllCars").click(function(n){n.preventDefault();u();i()});$("#SearchAll").click(function(n){n.preventDefault();h();i()});$("#allIraqCars").click(function(n){n.preventDefault();u();c();i()})},o=function(n){var s=LZString.decompressFromUTF16(n.d),f=$.parseXML(s),e=$.xml2json(f).list,o=$.xml2json(f).list1,i=t.isSet("srchAvCars")?t.get("srchAvCars"):null,u;e&&(u=$(e).map(function(n,t){return $("<option "+(i&&i.Distination===t.DistinationID?"selected":"")+" />").val(t.DistinationID).text(t.DistinationNameAr)}).get(),$("#Distination").append(u));o&&(u=$(o).map(function(n,t){return $("<option "+(i&&i.Owner===t.ClientID?"selected":"")+" />").val(t.ClientID).text(t.full_name)}).get(),$("#Owner").append(u),r());i&&i.CarNo!==""&&$("#CarNo").val(i.CarNo)},r=function(){$(".chzn-select").trigger("chosen:updated")},s=function(){dataService.callAjax("Post",JSON.stringify({actionName:"CarsData_Properties"}),sUrl+"GetDataDirect",o,commonManger.errorException)},h=function(){n={CarNo:$("#CarNo").val()!=""?$("#CarNo").val():"",Arrived:$("#Arrived").val()!=""?$("#Arrived").val():"",Owner:$("#Owner").val()!=""?$("#Owner").val():"",Distination:$("#Distination").val()!=""?$("#Distination").val():""};t.set("srchAvCars",n)},c=function(){$("#aspnetForm input,#aspnetForm  select").val("");$("#Owner").val("1");r();n.Owner="1";t.set("srchAvCars",n)},u=function(){n={CarNo:"",Arrived:"",Owner:"",Distination:""};t.remove("srchAvCars")},i=function(){$("#listItems").DataTable().draw(!1)},l=function(){var i=$("#listItems").DataTable({sDom:"<'row-fluid tbl-head-options'<'span6'l><'span6 lft-pane'BT>r>t<'row-fluid'<'span6'i><'span6'p>>",deferRender:!0,stateSave:!0,bFilter:!1,buttons:[{extend:"csv",text:"تصدير إكسيل"},{extend:"copy",text:"نسـخ"},{text:"طباعة",action:function(){window.print()}}],language:{search:"_INPUT_",searchPlaceholder:"رقم السيارة - اللوت"},bDestroy:!0,bServerSide:!0,responsive:!0,sAjaxSource:sUrl+"LoadDataTablesXML",fnServerParams:function(i){i.push({name:"funName",value:"CarsData_SelectCarsList"},{name:"names",value:"CarNo~Arrived~Distin~Owner"});var r=t.isSet("srchAvCars")?t.get("srchAvCars"):null;r===null?i.push({name:"values",value:n.CarNo+"~"+n.Arrived+"~"+n.Distination+"~"+n.Owner}):i.push({name:"values",value:r.CarNo+"~"+r.Arrived+"~"+r.Distination+"~"+r.Owner})},fnServerData:function(n,t,i){dataService.callAjax("GET",t,n,function(n){commonManger.setData2Grid(n,t.sEcho,i)},commonManger.errorException)},fnRowCallback:function(n,t){t.WorkingStatusID===4&&$(n).addClass("warning").attr("title","سيارة سكراب")},iDisplayLength:25,aaSorting:[[0,"desc"]],aoColumns:[{mDataProp:"CarID",bSortable:!0,sClass:"text-center"},{mDataProp:"MainPicture",bSortable:!1,sClass:"text-center",mData:function(n){return n.MainPicture?'<a title="صور السيارة رقم: '+n.CarID+'" href="images.aspx?id='+n.CarID+'"><img alt="car" src="/public/cars/'+n.CarID+"/_thumb/"+n.MainPicture+'" /><\/a>':'<img alt="car" src="/public/cars/noimage.gif" /><\/a>'}},{mDataProp:"ChassisNo",bSortable:!0,mData:function(n){return'<a title="تفاصيل للسيارة" href="CarDetailsPrint.aspx?id='+n.CarID+'&any=1" >'+n.MakerNameEn+" - "+n.TypeNameEn+" - "+n.Year+"<\/a>"}},{mDataProp:"LotNo",bSortable:!0},{mDataProp:"full_name",bSortable:!0},{mDataProp:"DistinationNameAr",bSortable:!1,mData:function(n){return n.Arrived||n.DistinationNameEn.toLowerCase()=="gulfauto"?'<img src="/App_Themes/iraq/images/'+n.DistinationNameEn+'.jpg" width="25" /> '+n.DistinationNameAr:'<img src="/App_Themes/iraq/images/USA.jpg" width="25" /> أمريكا'}},{mDataProp:"PayPrice",bSortable:!1,mData:function(n){return numeral(n.PayPrice).format("0,0.0")}},{sClass:"text-center",bSortable:!1,mData:function(n){return'<a href="InvoiceSaleAdd.aspx?id='+n.CarID+'" class="btn btn-minier btn-success" data-rel="tooltip" title="بــيع" data-original-title="انشاء فاتورة بــيع">بيع<\/a> '}}]})};return{Init:f}}();
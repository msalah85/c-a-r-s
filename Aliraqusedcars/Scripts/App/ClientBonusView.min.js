var pageManager=pageManager|{},pageManager=function(){var n="",t="",i="",u=function(){r();f()},f=function(){$("#SearchAll").on("click",function(u){u.preventDefault();n=$("#ClientID").val();t=commonManger.dateFormat($("#From").val())!=""?commonManger.dateFormat($("#From").val()):"";i=commonManger.dateFormat($("#To").val())!=""?commonManger.dateFormat($("#To").val()):"";r()});$("#cancelModal .modal-footer .btn-danger").on("click",function(n){n.preventDefault();var t=$("#BonusID").val(),i=$("#DeleteReason").val(),r=function(n){n=n.d;$(".modal").modal("hide");commonManger.showMessage("تم تنفيذ الإجراء بنجاح.",n.message);n.Status&&$("#listItems").DataTable().draw()};if(t&&i!=""){var u=[t,i],f={actionName:"ClientsBonus_Delete",names:["BonusID","Reason"],values:u};dataService.callAjax("Post",JSON.stringify(f),sUrl+"saveData",r,commonManger.errorException)}else commonManger.showMessage("حقول مطلوبة","يرجي ادخال سبب الإلغاء أولاً."),$("#DeleteReason").focus()})},e=function(){var n=commonManger.fullRoles();return n?' <button class="btn btn-minier btn-danger remove" data-rel="tooltip" data-placement="top" data-original-title="حــذف"><i class="icon-remove"><\/i><\/button> ':""},r=function(){var r=$("#listItems").DataTable({sDom:"<'row-fluid'<'span6'l><'span6 lft-pane'BT>r>t<'row-fluid'<'span6'i><'span6'p>>",buttons:[{extend:"csv",text:"تصدير إكسيل"},{text:"طباعة",action:function(){$(".dataTables_length,.form-horizontal").closest("div.row-fluid").addClass("hidden-print");window.print()}}],bDestroy:!0,bServerSide:!0,responsive:!0,stateSave:!0,sAjaxSource:sUrl+"LoadDataTablesXML",fnServerParams:function(r){var u=n+"~"+t+"~"+i;r.push({name:"funName",value:"ClientsBonus_SelectList"},{name:"names",value:"ClientID~From~To"},{name:"values",value:u})},fnServerData:function(n,t,i){dataService.callAjax("GET",t,n,function(n){commonManger.setData2Grid(n,t.sEcho,i)},commonManger.errorException)},fnFooterCallback:function(n,t){for(var r=0,i=0;i<t.length;i++)r+=t[i].Amount*1;$("strong.debit").text(numeral(r).format("0,0"))},aaSorting:[],iDisplayLength:50,aoColumns:[{mDataProp:"BonusID",bSortable:!0,type:"number"},{mDataProp:"AddDate",bSortable:!0,mData:function(n){return commonManger.formatJSONDateCal(n.AddDate)}},{mDataProp:"full_name",bSortable:!1,mData:function(n){return'<a href="ClientCars.aspx?id='+n.ClientID+'">'+n.full_name+"<\/a>"}},{mDataProp:"Amount",bSortable:!1,mData:function(n){return numeral(n.Amount).format("0,0")}},{mDataProp:"AmountDhs",bSortable:!1,mData:function(n){return numeral(n.AmountDhs).format("0,0.00")}},{mDataProp:"Notes",bSortable:!1},{sClass:"hidden-print",bSortable:!1,mData:function(n){var t="";return n.Revised==="false"&&(t='<a class="btn btn-minier btn-info" href="ClientBonusAdd.aspx?id='+n.BonusID+'" title="تعديل"><i class="icon-edit"><\/i><\/a> '),t+'<a href="ClientBonusPrint.aspx?id='+n.BonusID+'" class="btn btn-minier btn-success" data-rel="tooltip" title="طباعة" data-original-title="طباعة"><i class="icon-print"><\/i><\/a>'+e()}}]});$("#listItems tbody").delegate("tr button","click",function(n){var i,u,t,f,e;n.preventDefault();i=$(this);u=i.closest("tr").index();u!=null&&i.hasClass("remove")&&(f="إلغاء إيداع عميل",e="cancelModal",t=r.row(u).data(),$("#BonusID").val(t.BonusID),$("#AddDate").val(commonManger.formatJSONDateCal(t.AddDate)),$("#Amount").val(numeral(t.Amount).format("0,0")),commonManger.showPopUpDialog(f,"",e))})};return{Init:u}}();
var ClientsPayments=ClientsPayments||{},ClientsPayments=function(){var t=!1,r=function(){s();u()},u=function(){$("#ClientID,#EmpID,#OutsideMemberID").on("change",function(){$(this).val()!==""&&$("#ToName").val($(this).find("option:selected").text())});$("#ReceiptTypeID input").change(function(){$("#divClientID,#divOutsideMemberID,#divEmpID").addClass("hidden");$("#ClientID,#EmpID,#OutsideMemberID").val("").trigger("chosen:updated");$(this).val()==2?$("#divClientID").removeClass("hidden"):$(this).val()==3?$("#divEmpID").removeClass("hidden"):$(this).val()==4&&$("#divOutsideMemberID").removeClass("hidden")});$("#PayTypeID input").change(function(){$(".bank-options,.exchange-options").addClass("hidden");$(".bank-options input,.bank-options select,.exchange-options input,.exchange-options select").val("");$(".divBankRequired").text("*");$("#BankID,#BankCheckNo").attr("name","BankInfo").attr("required","");var n=$(this).val();n==2&&$(".bank-options").removeClass("hidden")});var n=commonManger.getUrlVars().id;n&&($(".page-header h1 span").html("تعديل"),h(n));$("#SaveAll").click(function(n){n.preventDefault();commonManger.disableControl("SaveAll",!0);var t=e(),i=$("#Amount").val(),r=$("#AmountDhs").val();t?parseFloat(r)>parseFloat(i)?commonManger.saveData("masterForm","masterForm",l,"","ReceiptPayments_Save","1",c):(commonManger.disableControl("SaveAll",!1),commonManger.showMessage("التحقق من البيانات:","برجاء ادخال جميع الحقول الاجبارية (*) <br>,وادخال المبلغ بالدرهم أكبر من المبلغ بالدولار.")):commonManger.disableControl("SaveAll",!1)});$("#AmountDhs").on("blur change",function(){var n=$("#AmountDhs").val();commonManger.num2Arabic(n,2);$.fn.afterSave=function(n){$("#AmountAlphabet").val(n.d)};n=n/3.667;t===!1&&$("#Amount").val(n.toFixed(2))});$("input[type=text]").on("focus click",function(){$(this).select()})},f=function(){var r=commonManger.getUrlVars(),o,s,h,c,l,u,f,e;r&&r.pamount?(u=r.ids,o=r.pamount,$("#IDs").val(u.length>0?u:0),$("#AmountDhs").val(o).change(),$("#AmountDhs,#AmountAlphabet").attr("readonly","readonly"),$("input[name='ReceiptTypeID'][value='5']").prop("checked",!0).change(),$("input[name='ReceiptTypeID']:not([value='5'])").each(function(){$(this).closest("label.lbl").addClass("hidden")}),$("#ExpenseTypeID option").length>0&&($("#ExpenseTypeID").val(13).closest("div.control-group").addClass("hidden"),n())):r&&r.samount?(u=r.ids,s=r.samount,$("#IDs").val(u.length>0?u:0),$("#AmountDhs").val(s).change(),$("#AmountDhs,#AmountAlphabet").attr("readonly","readonly"),$("input[name='ReceiptTypeID'][value='5']").prop("checked",!0).change(),$("input[name='ReceiptTypeID']:not([value='5'])").each(function(){$(this).closest("label.lbl").addClass("hidden")}),$("#ExpenseTypeID option").length>0&&($("#ExpenseTypeID").val(14).closest("div.control-group").addClass("hidden"),n())):r&&r.camount?(u=r.ids,h=r.camount,$("#IDs").val(u.length>0?u:0),$("#AmountDhs").val(h).change(),$("#AmountDhs,#AmountAlphabet").attr("readonly","readonly"),$("input[name='ReceiptTypeID'][value='5']").prop("checked",!0).change(),$("input[name='ReceiptTypeID']:not([value='5'])").each(function(){$(this).closest("label.lbl").addClass("hidden")}),$("#ExpenseTypeID option").length>0&&($("#ExpenseTypeID").val(15).closest("div.control-group").addClass("hidden"),n())):r&&r.salamount?(u=r.ids,c=r.salamount,$("#IDs").val(u.length>0?u:0),$("#AmountDhs").val(c).change(),$("#AmountDhs,#AmountAlphabet").attr("readonly","readonly"),$("input[name='ReceiptTypeID']:not([value='1'])").each(function(){$(this).closest("label.lbl").addClass("hidden")}),$("#ExpenseTypeID option").length>0&&($("#ExpenseTypeID").val(12).closest("div.control-group").addClass("hidden"),n())):r&&r.acmount?(u=r.ids,l=r.acmount,$("#IDs").val(u.length>0?u:0),$("#AmountDhs").val(l).change(),$("#AmountDhs,#AmountAlphabet").attr("readonly","readonly"),$("input[name='ReceiptTypeID'][value='5']").prop("checked",!0).change(),$("input[name='ReceiptTypeID']:not([value='5'])").each(function(){$(this).closest("label.lbl").addClass("hidden")}),$("#ExpenseTypeID option").length>0&&($("#ExpenseTypeID").val(16).closest("div.control-group").addClass("hidden"),n())):r&&r.rentamount?(u=r.ids,f=r.rentamount,$("#IDs").val(u.length>0?u:0),$("#AmountDhs").val(f).change(),$("#AmountDhs,#AmountAlphabet").attr("readonly","readonly"),$("input[name='ReceiptTypeID'][value='1']").prop("checked",!0).change(),$("input[name='ReceiptTypeID']:not([value='1'])").each(function(){$(this).closest("label.lbl").addClass("hidden")}),$("#ExpenseTypeID option").length>0&&($("#ExpenseTypeID").val(2).closest("div.control-group").addClass("hidden"),n()),i(u)):r&&r.emprentamount?(u=r.ids,f=r.emprentamount,$("#IDs").val(u.length>0?u:0),$("#AmountDhs").val(f).change(),$("#AmountDhs,#AmountAlphabet").attr("readonly","readonly"),$("input[name='ReceiptTypeID'][value='3']").prop("checked",!0).change(),$("input[name='ReceiptTypeID']:not([value='3'])").each(function(){$(this).closest("label.lbl").addClass("hidden")}),$("#ExpenseTypeID option").length>0&&($("#ExpenseTypeID").val(3).closest("div.control-group").addClass("hidden"),n()),i(u)):r&&r.cusd&&(e=r.ids,$("#IDs").val(e.length>0?e:0),$("#Amount").val(r.cusd),$("input[name='ReceiptTypeID'][value='2']").prop("checked",!0).change(),$("input[name='ReceiptTypeID']:not([value='2'])").each(function(){$(this).closest("label.lbl").addClass("hidden")}),$("#ClientID").val(e).change(),$("#ExpenseTypeID option").length>0&&($("#ExpenseTypeID").val(10).closest("div.control-group").addClass("hidden"),n()),n(),t=!0)},n=function(){$(".chzn-select").chosen({allow_single_deselect:!0,no_results_text:"اختـــر",search_contains:!1}).trigger("chosen:updated").trigger("liszt:updated")},e=function(){for(var i=!0,t=$("#masterForm :input:not(:hidden).required"),n=0;n<t.length;n++)($(t[n]).val()==""||$(t[n]).val()=="0")&&(i=!1,$(t[n]).focus());return i},o=function(t){var r=commonManger.comp2json(t.d),u=r.list,e=r.list1,o=r.list2,s=r.list3,h=r.list4,i;u&&(i=$(u).map(function(n,t){return $("<option />").val(t.BankID).text(t.BankName)}).get(),$("#BankID").append(i));e&&(i=$(e).map(function(n,t){return $("<option />").val(t.ClientID).text(t.full_name)}).get(),$("#ClientID").append(i));o&&(i=$(o).map(function(n,t){return $("<option />").val(t.UserID).text(t.UserFullName)}).get(),$("#EmpID").append(i));s&&(i=$(s).map(function(n,t){return $("<option />").val(t.ID).text(t.Name)}).get(),$("#OutsideMemberID").append(i));h&&(i=$(h).map(function(n,t){return $("<option />").val(t.ExpenseTypeID).text(t.ExpenseTypeName)}).get(),$("#ExpenseTypeID").append(i));n();f()},s=function(){dataService.callAjax("Post",JSON.stringify({actionName:"ReceiptPayments_Properties"}),sUrl+"GetDataDirect",o,commonManger.errorException)},h=function(t){var i={actionName:"ReceiptPayments_SelectRow",value:t};dataService.callAjax("Post",JSON.stringify(i),sUrl+"GetData",function(t){var r=commonManger.comp2json(t.d),i=r.list;i&&(i.ReceiptTypeID>1&&$("input[name='ReceiptTypeID'][value='"+i.ReceiptTypeID+"']").prop("checked",!0).change(),$("input[name='PayTypeID'][value='"+i.PayTypeID+"']").prop("checked",!0).change(),$("input[name='Revised'][value='"+i.Revised+"']").prop("checked",!0),$.each(i,function(n,t){$("#masterForm #"+n).val(t)}),$("#Amount,#AmountDhs").val(function(){return numeral($(this).val()).format("0.0")}),$(".date-picker").val(function(){return commonManger.formatJSONDateCal($(this).val())}),$("#EmpID").val(i.UserID),n())},commonManger.errorException)},i=function(t){var i={actionName:"RentDetails_One",value:t},r=function(t){var r=commonManger.comp2json(t.d),i=r.list;i&&($("#CheckNo").val(i.CheckNo),$("#BankDate").val(commonManger.formatJSONDateCal(i.DuDate)),$("#Notes").val(i.Notes),i.EmpID&&($("#EmpID").val(i.EmpID),$("#ToName").val(i.UserFullName),n()))};dataService.callAjax("Post",JSON.stringify(i),sUrl+"GetData",r,commonManger.errorException)},c=function(){},l=function(n){window.location.href="ReceiptPaymentsPrint.aspx?id="+n.ID};return{Init:r}}();
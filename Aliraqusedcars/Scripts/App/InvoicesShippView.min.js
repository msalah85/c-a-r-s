var pageManager=function(){var n="",t="",i="",r="",u="",f="",e="",o="",s=function(){y();h()},h=function(){$("#btnSearchAll").click(function(s){s.preventDefault();n=$("#Shipper").val();t=$("#ShipperMain").val();i=$("#Paid").val();r=commonManger.dateFormat($("#From").val());u=commonManger.dateFormat($("#To").val());f=$("#DistinationID").val();e=$("#ContainerNo").val();o=$("#InvoiceNo").val();commonManger.showOptionPrintTitle($("#Paid option:selected").text());a()});$(".payUndo").click(function(n){n.preventDefault();c()});$("#listItems tbody").delegate("tr a.remove","click",function(n){var i,t,r,u;n.preventDefault();i=$(this);t=i.closest("tr").index();t!==null&&(u=function(){r=pTable.fnGetData(t);var n=r.ShippInvoiceID;commonManger.deleteData("anyThing",commonManger.successDeleted,commonManger.errorException,"ShippInvoices","ShippInvoiceID",n)},DeleteConfirmation(u))});$("#listItems tbody").delegate("tr .op-acity:checkbox","change",function(n){n.preventDefault();var t=$(this);l(t)})},c=function(){$(".payNow,.payUndo").addClass("hidden");$("input[name$=ToCheck]").val("");$(".op-acity:checked").map(function(){return $(this).attr("checked",!1),this.value})},l=function(n){var t=$("input[name=shipperToCheck]"),r=n.attr("data-shipper"),i;if(t.val()!==""){if(t.val()!==r){commonManger.showMessage("خطأ بالاختيار","برجاء اختيار الفواتير التابعة لشاحن واحد.");n.removeAttr("checked");return}}else t.val(r);i=$("input[data-shipper]:checked").map(function(){return this.value}).get();$(".payNow").attr("href","ShipInvoicePaymentsDetails.aspx?sh="+t.val()+"&ids="+i.join(",")).find("span").text(i.length);$(".op-acity:checked").is(":checked")?$(".payNow,.payUndo").removeClass("hidden"):($(".payNow,.payUndo").addClass("hidden"),$("input[name$=ToCheck]").val(""))},a=function(){$("#listItems").DataTable().draw()},v=function(){var n=commonManger.fullRoles();return n?'<a class="btn btn-mini btn-danger remove" title="حــذف" href="javascript:void(0);"><i class="icon-trash icon-only"><\/i><\/a>':""},y=function(){var s=$("#listItems").DataTable({sDom:"<'row-fluid'<'span6'l><'span6 lft-pane'BT>r>t<'row-fluid'<'span6'i><'span6'p>>",buttons:[{extend:"csv",text:"تصدير إكسيل"},{extend:"copy",text:"نسـخ"},{text:"طباعة",action:function(){$(".dataTables_length,.form-horizontal").closest("div.row-fluid").addClass("hidden-print");window.print()}}],bServerSide:!0,responsive:!0,bRetrieve:!1,bDestroy:!0,sAjaxSource:sUrl+"LoadDataTablesXML",fnServerParams:function(s){var h=n+"~"+t+"~"+i+"~"+r+"~"+u+"~"+f+"~"+e+"~"+o;s.push({name:"funName",value:"ShippInvoicesDetails_List"},{name:"names",value:"Shipper~ShipperMain~Paid~From~To~DistinationID~ContainerNo~InvoiceNo"},{name:"values",value:h})},fnServerData:function(n,t,i){dataService.callAjax("GET",t,n,function(n){var f=commonManger.comp2json(n.d),u=f.list,r=f.list1,e={sEcho:t.sEcho?t.sEcho:0,iTotalRecords:r?r.CNT:0,iTotalDisplayRecords:r?r.CNT:0,aaData:$.isArray(u)?u:$.makeArray(u)};i(e);r&&$(".sum-total-all").text(numeral(r.TotalSum).format("0,0"))},commonManger.errorException)},drawCallback:function(){var i=this.api(),r=i.rows({page:"current"}).nodes(),f=null,o=$("#listItems thead").html(),e='<tr class="spacer"><td colspan="100%"><\/td>';i.column(0,{page:"current"}).data().each(function(n,t){f!==n&&($(r).eq(t).before('<\/tr><tr class="group alert alert-warning"><td colspan="100%">'+n+"<\/td><\/tr>"+o),f=n)});var u="",n=0,t=0;i.rows().every(function(i){var f=this.data();u!==""&&f.InvoiceNo!==u&&$(r).eq(n).after('<tr class="alert alert-info"><td class="sp-bord-btom" colspan="8"><span class="pull-left">إجمالى الفاتورة<\/span><\/td><td class="sp-bord-btom">'+numeral(t).format("0,0.0")+"<\/td><\/tr>"+e);u=f.InvoiceNo;n=i;t=f.TotalAmount});n>0&&t>0&&$(r).eq(n).after('<tr class="alert alert-info"><td class="sp-bord-btom" colspan="8"><span class="pull-left">إجمالى الفاتورة<\/span><\/td><td class="sp-bord-btom">'+numeral(t).format("0,0.0")+"<\/td><\/tr>"+e)},fnFooterCallback:function(n,t){for(var r=0,i=0;i<t.length;i++)r+=parseFloat(t[i].TotalCost)*1;$(n).find("th:eq(1)").html("<span>"+numeral(r).format("0,0.0")+"<\/span>")},iDisplayLength:50,aoColumns:[{mDataProp:"InvoiceNo",bVisible:!1,mData:function(n){var t="",i="";return n.IsEdit&&(t='<a class="btn btn-mini btn-info" title="تعديل" href="InvoiceShippingAdd.aspx?id='+n.ShippInvoiceID+'"><i class="icon-edit icon-only"><\/i><\/a> '+v()),n.Paid||(i='<input type="checkbox" data-shipper='+n.ShipMainCompanyID+" value="+n.ShippInvoiceID+' class="op-acity" />'),'<table class="sub-table"><tr><td>'+i+" رقم الحاوية: "+n.ContainerNo+"<\/td><td>تاريخ الوصول: "+commonManger.formatJSONDateCal(n.ArrivalDate)+"<\/td><td> الشاحن: "+n.ShipCompanyNameEn+" - "+n.DistinationNameAr+"<\/td><td>رقم الفاتورة: "+n.InvoiceNo+(n.Paid?' <a target="_blank" title="تفاصيل الحوالة" href="ShipInvoicePaymentsPrint.aspx?id='+n.Paid+"&cont="+n.ContainerNo+'">(مسدده)<\/a>':"")+"<\/td><td> تاريخ الفاتورة: "+commonManger.formatJSONDateCal(n.InvoiceDate)+'<div class="tools pull-left hidden-print"><a class="btn btn-mini btn-grey" title="طباعه" href="InvoiceShippingPrint.aspx?id='+n.ShippInvoiceID+'"><i class="icon-print icon-only"><\/i><\/a> '+t+"<\/div><\/td><\/tr><\/table>"}},{mDataProp:"TypeNameEn",bSortable:!1,mData:function(n){return'<a title="تفاصيل السيارة" href="CarDetailsPrint.aspx?id='+n.CarID+'">'+n.MakerNameEn+" - "+n.TypeNameEn+" - "+n.Year+"<\/a>"}},{mDataProp:"full_name",bSortable:!1,mData:function(n){return n.SaleClientName?n.SaleClientName:n.full_name}},{mDataProp:"ChassisNo",bSortable:!1},{mData:function(n){return numeral(n.Towing).format("0.0.00")},bSortable:!1},{mData:function(n){return numeral(n.Loading).format("0.0.00")},bSortable:!1},{mData:function(n){return numeral(n.SeaTrans).format("0.0.00")},bSortable:!1},{mData:function(n){return numeral(n.Partitioning).format("0.0.00")},bSortable:!1},{mData:function(n){return numeral(n.Extra).format("0.0.00")},bSortable:!1},{mDataProp:"TotalCost",bSortable:!1,mData:function(n){return numeral(n.TotalCost).format("0,0.0")}}]})};return{Init:s}}();
var pageManager=function(){var n=null,t=null,i=null,r=null,u=null,f=function(){a();h();e()},e=function(){$("#btnSearchAll").click(function(f){f.preventDefault();n=$("#Shipper").val();t=$("#Paid").val();i=commonManger.dateFormat($("#From").val());r=commonManger.dateFormat($("#To").val());u=$("#ContainerNo").val();commonManger.showOptionPrintTitle($("#Paid option:selected").text());l()});$(".payUndo").click(function(n){n.preventDefault();o()})},o=function(){$(".payNow,.payUndo").addClass("hidden");$("input[name$=ToCheck]").val("");$(".op-acity:checked").map(function(){return $(this).attr("checked",!1),this.value})},s=function(n,t){for(var i=0;i<n.length;i++)n[i].CustomsCompanyID>0&&$("#"+t).append($("<option />").attr("value",n[i].CustomsCompanyID).text(n[i].CustomsCompanyNameAr));$("#"+t).chosen().trigger("chosen:updated").trigger("liszt:updated")},h=function(){dataService.callAjax("Post",JSON.stringify({actionName:"CustomsInvoices_Properties2"}),sUrl+"GetDataDirect",function(n){var t=commonManger.comp2json(n.d),i=t.list;s(i,"Shipper")},commonManger.errorException)},c=function(n){var t=$("input[name=compToCheck]"),i=n.attr("data-comp"),r;if(t.val()!==""){if(t.val()!==i){commonManger.showMessage("خطأ بالاختيار","برجاء اختيار الفواتير التابعة لشاحن واحد.");n.removeAttr("checked");return}}else t.val(i);r=$("input[data-comp]:checked").map(function(){return this.value}).get().join(",");$(".payNow").attr("href","CustomspaymentsDetails.aspx?co="+t.val()+"&ids="+r);$(".op-acity:checked").is(":checked")?$(".payNow,.payUndo").removeClass("hidden"):($(".payNow,.payUndo").addClass("hidden"),$("input[name$=ToCheck]").val(""))},l=function(){$("#listItems").DataTable().draw()},a=function(){var f=$("#listItems").DataTable({sDom:"<'row-fluid'<'span6'l><'span6 lft-pane'BT>r>t<'row-fluid'<'span6'i><'span6'p>>",buttons:[{extend:"csv",text:"تصدير إكسيل"},{extend:"copy",text:"نسـخ"},{text:"طباعة",action:function(){$(".dataTables_length,.form-horizontal").closest("div.row-fluid").addClass("hidden-print");window.print()}}],bProcessing:!0,bDestroy:!0,bServerSide:!0,responsive:!0,sAjaxSource:"InvoicesCustomsView.aspx/LoadData",fnServerData:function(n,t,i){dataService.callAjax("GET",t,n,function(n){n.d.aaData=$.parseJSON(n.d.aaData);i(n.d);$(".sum-total-all").text(numeral(n.d.TotalSum).format("0,0"));$(".sum-total-all-dhs").text(numeral(n.d.TotalSumDhs).format("0,0"))},commonManger.errorException)},fnServerParams:function(f){f.push({name:"Shipper",value:n},{name:"Paid",value:t},{name:"From",value:i},{name:"Container",value:u},{name:"To",value:r})},fnFooterCallback:function(n,t){for(var r=0,u=0,i=0;i<t.length;i++)r+=t[i].TotalAmount*1,u+=t[i].TotalAmountDhs*1;$(n).find("th:eq(1)").text(numeral(r).format("0,0"));$(n).find("th:eq(2)").text(numeral(u).format("0,0"))},iDisplayLength:50,aoColumns:[{mDataProp:"CustomsInvoiceID"},{mDataProp:"InvoiceDate",mData:function(n){return commonManger.formatJSONDateCal(n.InvoiceDate)}},{mDataProp:"InvoiceNo"},{mDataProp:"CustomsCompanyNameAr"},{mDataProp:"ArrivalDate",bSortable:!1,mData:function(n){return commonManger.formatJSONDateCal(n.ArrivalDate)}},{mDataProp:"ContainerNo",bSortable:!1},{mDataProp:"TotalAmount",bSortable:!1,mData:function(n){return numeral(n.TotalAmount).format("0,0")}},{mDataProp:"TotalAmountDhs",bSortable:!1,mData:function(n){return numeral(n.TotalAmountDhs).format("0,0")}},{bSortable:!1,sClass:"hidden-print",mData:function(n){var t="",i;return n.Paid||(t='<input title="اختر لدفع الفاتورة" type="checkbox" data-comp='+n.CustomsCompanyID+" value="+n.CustomsInvoiceID+' class="op-acity" />'),i=n.IsEdit?'<a class="btn btn-mini btn-danger remove" title="حــذف" href="javascript:void(0);"><i class="icon-trash icon-only"><\/i><\/a>':"",'<div class="tools pull-left hidden-print">'+t+' <a class="btn btn-mini btn-grey" title="طباعه" href="InvoicesCustomsPrint.aspx?id='+n.CustomsInvoiceID+'"><i class="icon-print icon-only"><\/i><\/a> '+i+"<\/div>"}},]});$("#listItems tbody").delegate("tr a.remove","click",function(n){n.preventDefault();var r=$(this),t=r.closest("tr").index(),i;t!==null&&DeleteConfirmation(function(){i=f.fnGetData(t);var n=i.CustomsInvoiceID;commonManger.deleteData("anyThing",commonManger.successDeleted,commonManger.errorException,"CustomsInvoices","CustomsInvoiceID",n)})});$("#listItems tbody").delegate("tr .op-acity:checkbox","change",function(n){n.preventDefault();var t=$(this);c(t)})};return{Init:f}}();
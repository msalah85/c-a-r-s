var pageManager=pageManager||{},pageManager=function(){var s=$("select[id$=ddlCarSize]"),p=$("select[id$=ddlDistination]"),h=$("select[id$=ddlClient]"),i=$(".radioList"),r=$("input[id$=hfClientCashComm]"),n=$("input[id$=hfClientCreditComm]"),u=$("input[id$=hfExtraCashComm]"),f=$("input[id$=hfExtraCreditComm]"),w="InvoiceSaleAdd.aspx/",t=$("#user_type"),c=function(){var n=$("div[id$=DivlblCarSizePrice]");t.val()==="2"?(n.addClass("hidden"),$("label[id$=divlblPayTypePriceSum]").text("تكلفة النقل")):($("label[id$=divlblPayTypePriceSum]").text("عمولة الشركة"),n.removeClass("hidden"))},l=function(n,t){t===!0?$("div.sale-message").html('<div class="alert alert-block alert-danger"><strong>تنبـــيه: <\/strong> '+n+"<\/div>"):$("div.sale-message").html("")},b=function(o){var p=commonManger.comp2json(o.d),s=p.list,k=p.list1,h,a,y,b,w;r.val(0);n.val(0);u.val(0);f.val(0);$("#hfTowingLoadingOF").val(0);s?(t.val(1),r.val(s.CommissionCash?s.CommissionCash:0),n.val(s.CommissionCredit?s.CommissionCredit:0),u.val(s.ExtraCash?s.ExtraCash:0),f.val(s.ExtraCredit?s.ExtraCredit:0),h=0,h=s.Towing?s.Towing*1:0,h+=s.LoadingOF?s.LoadingOF*1:0,h+=s.Partitioning?s.Partitioning*1:0,h+=s.Customs?s.Customs*1:0,h+=s.Extra?s.Extra*1:0,a="btnSave",y=$(".radioList :radio:checked").val(),y&&y*1>0&&(v(a,!1),l("",!1)),(s.LoadingOFContainer*1>0||s.CustomsContainer*1>0)&&(s.CarsNo*1>0?h+=(s.LoadingOFContainer*1+s.CustomsContainer*1)/s.CarsNo:(console.log("يرجي التحقق من انشاء BOL للسيارة لمعرفة عدد السيارات بالحاوية، أو مراجعة عقد العميل"),l("يرجي التحقق من انشاء BOL للسيارة لمعرفة عدد السيارات بالحاوية، أو مراجعة عقد العميل.",!0),v(a,!0))),b=i.find(":checked").val(),n.val()*1==0&&s.ExtraCreditList*1>0&&n.val(s.ExtraCreditList),$("#hfTowingLoadingOF").val(h.toFixed()),c()):(t.val(2),c(),w=$("input[id$=hfCarDefaultCosts]").val()*1>$("#lblPayPrice").val()*1?$("input[id$=hfCarDefaultCosts]").val()*1-$("#lblPayPrice").val()*1:0,$("input[id$=lblPayTypePriceSum]").val(w.toFixed(0)),$("#txtSalePrice").removeAttr("disabled").removeClass("aspNetDisabled"),$("#CarMoreCost,#CarDiscount").closest("div.control-group").addClass("hidden"),$(".btnApprove").addClass("hidden"));e()},a=function(){var n=commonManger.getUrlVars().id,t=h.val(),i={actionName:"CarSaleCommission_Select",names:["CaID","ClID"],values:[n,t]};n!==undefined&&n*1>0&&dataService.callAjax("Post",JSON.stringify(i),sUrl+"GetDataList",b,commonManger.errorException)},v=function(n,t){t===!0?$("#"+n).attr("disabled",!0).addClass("aspNetDisabled hidden"):$("#"+n).removeAttr("disabled").removeClass("aspNetDisabled hidden")},y=function(){var n=s.val(),t=$("#PayTypeID").val();n==2&&t==1?$("input[id$=lblCarSizePrice]").val(400):$("input[id$=lblCarSizePrice]").val(0);o()},e=function(){var h,v;if(t.val()==="1"){var c=$("input[id$=lblPayPrice]").val(),y=$("input[id$=lblPayTypePriceSum]"),l=i.find(":checked").val(),e=parseFloat(l==1?r.val():n.val()),p=parseFloat(l==1?u.val():f.val()),s=0,a=$("input[id$=hfTowingLoadingOF]").val();if(c>1e4)for(h=1e4;h<c;h+=5e3)s+=p;a>0&&(e+=parseFloat(a));$("input[id$=lblCarPrice]").val(s);$("input[id$=lblPayTypePrice]").val(e);v=s+e;y.val(v)}o()},o=function(){var n=$("input[id$=txtSalePrice]"),i,r,u,f,e;t.val()==="1"?(i=k($("input[id$=lblPayPrice]").val(),$("input[id$=lblCarSizePrice]").val(),$("input[id$=lblPayTypePriceSum]").val()),r=$("#CarDiscount").val(),!isNaN(r)&&r*1>0&&(i=i-r),u=$("#CarMoreCost").val(),!isNaN(u)&&u*1>0&&(i+=parseFloat(u)),$("input[id$=lblFullPrice]").val(i),!isNaN(n.val())&&n.val()*1>0&&n.val(i),$(".btnApprove").removeClass("hidden")):(f=0,e=$("#PayTypeID").val(),e==="3"?(f=parseFloat($("input[id$=lblPayPrice]").val()),$("input[id$=lblPayTypePriceSum]").val(0),$(".btnApprove").removeClass("hidden"),$("#txtSalePrice,input[id$=ddlSaleTypes_1]").prop("disabled",!0).prop("aspNetDisabled","true"),$("span[id$=ShippingCalcID]").text("سيارة Relist").addClass("red")):(f=parseFloat($("input[id$=lblPayPrice]").val())+parseFloat($("input[id$=lblPayTypePriceSum]").val()),$("input[id$=lblFullPrice]").val(f)),!isNaN(n.val())&&n.val()*1>0&&(n.css({outline:"6px dashed yellow","box-shadow":"0 0 0 6px #EA3556",animation:"1s animateBorder infinite"}),setTimeout(function(){n.removeAttr("style")},800)))},k=function(){for(var t=0,n=0,i=arguments.length;n<i;n++)d(arguments[n])&&(t+=parseFloat(arguments[n]));return t},d=function(n){return+n==n&&n.length>0},g=function(n){n=n.d;n.Status?(commonManger.showMessage("تم الحفظ بنجاح:",n.Message),window.location.href="InvoiceSalePrint.aspx?id="+n.ID):commonManger.showMessage("خطأ بالحفظ:",n.Message)},nt=function(n){$.isFunction(n)&&bootbox.confirm("تنبيه/  سعر البيع أقل من تكاليف السيارة",function(t){t?n():commonManger.showMessage("خطأ فى الحفظ:","يرجي التحقق من سعر البيع")})},tt=function(){var i=$("label[id$=lblPayType]").text().indexOf("العراق")>0?1:2,r=[$("#hfId").val(),$("#hfCarID").val(),$(".radioList :radio:checked").val(),$("#txtTrxDate").val(),$("#ddlClient").val(),$("#ddlDistination").val(),$("#txtSalePrice").val(),$("#lblPayPrice").val(),$("#lblFullPrice").val(),$("#txtArriveDate").val(),$("#txtNotes").val(),$("#user_type").val(),$("#lblCarSizePrice").val(),$("#lblCarPrice").val(),$("#lblPayTypePrice").val(),i,$("#CarDiscount").val(),$("#CarMoreCost").val()],t={parm:r},n;$("#txtSalePrice").val()*1>0?(console.log(t),n=function(){dataService.callAjax("Post",JSON.stringify(t),w+"SaveInv",g,commonManger.errorException)},it()?n():nt(n)):commonManger.showMessage("سعر البيع مطلوب","يرجي ادخال سعر البيع أولاً")},it=function(){var n=$("#lblFullPrice").val()*1,t=$("#txtSalePrice").val()*1,i=!0;return n=$.isNumeric(n)?n:0,t=$.isNumeric(t)?t:0,n>t&&(i=!1),i},rt=function(){h.change(function(){a()});p.change(function(){e()});i.change(function(){e()});s.change(function(){y()});$("input[id$=txtSalePrice]").on("show.bs.tooltip",function(){var n="سعر بيع السيارة الافتراضى: "+$("input[id$=lblFullPrice]").val();$(this).attr("title",n).attr("data-original-title",n)});$(".profit").on("show.bs.tooltip",function(){var n="إجمالى كلفة السيارة: "+$("input[id$=hfCarDefaultCosts]").val()+"$\nسعر البيع: "+($("input[id$=txtSalePrice]").val()===""?0:$("input[id$=txtSalePrice]").val())+"$\nالربح: "+((parseFloat($("input[id$=txtSalePrice]").val()===""?0:$("input[id$=txtSalePrice]").val())-parseFloat($("input[id$=hfCarDefaultCosts]").val())).toFixed(0)+"$");$(this).attr("data-original-title",n)});$("#btnSave").click(function(n){n.preventDefault();var t=commonManger.applyValidation("aspnetForm");t&&tt()});$(".btnApprove").click(function(n){n.preventDefault();var t=$("#lblFullPrice").val();$("#txtSalePrice").val(t).select()});$("#CarDiscount,#CarMoreCost").on("keyup",function(){o()})},ut=function(){$(".carid").text($("#hfCarID").val());y();rt();a()};return{Init:ut}}();pageManager.Init();
//# sourceMappingURL=InvoiceSaleAdd.min.js.map

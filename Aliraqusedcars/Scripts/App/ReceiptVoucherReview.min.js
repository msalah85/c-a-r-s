var ClientsPaymentsReview=ClientsPaymentsReview||{},ClientsPaymentsReview=function(){var n=$("#RecieptID"),t=function(){u();i()},i=function(){n.change(function(){var n=$(this).val();f(n)});$("#SaveAll").click(function(n){var t,i,u;n.preventDefault();t=$("#passwordNo").val();t!==""&&(i={value:t},u="ClientsPaymentsAdd.aspx/SelectSetting",dataService.callAjax("Post",JSON.stringify(i),u,function(n){if(n.d)r();else return commonManger.showMessage("التحقق من كلمة السر:","الرقم السرى غير صحيح، من فضلك أدخل رقم صحيح"),!1},commonManger.errorException))})},r=function(){var n=$("#PayTypeID").text(),u={ClientPaymentsID:0,ClientID:$("#ClientID").text(),PaymentsDates:commonManger.dateFormat($("#AddDate").text()),ExchangeCompanyID:n==="1"?6:n==="2"?5:$("#ExchangeCompanyID").text(),CheckNo:$("#CheckNo").text(),Amount:$("#Amount").text(),ReciverName:$("#FromName").text(),Details:$("#Notes").text(),AmountDhs:$("#AmountDhs").text(),BankID:$("#BankID").text(),BankCheckNo:$("#BankCheckNo").text(),ReceiptID:$("#ReceiptID").text()},t=[],i=[],r;$.each(u,function(n,r){i.push(n);t.push(r)});r={values:t,actionName:"ClientsPayments_save",Parm_names:i,flage:1};dataService.callAjax("Post",JSON.stringify(r),mainServiceUrl+"saveData",function(n){n=n.d;n.Status?(commonManger.showMessage("تم بنجاح:","تم الحفظ بنجاح:"),window.location.href="ClientsPaymentsPrint.aspx?id="+n.ID):commonManger.showMessage("خطأ أثناء الحفظ",n.message)},commonManger.errorException)},u=function(){var t=commonManger.getQueryStrs();t.cid=t.cid?t.cid:null;dataService.callAjax("Post",JSON.stringify({actionName:"ClientsPayments_SelectRecipts",value:t.cid}),sUrl+"GetData",function(i){var r=commonManger.comp2json(i.d),f=r.list,u=r.list1,e=t.id,o=$(f).map(function(n,t){return $("<option "+(e==t.ReceiptID?" selected ":"")+" />").val(t.ReceiptID).text(t.ReceiptID)}).get();n.append(o).trigger("chosen:updated");u&&($(".clientName").text(u.full_name).attr("href","ClientCars.aspx?id="+t.cid),$(".paymentsList").attr("href","ClientsPaymentsView.aspx?id="+t.cid));n.change()})},f=function(n){var t={actionName:"ReceiptVouchers_SelectRow",value:n};dataService.callAjax("Post",JSON.stringify(t),sUrl+"GetData",function(n){var i=commonManger.comp2json(n.d),t=i.list;$(".exchangeCo,.divfull_name,.bankName,.bankCheck").addClass("hidden");t?($("#masterForm").removeClass("hidden"),$.each(t,function(n,t){$("#masterForm #"+n).text(t)}),$("#Amount,#AmountDhs").text(function(){return numeral($(this).text()).format("0,0")}),$("#AddDate").text(function(){var n=t.ExchangeDate?t.ExchangeDate:$(this).text();return commonManger.formatJSONDateCal(n)}),t.ReceiptTypeID==2&&$(".divfull_name").removeClass("hidden"),t.PayTypeID==3&&$(".exchangeCo").removeClass("hidden"),t.BankName&&$(".bankName").removeClass("hidden"),t.BankCheckNo&&$(".bankCheck").removeClass("hidden")):$("#masterForm").addClass("hidden")},commonManger.errorException)};return{Init:t}}();ClientsPaymentsReview.Init();
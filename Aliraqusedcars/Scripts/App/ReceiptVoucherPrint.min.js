var ClientsPaymentsPrint=function(){return Init=function(){var n=decodeURIComponent(commonManger.getUrlVars().id);n!=""&&n!="undefined"&&n!=null&&setDataToControlandGrid(n);$("#sig").signature({color:"#145394"});$("#clear").click(function(){$("#sig").signature("clear")});$("#SaveSignature").click(function(n){n.preventDefault();saveSignature()})},renderSVG=function(n,t,i,r){document.createElement("canvas");var u=document.createElement("canvas");u.width=t||500;u.height=i||188;document.getElementById(r).innerHTML="";document.getElementById(r).appendChild(u);typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(u);canvg(u,n,{log:!0,renderCallback:function(n){if(typeof FlashCanvas!="undefined")document.getElementById("sig").innerHTML="svg not supported";else{var t=(new XMLSerializer).serializeToString(n);document.getElementById("sig").innerHTML=t}}});$("#SaveSignature,#clear").addClass("hidden")},sigSaved=function(n){if(n=n.d,n.Status){var t=$("#sig").signature("toSVG");renderSVG(t,100,80,"sigView");$(".add-sig").remove();$("#sig").signature("disable");$(".modal").modal("hide");commonManger.showMessage("تم الحفظ",n.message)}else commonManger.showMessage("خطأ أثناء تنفيذ الإجراء",n.message)},saveSignature=function(){var n={ID:$("#ReceiptID").text(),Picture:$("#sig").signature("toSVG"),actionName:"ReceiptVoucher_Signature"},t={actionName:n.actionName,names:["ID","Sig"],values:[n.ID,n.Picture]};n.ID&&n.Picture!==""?dataService.callAjax("Post",JSON.stringify(t),sUrl+"saveData",sigSaved,commonManger.errorException):commonManger.showMessage("بيانات مطلوبة","يرجي التأكد من رسم التوقيع اولا.")},getFromName=function(n,t){n=n?$.trim(n):"";t=t?$.trim(t):"";var i=t.localeCompare(n);return i===0||n===""?t:n+'،  &nbsp; <span class="static-content">بيـد:<\/span> '+t},setDataToControlandGrid=function(n){var t={actionName:"ReceiptVouchers_SelectRow",value:n},i=function(n){var i=commonManger.comp2json(n.d),t=i.list;t&&($.each(t,function(n,t){$("#masterForm #"+n).text(t)}),$(".sig").html(t.Sig),$("#FromName").html(getFromName(t.full_name,t.FromName)),$("#Amount,#AmountDhs").text(function(){return numeral($(this).text()).format("0,0")}),$("#AddDate,#BankDate,#ExchangeDate").text(function(){return commonManger.formatJSONDateCal($(this).text(),"dd/MM/yyyy")}),t.ReceiptTypeID==2&&$(".divfull_name").removeClass("hidden"),t.PayTypeID==3&&$(".exchangeCo").removeClass("hidden"),t.PaymentTypeID!=="1"&&($("#PaymentTypeName").text(""),t.PayTypeID==4&&($(".check-no").text(t.PaymentTypeName+": "),$("#BankCheckNo").html(t.BankTransferNo))),t.Deleted==="true"?$("#divCanceled").removeClass("hidden").html("سند قبض ملغي").closest(".hidden").removeClass("hidden"):(t.DeleteFromClientBalance==="true"&&($("#divCanceled").removeClass("hidden").html("سند ملغي من رصيد العميل").closest(".hidden").removeClass("hidden"),$("#DeleteReason").removeClass("hidden").html(t.ClientPaymentDeleteReason).closest(".hidden").removeClass("hidden")),t.full_name&&t.PayTypeID==="3"&&!t.ClientPaymentsID&&$("#divCanceled").removeClass("hidden").html("سند قبض غير معتمد").closest(".hidden").removeClass("hidden")),t.FromSig&&($(".add-sig").remove(),renderSVG(t.FromSig,500,188,"sigView")))};dataService.callAjax("Post",JSON.stringify(t),sUrl+"GetData",i,commonManger.errorException)},{Init:Init}}();
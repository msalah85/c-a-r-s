var ClientsPaymentsPrint=ClientsPaymentsPrint||{},ClientsPaymentsPrint=function(){return Init=function(){var n=decodeURIComponent(commonManger.getUrlVars().id);n!=""&&n!="undefined"&&n!=null&&setDataToControlandGrid(n);$("#sig").signature({color:"#145394"});$("#clear").click(function(){$("#sig").signature("clear")});$("#SaveSignature").click(function(n){n.preventDefault();saveSignature()})},renderSVG=function(n,t,i,r){document.createElement("canvas");var u=document.createElement("canvas");u.width=t||500;u.height=i||188;document.getElementById(r).innerHTML="";document.getElementById(r).appendChild(u);typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(u);canvg(u,n,{log:!0,renderCallback:function(n){if(typeof FlashCanvas!="undefined")document.getElementById("sig").innerHTML="svg not supported";else{var t=(new XMLSerializer).serializeToString(n);document.getElementById("sig").innerHTML=t}}});$("#SaveSignature,#clear").addClass("hidden")},sigSaved=function(n){if(n=n.d,n.Status){var t=$("#sig").signature("toSVG");renderSVG(t,100,80,"sigView");$(".add-sig").remove();$("#sig").signature("disable");$(".modal").modal("hide");commonManger.showMessage("تم الحفظ",n.message)}else commonManger.showMessage("خطأ أثناء تنفيذ الإجراء",n.message)},saveSignature=function(){var n={ID:$("#ReceiptID").text(),Picture:$("#sig").signature("toSVG"),actionName:"ReceiptPayments_Signature"},t={actionName:n.actionName,names:["ID","Sig"],values:[n.ID,n.Picture]};n.ID&&n.Picture!==""?dataService.callAjax("Post",JSON.stringify(t),sUrl+"saveData",sigSaved,commonManger.errorException):commonManger.showMessage("بيانات مطلوبة","يرجي التأكد من رسم التوقيع اولا.")},getFromName=function(n,t){n=n?$.trim(n):"";t=t?$.trim(t):"";var i=t.localeCompare(n);return i===0||n===""?t:n+'،  &nbsp; <span class="static-content">بيـد:<\/span> '+t},setDataToControlandGrid=function(n){var t={actionName:"ReceiptPayments_SelectRow",value:n};dataService.callAjax("Post",JSON.stringify(t),sUrl+"GetData",function(n){var r=commonManger.comp2json(n.d),t=r.list,i;if(t){$.each(t,function(n,t){$("#masterForm #"+n).text(t)});$(".sig").html(t.Sig);i="";switch(t.ReceiptTypeID){case"2":i=t.full_name;i=getFromName(t.full_name,t.ToName);break;case"3":i=getFromName(t.FullUserName,t.ToName);break;case"4":i=getFromName(t.OutsideMemberName,t.ToName);break;default:i=t.ToName}$("#ToName").html(i);$("#Amount,#AmountDhs").text(function(){return numeral($(this).text()).format("0,0")});$("#AddDate,#BankDate,#ExchangeDate").text(function(){return commonManger.formatJSONDateCal($(this).text(),"dd/MM/yyyy")});t.PayTypeID!=="1"&&$("#PaymentTypeName").text("");t.Deleted==="true"&&$("#divCanceled").removeClass("hidden").html("سند صرف ملغي").closest(".hidden").removeClass("hidden");t.Signature&&($(".add-sig").remove(),renderSVG(t.Signature,100,80,"sigView"))}},commonManger.errorException)},{Init:Init}}();
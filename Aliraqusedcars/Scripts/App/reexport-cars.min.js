var pageManager=pageManager||{},pageManager=function(){var r=null,u=null,n="#listItems",t=null,e=function(){o();i()},o=function(){var n=commonManger.getQueryStrs();n.id!==undefined&&n.id!==null&&n.id!==""&&($("#From").val(n.from),$("#To").val(n.to),$("#ExportID").val(n.id),n.re==="true"&&($("#Revised").attr("checked",n.re),$(".btnSave").hide()))},s=function(){e();$("#btnSearchAll").click(function(n){n.preventDefault();i()});$(".btnSave").click(function(n){n.preventDefault();bootbox.confirm("هل أنت متأكد من حفظ ملف الجمارك/التأمينات",function(n){n&&h()})})},h=function(){var t={exportID:$("#ExportID").val(),funName:"ReExportInvoices_Save",dateFrom:commonManger.dateFormat($("#From").val()),dateTo:commonManger.dateFormat($("#To").val()),carsNo:$(".carsNo").text().replace("# ",""),totalCustoms:$(".carsCustoms").text().replace(" $",""),customsNo:$(".noCustoms").text().replace("# ",""),totalrealCustoms:$(".customsTotal").text().replace(" د.إ",""),revised:0,masterFields:["ExportID","DateFrom","DateTo","NoCars","NoCustoms","TotalAmount","RealAmount","Revised"],detailFields:["CarID","CustomsNo","GroupTotalAmount"]},f=[t.exportID,t.dateFrom,t.dateTo,t.carsNo,t.customsNo,t.totalCustoms,t.totalrealCustoms,t.revised],i=[],r=0,u=null;$(n+" tbody tr").each(function(){var n=$(this),e=n.find("td:eq(0) a").data("id"),t=n.find("td:eq(3)").text(),f=n.find("td:eq(5) input").val();u===t?f=r:(r=f,u=t);i.push(e+","+t+","+f)});t.dateFrom!=""&&t.dateTo!=""&&t.totalrealCustoms*1>0?l(t.funName,t.masterFields,f,t.detailFields,i):commonManger.showMessage("بيانات مطلوبة:","يرجي التأكد من تاريخ البيان من وإلى ، وإجمالى المبلغ المسترد أولاً.")},c=function(n){n=n.d;n.Status?(commonManger.showMessage("تم الحفظ",n.message),window.location.href="ReExportCarsPrint.aspx?id="+n.ID):commonManger.showMessage("خطأ أثناء الحفظ","لقد حدث خطأ أثناء عملية .. "+n.message)},l=function(n,t,i,r,u){var f={values:i,actionName:n,Parm_names:t,fieldsDetails:r,valuesDetails:u,flage:"1"};dataService.callAjax("Post",JSON.stringify(f),mainServiceUrl+"SaveDataMasterDetails",c,commonManger.errorException)},f=function(){var t=0;$(n+" tbody tr").each(function(){var n=$(this).find("td:nth-child(6):visible input.span12:not(disabled)").val();n&&(t+=n*1)});$(n+" tfoot th:eq(5),.customsTotal").html(t.toFixed(2)+" د.إ")},a=function(n){n=n.d;n.Status?(i(),commonManger.showMessage("تم تنفيذ طلبك","تم تنفيذ طلبك بنجاح.")):commonManger.showMessage("خطأ فى التنفيذ","لقد حدث خطأ في تنفيذ الإجراء ، يرجي المحاولة فى وقت لاحق.")},v=function(n,t){var i={CarID:n,Active:t,actionName:"ReExportCars_Activate"},r={actionName:i.actionName,names:["CarID","Active"],values:[i.CarID,i.Active]};dataService.callAjax("Post",JSON.stringify(r),sUrl+"saveData",a,commonManger.errorException)},y=function(n){return"هل أنت متأكد من "+(n?"اضافة":"إلغاء")+" جمارك السيارة التى تم ختيارها؟"},i=function(){r=commonManger.dateFormat($("#From").val());u=commonManger.dateFormat($("#To").val());t=$("#ExportID").val();var i=$(n).DataTable({sDom:"<'row-fluid'<'span6'l><'span6 lft-pane'BT>r>t<'row-fluid'<'span6'i><'span6'p>>",buttons:[{extend:"csv",text:"تصدير إكسيل"},{extend:"copy",text:"نسـخ"},{text:"طباعة",action:function(){$(".dataTables_length,.form-horizontal").closest("div.row-fluid").addClass("hidden-print");window.print()}}],bProcessing:!0,bServerSide:!0,responsive:!0,responsive:!0,bDestroy:!0,bSort:!1,sAjaxSource:"ReExportCarsList.aspx/LoadData",fnServerParams:function(n){n.push({name:"From",value:r},{name:"To",value:u},{name:"id",value:t*1>0?t:null})},fnServerData:function(n,t,i){dataService.callAjax("GET",t,n,function(n){i(n.d);p()},commonManger.errorException)},fnFooterCallback:function(n,t){for(var r=0,u=0,i=0;i<t.length;i++)t[i].Active&&(r+=t[i].CustomsOnCar*1,u++);$(n).find("th:eq(2)").html(r.toFixed(2)+" $");$(".carsCustoms").html(r.toFixed(2)+" $");$(n).find("th:eq(1)").html("# "+u);$(".carsNo").html("# "+u)},createdRow:function(n,t){t.Active||(t.ContainerActiveCount<=0?($("td",n).addClass("line-thro"),$("input",n).addClass("disabled").attr("disabled",!0)):($("td",n).eq(1).addClass("line-thro"),$("td",n).eq(2).addClass("line-thro")))},orderCellsTop:!0,rowsGroup:[3,4,5],iDisplayLength:100,aoColumns:[{bSortable:!1,sClass:"center hidden-print",mData:function(n){return'<a data-id="'+n.CarID+'" class="btn btn-mini btn-'+(n.Active?"danger":"info")+' remove" data-rel="tooltip" data-placement="top" data-original-title="'+(n.Active?"إلغاء":"اضافة")+' قيمة جمرك السيارة" title="'+(n.Active?"إلغاء":"اضافة")+' قيمة جمرك السيارة"><i class="icon-'+(n.Active?"remove":"share-alt")+' icon-only"><\/i><\/a>'}},{mDataProp:"CarID",bSortable:!1,mData:function(n){return n.MakerNameEn+" - "+n.TypeNameEn+" - "+n.Year}},{mData:"CustomsOnCar",sClass:"hidden-print",bClass:function(n){return n.Active?"":"line-thro"},bSortable:!1},{mData:"CustomsNo",bSortable:!0,sClass:"v-middle"},{mDataProp:"CustomsNo",bSortable:!0,sClass:"v-middle",mData:function(n){return commonManger.formatJSONDate(n.CustomsDate)}},{mDataProp:"CustomsNo",bSortable:!1,sClass:"v-middle hidden-print",mData:function(n){return'<input type="text" class="form-control span12" value="'+(n.GroupTotalAmount?n.GroupTotalAmount:0)+'" title="اضف المبلغ المسترد" />'}}]});$(document).off("click.pageManager");$(n+" tbody").delegate("tr a","click",function(n){var t,f,r,e,u;n.stopImmediatePropagation();n.preventDefault();t=$(this);r=t.closest("tr").index();r!==null&&t.hasClass("remove")&&(f=i.row(r).data(),e=t.data("id"),u=f.Active?!1:!0,bootbox.confirm(y(u),function(n){n&&v(e,u)}))});$(n+" tbody").delegate("tr input.span12","change",function(){f()})},p=function(){var t=$(n+" tbody tr td:nth-child(4):visible:not(.line-thro)").length;$(n+" tfoot th:eq(3),.noCustoms").text("# "+t);f()};return{Init:s}}();pageManager.Init();
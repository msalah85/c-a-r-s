var pageManager=pageManager||{},pageManager=function(){var i="",r="",u="",f="",n=0,e=function(){o();l();s()},o=function(){var t=commonManger.getQueryStrs().late;t>0&&(n=1,$("#Late").prop("checked",!0))},s=function(){$("#btnSearchAll").click(function(e){e.preventDefault();i=$("#Shipper").val();paid=$("#Paid").val();r=commonManger.dateFormat($("#From").val());u=commonManger.dateFormat($("#To").val());f=$("#ContainerNo").val();n=$("#Late").is(":checked")?1:0;t()});$("#cancelModal .modal-footer .btn-danger").on("click",function(n){var t;if(n.preventDefault(),t=$("#ShippInvoiceID").val(),t!=""){var i=[t],r={actionName:"ShippInvoices_Delete",names:["ShippInvoiceID"],values:i};dataService.callAjax("Post",JSON.stringify(r),sUrl+"saveData",h,commonManger.errorException)}});$("#printedModal .modal-footer button.btn-success").live("click",function(n){n.preventDefault();c()})},h=function(n){n=n.d;$(".modal").modal("hide");commonManger.showMessage("تم تنفيذ الإجراء بنجاح.",n.message);n.Status&&t()},c=function(){var r=function(n){n=n.d;n.Status?(t(),$(".modal").modal("hide"),commonManger.showMessage("تم بنجاح:","تم اعتماد طباعة الفاتورة.")):($("#printedModal").modal("hide"),commonManger.showMessage("خطأ بالحفظ:","لم يتم اعتماد طباعة الفاتورة."))},n=$("#InvoiceID").val(),i;n!==""?(i={actionName:"ContainerToCom_PrintInvoice",names:["id"],values:[n]},dataService.callAjax("Post",JSON.stringify(i),sUrl+"saveData",r,commonManger.errorException)):($("#printedModal").modal("hide"),commonManger.showMessage("خطأ بالحفظ:","لم يتم اعتماد طباعة الفاتورة."))},t=function(){$("#listItems").DataTable().draw()},l=function(){var t=$("#listItems").DataTable({sDom:"<'row-fluid tbl-head-options'<'span6'l><'span6 lft-pane'BT>r>t<'row-fluid'<'span6'i><'span6'p>>",buttons:[{extend:"csv",text:"تصدير إكسيل"},{extend:"copy",text:"نسـخ"},{text:"طباعة",action:function(){$(".dataTables_length,.form-horizontal").closest("div.row-fluid").addClass("hidden-print");window.print()}}],bProcessing:!0,bServerSide:!0,responsive:!0,bRetrieve:!1,bDestroy:!0,sAjaxSource:sUrl+"LoadDataTablesXML",fnServerParams:function(t){var e=i+"~"+r+"~"+u+"~"+f+"~"+n;t.push({name:"funName",value:"ShippInvoicesDetails_SelectList"},{name:"names",value:"Shipper~From~To~Container~Late"},{name:"values",value:e})},fnServerData:function(n,t,i){dataService.callAjax("GET",t,n,function(n){commonManger.setData2Grid(n,t.sEcho,i)},commonManger.errorException)},iDisplayLength:50,drawCallback:function(){var n=this.api(),i=n.rows({page:"current"}).nodes(),t=null;n.column(0,{page:"current"}).data().each(function(n,r){t!==n&&($(i).eq(r).before('<tr class="group alert alert-warning"><td colspan="3">'+n+"<\/td><\/tr>"),t=n)})},aoColumns:[{mDataProp:"ShipCompanyNameEn",bVisible:!1,mData:function(n){var t=n.ContainerNo&&n.InvoicePrinted==="false"?n.Bol+'<a class="btn btn-mini btn-warning hidden-print printMe" title="اعتمد طباعة الفاتورة من موقع الشاحن الآن" data-id="'+n.ShippInvoiceID+'" data-container="'+n.ContainerNo+'" href="#printedModal"><i class="icon-print"><\/i><\/a>':n.Bol;return'<table class="sub-table"><tr><td>رقم حجز الحاوية: '+t+"<\/td><td>الشاحن: "+n.ShipCompanyNameEn+"<\/td><td>تاريخ الوصول: "+commonManger.formatJSONDateCal(n.ArrivalDate)+'<\/td><td><div class="tools pull-left hidden-print"><a class="btn btn-mini btn-info" title="تعديل BOL" href="bookingbol.aspx?id='+n.ShippInvoiceID+'"><i class="icon-edit icon-only"><\/i><\/a> <a class="btn btn-mini btn-grey" title="طباعه" href="InvoiceShippingPrint.aspx?id='+n.ShippInvoiceID+'"><i class="icon-print icon-only"><\/i><\/a> <a class="btn btn-mini btn-danger remove" title="حــذف" href="javascript:void(0);" data-ShippInvoiceID="'+n.ShippInvoiceID+'" data-bol="'+n.Bol+'"><i class="icon-trash icon-only"><\/i><\/a><\/div><\/td><\/tr><\/table>'}},{bSortable:!0,mData:function(n){return'<a title="تفاصيل السيارة" href="CarDetailsPrint.aspx?id='+n.CarID+'">'+n.MakerNameEn+" - "+n.TypeNameEn+" - "+n.Year+"<\/a>"}},{mDataProp:"LotNo",bSortable:!0},{mDataProp:"ChassisNo",bSortable:!0}]});$("#listItems tbody").delegate("tr a.remove","click",function(n){n.preventDefault();var t=$(this);$("#ShippInvoiceID").val(t.attr("data-ShippInvoiceID"));$("#BOL").val(t.attr("data-bol"));commonManger.showPopUpDialog("إلغاء حجز الحاوية","","cancelModal")});$("#listItems tbody").delegate("tr a.printMe","click",function(n){var t,i;if(n.preventDefault(),t=$(this),i=t.closest("tr"),i!==null)$("#InvoiceID").val(t.attr("data-id")),$("#containerNoo").text(t.attr("data-container")),commonManger.showPopUpDialog("اعتمد طباعة الفاتورة: ","insert","printedModal")})};return{Init:e}}();
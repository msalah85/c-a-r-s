var ClientsPayments=ClientsPayments||{},ClientsPayments=function(){var i=function(){o();u();r()},r=function(){var n=commonManger.getUrlVars();n&&(n.id?($(".page-header h1 span").html("تعديل"),s(n.id)):n.ramount&&n.ids&&($("#Amount").val((n.ramount*1/3.667).toFixed(2)).change(),$("#AmountDhs").val(n.ramount),$("#IDs").val(n.ids)))},u=function(){$("input[type=text]").on("focus click",function(){$(this).select()});$("#ClientID, #OutsideMemberID, #EmpID").on("change",function(){$(this).val()!==""&&$("#FromName").val($(this).find("option:selected").text())});$("#ReceiptTypeID input").change(function(){$("#divEmpID,#divClientID,#divOutsideMemberID").addClass("hidden");$("#EmpID,#ClientID,#OutsideMemberID").val("");$("#EmpID,#ClientID,#OutsideMemberID").trigger("chosen:updated");var n=$(this).val();n==2?$("#divClientID").removeClass("hidden"):n==3?$("#divEmpID").removeClass("hidden"):n==4&&$("#divOutsideMemberID").removeClass("hidden");$("#divExpenseTypeGroupID").addClass("hidden");$("#ExpenseTypeGroupID").val(1);n==1&&$("#divExpenseTypeGroupID").removeClass("hidden")});$("#Amount").on("blur change",function(){var t=$("#PayTypeID input:checked").val(),n=$("#Amount").val();commonManger.num2Arabic(n,1);$.fn.afterSave=function(n){$("#AmountArabic").val(n.d)};t==3?(n=n*3.67,$("#AmountDhs").val(n.toFixed(2))):(n=n*3.667,$("#AmountDhs").val(n.toFixed(2)))});$("#PayTypeID input").change(function(){$(".bank-options,.exchange-options, #divBankTransferNo").addClass("hidden");$(".bank-options input,.bank-options select,.exchange-options input,.exchange-options select,#BankTransferNo").val("");$(".divBankRequired").text("*");$("#BankID,#BankCheckNo").attr("name","BankInfo").attr("required","");$(".bank-exch-date").html("تاريخ الشيك");var n=$(this).val();n==2?$(".bank-options").removeClass("hidden"):n==3?($(".bank-options,.exchange-options").removeClass("hidden"),$(".divBankRequired").text(""),$("#BankID, #BankCheckNo").removeAttr("name required").removeClass("required")):n==4&&($("#divBankTransferNo, #divBankID, #divBankDate").removeClass("hidden"),$(".bank-exch-date").html('تاريخ التحويل <span class="red">*<\/span>'))});$("#SaveAll").click(function(n){n.preventDefault();commonManger.disableControl("SaveAll",!0);var t=e(),i=$("#Amount").val(),r=$("#AmountDhs").val();t?parseFloat(r)>parseFloat(i)?commonManger.saveData("masterForm","masterForm",c,"","ReceiptVouchers_Save","1",h):(commonManger.disableControl("SaveAll",!1),commonManger.showMessage("التحقق من البيانات:","برجاء ادخال جميع الحقول الاجبارية (*) <br>,وادخال المبلغ بالدرهم أكبر من المبلغ بالدولار.")):commonManger.disableControl("SaveAll",!1)});$("#ExchangeCompanyID").change(function(){n()});$("#CheckNo,#ExchangeDate").blur(function(){n()});$("#ExchangeDate").datepicker().on("changeDate",function(){n()})},n=function(){var n={id:$("#ExchangeCompanyID").val(),no:$("#CheckNo").val(),date:$("#ExchangeDate").val(),action:"ReceiptVouchers_CheckExist"},t;n.id!=""&&n.no!=""&&n.date!=""&&(t={actionName:n.action,names:["ExchangeCompanyID","CheckNo","ExchangeDate"],values:[n.id,n.no,commonManger.dateFormat(n.date)]},dataService.callAjax("Post",JSON.stringify(t),sUrl+"GetDataList",f,commonManger.errorException))},f=function(n){var i=commonManger.comp2json(n.d),t=i.list;t?($(".message").html('<div class="alert alert-danger span12"><i class="icon-warning-sign red"><\/i> <strong>إيصال مكرر:<\/strong> رقم الايصال الذى تم ادخاله موجود من قبل لسند قبض رقم: <a href="ReceiptVoucherPrint.aspx?id='+t.ReceiptID+'">'+t.ReceiptID+'<\/a><button type="button" class="close" data-dismiss="alert"><i class="icon-remove"><\/i><\/button><\/div>'),commonManger.showMessage("ايصال مكرر","هذا الايصال موجود بالفعل من قبل برقم: "+t.ReceiptID),$("#SaveAll").attr("disabled","disabled")):($("#SaveAll").removeAttr("disabled"),$(".message").html(""))},t=function(){$(".chzn-select").chosen({allow_single_deselect:!0,no_results_text:"اختـــر",search_contains:!1}).trigger("chosen:updated").trigger("liszt:updated")},e=function(){for(var i=!0,t=$("#masterForm :input:not(:hidden).required"),n=0;n<t.length;n++)($(t[n]).val()==""||$(t[n]).val()=="0")&&(i=!1,$(t[n]).focus());return i},o=function(){var n=function(n){var i=JSON.parse(n.d);commonManger.Filllist(i,"masterForm");t();$("#divClientID").after($("#divOutsideMemberID"))};dataService.callAjax("Post",JSON.stringify({actionName:"ReceiptVouchers_Properties2",value:""}),mainServiceUrl+"GetData",n,commonManger.errorException)},s=function(n){var i={actionName:"ReceiptVouchers_SelectRow",value:n},r=function(n){var r=commonManger.comp2json(n.d),i=r.list;i&&(i.ReceiptTypeID>1&&$("input[name='ReceiptTypeID'][value='"+i.ReceiptTypeID+"']").prop("checked",!0).change(),$("input[name='PayTypeID'][value='"+i.PayTypeID+"']").prop("checked",!0).change(),$("#Revised").attr("checked",i.Revised==="true"),$.each(i,function(n,t){$("#masterForm #"+n).val(t)}),$("#Amount,#AmountDhs").val(function(){return numeral($(this).val()).format("0.0")}),$(".date-picker").val(function(){return commonManger.formatJSONDateCal($(this).val())}),t())};dataService.callAjax("Post",JSON.stringify(i),sUrl+"GetData",r,commonManger.errorException)},h=function(){},c=function(n){window.location.href="ReceiptVoucherPrint.aspx?id="+n.ID};return{Init:i}}();
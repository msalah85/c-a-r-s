!function(n,t,i){"use strict";function o(n,t){t=t||{};this.$el=c();this.$shadow=c();n.append(this.$el);this.lazy=!!t.lazy;this.lazyFn=t.lazy||null;d(this);this.top=this.$el.offset().top;this.width=0;this.height=0;this.pages=[];this.startIndex=0;p.attach(this)}function d(n){n._$buffer=c().prependTo(n.$el)}function g(n){var t,i=n.pages,r=n._$buffer;i.length>0?(t=i[n.startIndex],r.height(t.top)):r.height(0)}function nt(n,t){t.$el.remove();n.$el.append(t.$el);ot(t,n.height);t.$el.remove()}function y(n){var r,u,i,f=n.pages,e=!1,o=!0;for(r=n.startIndex,u=t.min(r+v,f.length),r;r<u;r++)i=f[r],n.lazy&&i.lazyload(n.lazyFn),e&&i.onscreen&&(o=!1),o?i.onscreen||(e=!0,i.appendTo(n.$el)):(i.stash(n.$shadow),i.appendTo(n.$el))}function tt(n){var i,o,e,s,h,u=n.startIndex,c=f.scrollTop()-n.top,l=f.height(),a=c+l,r=ut(n,c,a);if(r<0||r===u)return u;for(e=n.pages,u=n.startIndex,s=t.min(u+v,e.length),h=t.min(r+v,e.length),i=u,o=s;i<o;i++)(i<r||i>=h)&&e[i].stash(n.$shadow);return n.startIndex=r,y(n),g(n),r}function it(n,t){var r;return t instanceof u?t:(typeof t=="string"&&(t=i(t)),r=new u(t),nt(n,r),r)}function rt(n){b(n)}function b(n){var f,t,i,h,u,c,e,l,o,a=n.pages,s=[];for(t=new r(n),s.push(t),i=0,h=a.length;i<h;i++){for(f=a[i],e=f.items,u=0,c=e.length;u<c;u++)l=e[u],o=l.clone(),t.hasVacancy()?t.append(o):(t=new r(n),s.push(t),t.append(o));f.remove()}n.pages=s;y(n)}function ut(n,i,r){var u=ft(n,i,r);return u=t.max(u-a,0),t.min(u,n.pages.length)}function ft(n,i,r){var u,v,f,c,h,e,o,s=n.pages,l=i+(r-i)/2;if(c=t.min(n.startIndex+a,s.length-1),s.length<=0)return-1;if(f=s[c],h=f.top+f.height/2,o=l-h,o<0){for(u=c-1;u>=0;u--){if(f=s[u],h=f.top+f.height/2,e=l-h,e>0)return e<-o?u:u+1;o=e}return 0}if(o>0){for(u=c+1,v=s.length;u<v;u++){if(f=s[u],h=f.top+f.height/2,e=l-h,e<0)return-e<o?u:u-1;o=e}return s.length-1}return c}function r(n){this.parent=n;this.items=[];this.$el=c();this.id=h.generatePageId(this);this.$el.attr(l,this.id);this.top=0;this.bottom=0;this.width=0;this.height=0;this.lazyloaded=!1;this.onscreen=!1}function et(n,t){for(var r,u=t.items,i=0,f=u.length;i<f;i++)if(u[i]===n){r=i;break}return r==null?!1:(u.splice(r,1),t.bottom-=n.height,t.height=t.bottom-t.top,t.hasVacancy()&&rt(t.parent,t),!0)}function u(n){this.$el=n;this.parent=null;this.top=0;this.bottom=0;this.width=0;this.height=0}function ot(n,t){var i=n.$el;n.top=t;n.height=i.outerHeight(!0);n.bottom=n.top+n.height;n.width=i.width()}function c(){return i("<div>").css({margin:0,padding:0,border:"none"})}function k(n){var t;n?(t=n.ListView,i.fn.listView=function(n){return new t(this,n)}):delete i.fn.listView}var f=i(n),w=n.infinity,e=n.infinity={},s=e.config={},l="data-infinity-pageid",a=1,v=a*2+1,p,h;s.PAGE_TO_SCREEN_RATIO=3;s.SCROLL_THROTTLE=350;o.prototype.append=function(n){if(!n||!n.length)return null;var t,i=it(this,n),u=this.pages;return this.height+=i.height,this.$el.height(this.height),t=u[u.length-1],t&&t.hasVacancy()||(t=new r(this),u.push(t)),t.append(i),y(this),i};o.prototype.remove=function(){this.$el.remove();this.cleanup()};o.prototype.find=function(n){var t,r,f;return typeof n=="string"?(r=this.$el.find(n),f=this.$shadow.find(n),this.find(r).concat(this.find(f))):n instanceof u?[n]:(t=[],n.each(function(){var e,r,u,n,o,f,s=i(this).parentsUntil("["+l+"]").andSelf().first(),c=s.parent();if(e=c.attr(l),r=h.lookup(e),r)for(u=r.items,n=0,o=u.length;n<o;n++)if(f=u[n],f.$el.is(s)){t.push(f);break}}),t)};o.prototype.cleanup=function(){var t=this.pages,n;for(p.detach(this);n=t.pop();)n.cleanup()};p=function(){function u(){i||(setTimeout(o,s.SCROLL_THROTTLE),i=!0)}function o(){for(var t=0,r=n.length;t<r;t++)tt(n[t]);i=!1}function e(){r&&clearTimeout(r);r=setTimeout(h,200)}function h(){for(var i,t=0;i=n[t];t++)b(i)}var t=!1,i=!1,r=null,n=[];return{attach:function(i){if(!t){f.on("scroll",u);f.on("resize",e);t=!0}n.push(i)},detach:function(i){for(var r=0,o=n.length;r<o;r++)if(n[r]===i)return n.splice(r,1),n.length===0&&(f.off("scroll",u),f.off("resize",e),t=!1),!0;return!1}}}();r.prototype.append=function(n){var t=this.items;t.length===0&&(this.top=n.top);this.bottom=n.bottom;this.width=this.width>n.width?this.width:n.width;this.height=this.bottom-this.top;t.push(n);n.parent=this;this.$el.append(n.$el);this.lazyloaded=!1};r.prototype.prepend=function(n){var t=this.items;this.bottom+=n.height;this.width=this.width>n.width?this.width:n.width;this.height=this.bottom-this.top;t.push(n);n.parent=this;this.$el.prepend(n.$el);this.lazyloaded=!1};r.prototype.hasVacancy=function(){return this.height<f.height()*s.PAGE_TO_SCREEN_RATIO};r.prototype.appendTo=function(n){this.onscreen||(this.$el.appendTo(n),this.onscreen=!0)};r.prototype.prependTo=function(n){this.onscreen||(this.$el.prependTo(n),this.onscreen=!0)};r.prototype.stash=function(n){this.onscreen&&(this.$el.appendTo(n),this.onscreen=!1)};r.prototype.remove=function(){this.onscreen&&(this.$el.remove(),this.onscreen=!1);this.cleanup()};r.prototype.cleanup=function(){var t=this.items,n;for(this.parent=null,h.remove(this);n=t.pop();)n.cleanup()};r.prototype.lazyload=function(n){var i=this.$el,t,r;if(!this.lazyloaded){for(t=0,r=i.length;t<r;t++)n.call(i[t],i[t]);this.lazyloaded=!0}};h=function(){var n=[];return{generatePageId:function(t){return n.push(t)-1},lookup:function(t){return n[t]||null},remove:function(t){var i=t.id;return n[i]?(n[i]=null,!0):!1}}}();u.prototype.clone=function(){var n=new u(this.$el);return n.top=this.top,n.bottom=this.bottom,n.width=this.width,n.height=this.height,n};u.prototype.remove=function(){this.$el.remove();et(this,this.parent);this.cleanup()};u.prototype.cleanup=function(){this.parent=null};e.ListView=o;e.Page=r;e.ListItem=u;k(e);e.noConflict=function(){return n.infinity=w,k(w),e}}(window,Math,jQuery);
//# sourceMappingURL=infinity.min.js.map

var comp2json=function(n){var t=LZString.decompressFromUTF16(n),i=$.parseXML(t);return $.xml2json(i)},filllistItems=function(){var t=$(".totalRequired"),i=$(".debit"),n;t.text(0);n=$("#listItems").DataTable({sDom:"<'row'<'col-sm-6'l><'col-sm-6'BTf>r>t<'row'<'col-sm-6'i><'col-sm-6'p>>",language:{url:"/Scripts/datatable/Arabic.min.js"},responsive:!0,buttons:[{extend:"csv",text:"تصدير إكسيل"},{text:"طباعة",action:function(){window.print()}}],bServerSide:!0,bRetrieve:!1,bDestroy:!0,sAjaxSource:sURL+"LoadCars?finish=1",fnServerData:function(n,t,i){dataService.callAjax("GET",t,n,function(n){var u=comp2json(n.d),f=u.list,r=u.list1,s=u.list2,e,o;r=r?$.map(r,function(n){return n}):[0];e=$.isArray(f)?f:$.makeArray(f);o={sEcho:t.sEcho?t.sEcho:0,iTotalRecords:r[0],iTotalDisplayRecords:r[0],aaData:e};i(o);updatableEvents()},errorException)},iDisplayLength:50,aaSorting:[],aoColumns:[{mData:"CarID",bSortable:!1,render:function(n,t,i){return'<a title="طباعة الفاتورة" target="_blank" href="/InvoicePrint.aspx?id='+i.SaleInvoiceID+'">'+n+"<\/a>"}},{mDataProp:"MainPicture",bSortable:!1,render:function(n,t,i){return i.MainPicture!=null?'<a data-rel="tooltip" title="سيارة رقم: '+i.CarID+'" href="/car/'+(i.CarID+"-"+i.MakerNameAr+"-"+i.TypeNameAr+"-"+i.Year).replace(/[_\W]+/g,"-")+'"><img alt="car" width="60" src="/public/cars/'+i.CarID+"/_thumb/"+i.MainPicture+'" /><\/a>':'<a href="/car/'+i.CarID+"-"+i.MakerNameAr+"-"+i.TypeNameAr+"-"+i.Year+'"><img alt="car" width="60" src="/public/cars/noimage.gif" /><\/a>'}},{mDataProp:"ChassisNo",bSortable:!1,render:function(n,t,i){return'<a data-rel="tooltip" title="عرض صور السيارة" title="عرض صور السيارة" href="/car/'+(i.CarID+"-"+i.MakerNameAr+"-"+i.TypeNameAr+"-"+i.Year).replace(/[_\W]+/g,"-")+'">'+i.MakerNameAr+" - "+i.TypeNameAr+" - "+i.Year+(i.PayInvTypeID==3?" - Relist":"")+"<\/a>"}},{mDataProp:"SalePrice",bSortable:!1,mData:function(n){var t=n.CommiDiscount*1>0?", خصم مع الفاتورة: "+numeral(n.CommiDiscount).format("0,0")+"$":"";return'<span class="red" data-rel="tooltip" title="سعر الشراء:  '+numeral(n.PayPrice).format("0,0")+"$،\nالعمولة: "+numeral(n.SalePrice-n.PayPrice).format("0,0")+"$"+t+'">'+numeral(n.SalePrice).format("0,0")+(t!==""?' <i class="fa fa-info-circle text-success"><\/i>':"")+"<\/span> "}},{mDataProp:"CarRetainer",bSortable:!1,render:function(n,t,i){return i.CarRetainer!==null?i.CarRetainerDone*1>0?'<s class="red" data-rel="tooltip"  title="تم السداد">'+numeral(i.CarRetainer).format("0,0")+"<\/s>":'<strong class="text-black pay" title="المبلغ جاهز للسداد الآن">'+numeral(i.CarRetainer).format("0,0")+"<\/strong>":""}},{mData:null,bSortable:!1,render:function(n,t,i){return i.DelayedAfterDisc!==null?i.CarDelayedDone*1>0?'<s class="red" data-rel="tooltip"  title="تم السداد">'+numeral(i.DelayedAfterDisc).format("0,0")+"<\/s>":i.Arrived!=="true"?'<strong class="text-fade" title="غير مفعل : السيارة غير واصه">'+numeral(i.DelayedAfterDisc).format("0,0")+"<\/strong>":'<strong class="text-black" title="المبلغ جاهز للسداد الآن">'+numeral(i.DelayedAfterDisc).format("0,0")+"<\/strong>":""}},{mDataProp:"TotalCarShippExpenses",bSortable:!1,render:function(n,t,i){return i.TotalCarShippExpenses!==null?i.TotalCarShippExpensesDone*1>0?'<s class="red" data-rel="tooltip"  title="تم السداد">'+numeral(i.TotalCarShippExpenses).format("0,0")+"<\/s>":'<strong class="text-black" title="المبلغ جاهز للسداد الآن">'+numeral(i.TotalCarShippExpenses).format("0,0")+"<\/strong>":"---"}},{mDataProp:"TotalCarShopExpenses",bSortable:!1,render:function(n,t,i){return i.TotalCarShopExpenses!==null?i.TotalCarShopExpensesDone*1>0?'<s class="red" data-rel="tooltip"  title="تم السداد">'+numeral(i.TotalCarShopExpenses).format("0,0")+"<\/s>":'<strong class="text-black" data-rel="tooltip" title="المبلغ جاهز للسداد الآن">'+numeral(i.TotalCarShopExpenses).format("0,0")+"<\/strong>":"---"}},{mDataProp:"VAT",bSortable:!1,mData:function(n){if(n.VAT&&n.VAT*1>0){if(n.VATDone*1>0)return'<s class="red ace-tooltip" data-rel="tooltip" title="تم السداد">'+numeral(n.VAT).format("0,0")+"<\/s> "+undoLink;var i=n.CarRetainerDone*1>0&&n.CarDelayedDone*1>0&&n.TotalCarShippExpensesDone*1>0&&n.TotalCarShopExpensesDone*1>0&&n.ClientExtraOnCarPaid*1>0,t=' <a data-rel="tooltip" data-carid="'+n.CarID+'" data-vatvalue="'+n.VAT+'" title="إلغاء VAT عن العميل" href="javascript:void(0);" class="cancel-vat"><i class="icon-remove orange bigger-120"><\/i><\/a>';return i?'<a href="javascript:void(0);" data-rel="tooltip" title="سداد الضريبة" class="pay"><strong class="text-black">'+numeral(n.VAT).format("0,0")+"<\/strong><\/a>"+t:'<strong data-rel="tooltip" title="غير مفعل للسداد: يرجي سداد كل المطلوب على السيارة أولاً.">'+numeral(n.VAT).format("0,0")+"<\/strong>"+t}return"---"}},{mData:null,bSortable:!1,render:function(n,t,i){var u=i.Arrived==="true"||i.WithoutShipping==="true",f=i.ClientDiscountOnCar*1>0?'<i data-carid="'+i.CarID+'" title="خصم: '+numeral(i.ClientDiscountOnCar).format("0,0")+'" data-rel="tooltip" data-type="-1" class="addionalAmount text-success fa fa-smile-o fa-2x"><\/i>':"",r='<i data-carid="'+i.CarID+'" title="زيادة: '+(i.ClientExtraOnCar*1>0?numeral(i.ClientExtraOnCar).format("0,0"):numeral(i.ClientExtraOnCarPaid).format("0,0"))+'" data-rel="tooltip" data-type="1" class="addionalAmount text-danger fa fa-frown-o fa-2x"><\/i> ',e=i.ClientExtraOnCar*1>0?r+(i.SaleTypeID==1||u||i.SalePriceDemand!="true"?'<a href="javascript:void(0);" class="pay payExtra inline" data-rel="tooltip" title="سداد مبلغ الزيادة"><strong class="text-black">'+numeral(i.ClientExtraOnCar).format("0,0")+"<\/strong><\/a>":""):"",o=i.ClientExtraOnCar*1==0&&i.ClientExtraOnCarPaid*1>0?r+'<s data-rel="tooltip" title="تم السداد"  class="red ace-tooltip inline">'+numeral(i.ClientExtraOnCarPaid).format("0,0")+"<\/s>":e;return f+" "+o}},{mData:null,bSortable:!1,bClass:"text-center",render:function(n,t,i){return'<a title="عرض السيارة بالموقع" href="mycarsetforsale?id='+i.CarID+'"><i class="fa fa-eye fa-2x"><\/i><\/a>'}}]});$(document).delegate("#listItems tbody tr i.addionalAmount","click",function(n){n.preventDefault();var t=$(this),u=t.attr("data-type")*1>0?"Extras":"Discounts",i="تفاصيل مبلغ الـ"+t.attr("data-original-title")+" $",r=t.attr("data-carid"),f=function(n){var i=commonManger.comp2json(n.d),r=i.list,t=0,u=$(r).map(function(n,i){return t+=parseFloat(i.ExtraAmount*1),"<tr><td>"+i.MakerNameEn+" - "+i.TypeNameEn+" - "+i.Year+"<\/td><td>"+numeral(i.ExtraAmount?i.ExtraAmount:i.DiscountAmount).format("0,0")+"<\/td><td>"+moment(i.AddDate).format("YYYY/MM/DD")+"<\/td><td>"+i.Notes+"<\/td><\/tr>"}).get();$("#lists tbody").html("").append(u);$(".total").text(t.toFixed())};r!==null&&(dto={actionName:"Client"+u+"_One",value:r},dataService.callAjax("Post",JSON.stringify(dto),sURL+"GetData",f,commonManger.errorException),$(".addtionalAmountTitle").text(i),$(".addtionalAmountDetails").text(i),$("#myAddionalAmounts").modal("show"))});searchDataTables(n)},updatableEvents=function(){$('[data-toggle="tooltip"],[data-rel=tooltip],.ace-tooltip').tooltip({delay:0}).on("hide.bs.tooltip",function(){$("div.tooltip").hide()});$(document).on("mouseleave",'[data-toggle="tooltip"],[data-rel=tooltip],.ace-tooltip',function(){$(this).tooltip("hide");$(".tooltip.fade.in").remove()})};filllistItems();
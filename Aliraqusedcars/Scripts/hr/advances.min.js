var pageManager=pageManager||{},pageManager=function(){var i=commonManger.getUrlVars(),n={id:i.id,type:i.type},u=function(){formName="formMain";tableName="Advances";pKey="ID";gridId="listItems";mainServiceUrl="hr/advances.aspx/";gridColumns=[{mDataProp:"AddDate",bSortable:!0,mData:function(n){return commonManger.formatJSONDateCal(n.AddDate)}},{mData:function(n){var t=$("#advancesTabs li.active a").data("id");return n.CheckNo?n.AdvancePayType+'، برقم: <a title="تفاصيل السند" href="Receipt'+(t===1?"Voucher":"Payments")+"Print.aspx?id="+n.CheckNo+'">'+n.CheckNo+"<\/a>":n.AdvancePayType},bSortable:!1},{mData:function(n){return n.Notes?n.Notes:""},bSortable:!1},{mData:function(n){return numeral(n.Amount).format("0,0.00")},bSortable:!1},{bSortable:!1,sClass:"center hidden-print",mData:function(n){var t=$("#advancesTabs li.active a").data("id");return n.Revised==="true"?'<i class="icon-ok green" title="تمت المراجعة"><\/i>':'<a href="Receipt'+(t===1?"Voucher":"Payments")+"Add.aspx?id="+d.CheckNo+'" class="btn btn-primary btn-mini" title="تعديل"><i class="icon-pencil"><\/i><\/a>'}}];$.extend(!0,$.fn.dataTable.defaults,{footerCallback:function(){var n=this.api(),t=n.column(3).data().reduce(function(n,t){return numeral().unformat(n)*1+numeral().unformat(t)*1},0);$(n.column(3).footer()).html(numeral(t).format("0,0.00"))}})},r=function(){var t=JSON.stringify({actionName:"Advances_Properties",names:["id","type"],values:[n.id,n.type]}),i=sUrl+"GetDataList",r=function(t){var f=commonManger.comp2json(t.d),r=f.list,i,u;r&&(i=$("#UserID"),u=$("#AdvanceTypeID"),$(r).each(function(t,r){i.append($("<option />").val(r.ID).text(r.Name));r.ID===n.id&&($(".username").text(r.Name),$(".balance").text(numeral(r.AdvancesBalance).format("0,0.00")))}),n.id>0&&(i.val(n.id).attr("disabled",!0),u.val(n.type).attr("disabled",!0)))};dataService.callAjax("Post",t,i,r,commonManger.errorException)},t=function(n,t){for(var r=0,i=0;i<t.length;i++)r+=parseFloat(t[i].Amount*1);$(".total").text(numeral(r).format("0,0"))},f=function(){$("a.receipt-in").attr("href","ReceiptVoucherAdd.aspx?loanid="+n.id+"&loantype="+n.type);$("a.receipt-out").attr("href","ReceiptPaymentsAdd.aspx?loanid="+n.id+"&loantype="+n.type);$.fn.afterLoadDatawithdata=function(t){$("#UserID").val(n.id);$("#AdvancePayTypeID").change();$("#CheckNo").val(t.CheckNo)};$.fn.afterSave=function(){r()};$("#advancesTabs li a").click(function(i){i.preventDefault();var r=$(this),u=r.data("id");r.closest("li").hasClass("active")||(u===1?(tableName="AdvanceRepays",DefaultGridManager.fillItemsDataTable(n,t)):(tableName="Advances",DefaultGridManager.fillItemsDataTable(n,t)))})},e=function(){u();f();r();DefaultGridManager.fillItemsDataTable(n,t);DefaultGridManager.Init()};return{Init:e}}();
var ShipInvoicePaymentsDetails=function(){var e=$("#ShipCompanyID"),i=$("#ContainerNo"),o="",u="",r=[],n=$("#listItems").DataTable({sDom:"<'row'>t<'row'>",searching:!1,paging:!1,sort:!1}),s=function(){h();v()},h=function(){var n=commonManger.getUrlVars();n.sh&&(u=n.sh);n.ids&&(r=n.ids.split(","));b();d()},c=function(n){var t=!0;return $("#"+n+" .required").each(function(){$(this).val()===""&&(t=!1)}),t},l=function(n){n=n.d;n.Status?(commonManger.showMessage("تم الحفظ",n.message),window.location.href="ShipInvoicePaymentsPrint.aspx?id="+n.ID):n.message.indexOf("The duplicate key value is")>0?commonManger.showMessage("خطأ بالحفظ:","رقم الحوالة الذى ادخلته موجود بالفعل فى الحوالات مع اسم شركة الصرافة، برجاء اختيار رقم حوالة آخر أو شركة صرافة أخري."):commonManger.showMessage("خطأ بالحفظ:",n.message)},a=function(){$("#ContainerNo").val("").change().trigger("chosen:updated").trigger("liszt:updated");$("#ShippPrice").val(0)},t=function(){var n=0,i=0,r={ConvertAmount:$("#Convertamount").val()*1,vat:$("#VAT").val()*1},t;$("#listItems tbody").find("tr").find("td:nth-child(3)").each(function(){n+=parseFloat($(this).text());i++});n=numeral(n).format("0.00")*1;$("#Amount").val(n);$("#lblInvoiceTotal").text(n);t=parseFloat(n)*parseFloat(1);t+=parseFloat(r.ConvertAmount)+parseFloat(r.vat);$("#AmountDhs").val((t*1).toFixed(2));$(".invoicesCount").text(i);f()},v=function(){$("#SaveAll").click(function(n){var i;if(n.preventDefault(),i=c("masterForm"),i){var u=commonManger.returnFiledsNamesToSave("detailsForm"),t="",f=0,r=[];$("#listItems tbody").find("tr").each(function(){$(this).hasClass("row_neglict")||($(this).find("td").each(function(){t+=$(this).find("span").hasClass("label-success")?"true,":$(this).find("span").hasClass("label-danger")?"false,":$(this).text()+","}),t.toLowerCase().indexOf(",")>=0&&(t=t.substring(0,t.length-1)),t.toLowerCase().indexOf("عفواً")>=0&&(t="0,,0,0"),r.push(t),t="",f++)});y("masterForm",l,u,r,"ShipInvoicePayments_Save")}else commonManger.showMessage("حقول مطلوبة:","<p>برجاء ادخال جميع الحقول الاجبارية ذات العلامة (*)<\/p><p>برجاء التحقق من مبلغ الحوالة $<\/p>")});$("#ContainerNo").on("change",function(){if($(this).val()!==""){var n={value:$(this).val()},t=function(n){var t=JSON.parse(n.d);$.each(t,function(n,t){$("#Bol").val(value=t.Bol);$("#ShippPrice").val(value=t.ShippPrice)})};dataService.callAjax("Post",JSON.stringify(n),"ShipInvoicePaymentsDetails.aspx/GetContainerNosDate",t,commonManger.errorException)}else commonManger.ResetControls("detailsForm")});e.change(function(){w($(this).val())});$("#Savetemp").on("click",function(i){var h,r,s;if(i.preventDefault(),h=$("#ContainerNo").val(),h!==""){var c=0,f=n.table().node(),u=[],e=[];for(r=0;r<f.length;r++)$(f[r]).hasClass("row_selected")&&($(f[r]).addClass("row_neglict"),$(f[r]).hide());for(u=commonManger.returnFiledsNames("detailsForm"),$("#listItems tbody").find("tr").find("td:nth-child(1)").each(function(){$(this).text()===$("#"+u[0]).val()&&(c=1)}),r=0;r<u.length;r++)u[r].substring(0,4)==="hide"?e.push("<td>hide"+$("#"+u[r]).val()+"<\/td>"):(s=$("#"+u[r]).val(),e.push("<td>"+(r>1?(s*1).toFixed():s)+"<\/td>"));e.push('<button class="btn btn-minier btn-danger remove" data-rel="tooltip" data-placement="top" data-original-title="حــذف"><i class="icon-remove"><\/i><\/button>');c!==1?(n.row.add(e).draw(!1),commonManger.showMessage("تم الحفظ بنجاح:","تمت عملية الحفظ بنجاح")):commonManger.showMessage("الفاتورة موجودة من قبل:","الفاتورة التى تود اضافتها موجود بالفعل بالحواله، يمكنك حذف الفاتورة واعادة اضافتها من جديد.");a("detailsForm");$("#PayInvoicePaymentsID").val(o);t()}else commonManger.showMessage("بيانات مطلوبة:","برجاء التحقق من مبلغ الحوالة واختيار رقم الفاتورة أولاً.")});$("#Discount").on("keyup",function(){f()});$("#VAT").on("change",function(){t();console.log("changed..")})},y=function(n,t,i,r,u){var e=commonManger.Returncontrolsval(n),o=e[0],f=e[1],s,h;o.push("Discount","DiscountReason","NetAmount");f.push($("#Discount").val(),$("#DiscountReason").val(),$("#lblNetAmount").text());s={values:f,actionName:u,Parm_names:o,fieldsDetails:i,valuesDetails:r,flage:"1"};h=function(n){commonManger.showMessage("تم الحفظ بنجاح:",n.d.message);$.fn.afterSave(f);t(n)};dataService.callAjax("Post",JSON.stringify(s),mainServiceUrl+"SaveDataMasterDetails",h,commonManger.errorException)},f=function(){var n={total:$("#lblInvoiceTotal").text()*1,discount:$("#Discount").val()*1,net:$("#lblNetAmount")},t;$.isNumeric(n.total)&&$.isNumeric(n.discount)&&(t=numeral(n.total-n.discount).format("0.0"),n.net.text(t))},p=function(u){var f=JSON.parse(u.d);i.empty().append("<option><\/option>");$.each(f,function(t,u){if(i.append("<option value='"+u.ContainerNo+"'>"+u.ContainerNo+"<\/option>"),r.length>-1){var f=jQuery.inArray(u.ShippInvoiceID.toString(),r)!==-1;f&&n.row.add([u.ContainerNo,u.Bol,u.ShippPrice,'<button class="btn btn-minier btn-danger remove" data-rel="tooltip" data-placement="top" data-original-title="حــذف"><i class="icon-remove"><\/i><\/button>']).draw()}});i.chosen().trigger("chosen:updated").trigger("liszt:updated");t()},w=function(n){n!==""?(functionName="ShipInvoicePayments_PropertiesFilter",DTO={actionName:functionName,value:n},dataService.callAjax("Post",JSON.stringify(DTO),mainServiceUrl+"GetData",p,function(){commonManger.showMessage("خطأ بالبيانات:","لقد حدث خطأ أثناء تحميل البيانات.")})):$("#ContainerNo").empty().append("<option><\/option>").chosen().trigger("chosen:updated").trigger("liszt:updated")},b=function(){var n="";$("#PayInvoicePaymentsID").val(n);var t={actionName:"ShipInvoicePayments_PropertiesDetails",value:n},i=function(n){var t=JSON.parse(n.d);$.each(t,function(n,t){t.tbl_name===1&&$("#ShipCompanyID").append("<option "+(t.ID==u?"selected='selected'":"")+" value='"+t.ID+"'>"+t.Name+"<\/option>")});$("#ShipCompanyID").change().chosen().trigger("chosen:updated").trigger("liszt:updated");$.each(t,function(n,t){t.tbl_name===2&&$("#ContainerNo").append("<option value='"+t.ID+"'>"+t.Name+"<\/option>")});$("#ContainerNo").chosen().trigger("chosen:updated").trigger("liszt:updated");$.each(t,function(n,t){t.tbl_name===150&&commonManger.getDataForUpdate(t,"masterForm")});k(t)};dataService.callAjax("Post",JSON.stringify(t),mainServiceUrl+"GetData",i,commonManger.errorException)},k=function(i){var r=[],u=[];r=commonManger.returnFiledsNames("detailsForm");$.each(i,function(t,i){if(i.tbl_name===160){for(var f=0;f<r.length;f++)r[f].substring(0,4)=="hide"?u.push("<td>hide"+i[r[f].replace("hide","")]+"<\/td>"):u.push("<td>"+i[r[f]]+"<\/td>");u.push('<button class="btn btn-minier btn-danger remove" data-rel="tooltip" data-placement="top" data-original-title="حــذف"><i class="icon-remove"><\/i><\/button>');n.row.add(u).draw(!1);u=[]}});$("#listItems tbody").find("tr").find("td").each(function(){$(this).text().substring(0,4)==="hide"&&($(this).html($(this).text().replace("hide","")),$(this).hide())});$("#listItems tbody").delegate("tr button","click",function(i){var r,e,o;if(i.preventDefault(),r=$(this),e=r.closest("tr").index(),e!==null)if(r.hasClass("edit")){commonManger.ResetControls("detailsForm");var f=commonManger.returnFiledsNames("detailsForm"),u=0;r.closest("tr").find("td").each(function(){var n=$("#"+f[u]).prop("type");n==="checkbox"?$(this).find("span").hasClass("label-success")?$("#"+f[u]).prop("checked",!0):$("#"+f[u]).prop("checked",!1):($("#"+f[u]).val($(this).text()),$("#"+f[u]).hasClass("chzn-select")&&$("#"+f[u]).chosen().trigger("chosen:updated").trigger("liszt:updated"));u++});r.closest("tr").addClass("row_selected");commonManger.enableAllFormElements("DetailsModal");commonManger.showPopUpDialog("تعديل","edit","DetailsModal")}else r.hasClass("remove")&&(o=function(){var i=n.row(r.closest("tr"));i.remove().draw();t()},DeleteConfirmation(o))})},g=function(){var n=!1;return bootbox.confirm("Are you sure?",function(t){t&&(n=t)}),n},d=function(){var n=function(n){var t=JSON.parse(n.d);$.each(t,function(n,t){$("#Convertamount").val(t.Convertamount)})};dataService.callAjax("Post",JSON.stringify({value:""}),mainServiceUrl+"GetConvetAmount",n,commonManger.errorException)};return{Init:s}}();
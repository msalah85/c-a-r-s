var CustomspaymentsDetails=CustomspaymentsDetails||{},CustomspaymentsDetails=function(){var i="",r=[],n=$("#listItems").DataTable({sDom:"<'row'>t<'row'>",searching:!1,retrieve:!0,paging:!1,sort:!1}),u=function(){s();h()},f=function(n){var t=!0;return $("#"+n+" .required").each(function(){$(this).val()===""&&(t=!1)}),t},e=function(n){n=n.d;n.Status?(commonManger.showMessage("",n.message),window.location.href="CustomsPayments.aspx?pend=1"):n.message.indexOf("The duplicate key value is")>0?commonManger.showMessage("خط بالحفظ:","رقم الحوالة الذى ادخلته موجود بالفعل فى الحوالات مع اسم شركة الصرافة، برجاء اختيار رقم حوالة آخر أو شركة صرافة أخري."):commonManger.showMessage("خط بالحفظ:",n.message)},t=function(){var i=0,n=0,t;$("#listItems tbody").find("tr").find("td:nth-child(3)").each(function(){i+=parseFloat($(this).text())});$("#masterForm #Amount,#TotalAmount").val(numeral(i).format("0"));$("#listItems tbody").find("tr").find("td:nth-child(4)").each(function(){n+=parseFloat($(this).text())});$("#lblInvoiceTotal").text(numeral(n).format("0"));t=$("#Commission").val();t=isNaN(t)?0:t*1;n=n+t;$("#AmountDhs").val(numeral(n).format("0"))},o=function(n){$("#"+n+" input").val("");$("#ContainerNo").val("");$("#"+n+" #Amount,#"+n+" #AmountDh").val(0)},s=function(){var n=commonManger.getUrlVars();n.co&&(i=n.co,$("#CustomsCompanyID").val(i));n.ids&&(r=n.ids.split(","));a();n.id&&c(n.id)},h=function(){$("#SaveAll").click(function(n){var i;if(n.preventDefault(),i=f("masterForm"),i){var u=commonManger.returnFiledsNamesToSave("detailsForm"),t="",o=0,r=[];$("#listItems tbody").find("tr").each(function(){$(this).hasClass("row_neglict")||($(this).find("td").each(function(){t+=$(this).text()+","}),t.toLowerCase().indexOf(",")>=0&&(t=t.substring(0,t.length-1)),t.toLowerCase().indexOf("عفواً")>=0&&(t="0,,0"),r.push(t),t="",o++)});commonManger.SaveDataMasterDetails("","masterForm",e,v,u,r,"Customspaymentsmaster_Save","1")}else commonManger.showMessage("حقول مطلوبة:","<p>- برجاء التأكد من مطابقة مبلغ الحوالة مع إجمالى الحاويات.<\/p><p>- برجاء ادخال جميع الحقول الاجبارية ذات العلامة (*)<\/p>")});$("#ContainerNo").on("change",function(){var n={value:$(this).val()};dataService.callAjax("Post",JSON.stringify(n),"CustomspaymentsDetails.aspx/GetDataContainer",function(n){var t=JSON.parse(n.d);$.each(t,function(n,t){$("#ContainerDate").val(t.ContainerDate);$("#detailsForm #Amount").val(numeral(t.Amount).format("0.00"));$("#detailsForm #AmountDh").val(numeral(t.AmountDh).format("0.00"))})},commonManger.errorException)});$("#Savetemp").on("click",function(i){var s,e,u,f,r,c;i.preventDefault();var l=$("#CheckNo").val(),h=$("#detailsForm #AmountDhs").val(),a=$("#ContainerNo").val();if(l!==""&&h!==""&&h!=="0"&&a!=""){for(s=0,e=n.table().node(),r=0;r<e.length;r++)$(e[r]).hasClass("row_selected")&&($(e[r]).addClass("row_neglict"),$(e[r]).hide());for(u=[],f=[],u=commonManger.returnFiledsNames("detailsForm"),$("#listItems tbody").find("tr").find("td:nth-child(1)").each(function(){$(this).text()==$("#"+u[0]).val()&&(s=1)}),r=0;r<u.length;r++)u[r].substring(0,4)=="hide"?f.push("<td>hide"+$("#"+u[r]).val()+"<\/td>"):(c=$("#"+u[r]).prop("type"),c=="checkbox"?$("#"+u[r]).prop("checked",function(n,t){t==!0?f.push('<td><span class="label label-success"><i class="icon icon-check"><\/i><\/span><\/td>'):t==!1&&f.push('<td><span class="label label-danger"><i class="icon icon-remove"><\/i><\/span><\/td>')}):f.push("<td>"+$("#"+u[r]).val()+"<\/td>"));f.push('<button class="btn btn-minier btn-danger remove" data-rel="tooltip" data-placement="top" data-original-title="حــذف"><i class="icon-remove"><\/i><\/button>');s!==1?(n.row.add(f).draw(!1),commonManger.showMessage("تم الحفظ بنجاح:","تمت عملية الحفظ بنجاح")):commonManger.showMessage("السيارة موجودة من قبل:","السيارة التى تود اضافتها موجود بالفعل بالحواله، يمكنك حذف السيارة واعادة اضافتها من جديد.");o("detailsForm");t()}else commonManger.showMessage("بيانات مطلوبة:","برجاء التأكد من رقم الشيك ومبلغ الحوالة واختيار رقم الحاوية أولاً."),$("#masterForm #AmountDhs").focus()});$("#Commission").on("keyup",function(){t()});$("#listItems tbody").delegate("tr button.remove","click",function(i){i.preventDefault();var r=$(this),u=r.closest("tr").index();u!=null&&DeleteConfirmation(function(){var i=n.row($(this).parents("tr")),r=i.data()[0];$("#ContainerNo").find("option").each(function(){this.value==r&&(this.disabled=!1)});i.remove().draw();t()})})},c=function(n){var i={actionName:"CustomsPaymentsMaster_Print",names:["pkId"],values:[n]},r=function(n){var i=commonManger.comp2json(n.d),r=i.list,u=i.list1,f;r&&$.each(r,function(n,t){var i=$("#"+n);i.hasClass("money")?i.val(numeral(t).format("0.0")):i.val(t)});u&&(f=$(u).map(function(n,t){return"<tr><td>"+t.ContainerNo+"<\/td><td>"+commonManger.dateFormat(t.InvoiceDate)+"<\/td><td>"+numeral(t.Amount).format("0.00")+"<\/td><td>"+numeral(t.AmountDh).format("0.00")+"<\/td><td><\/td><\/tr>"}).get(),$("#listItems tbody").html(f),$("#detailsForm").addClass("hidden"),t())};dataService.callAjax("Post",JSON.stringify(i),sUrl+"GetDataList",r,commonManger.errorException)},l=function(i){var f=commonManger.comp2json(i.d),e=f.list,u="";$(e).each(function(t,i){if(r.length>-1){var t=jQuery.inArray(i.CustomsInvoiceID.toString(),r)!==-1;t?(n.row.add([i.ContainerNo,i.InvoiceNo,numeral(i.TotalAmount).format("0.00"),numeral(i.TotalAmountDhs).format("0.00"),'<button class="btn btn-minier btn-danger remove" data-rel="tooltip" title="حــذف"><i class="icon-remove"><\/i><\/button>']).draw(),u+='<option disabled value="'+i.ContainerNo+'">'+i.ContainerNo+"<\/option>"):u+='<option value="'+i.ContainerNo+'">'+i.ContainerNo+"<\/option>"}});t();$("#ContainerNo").append(u)},a=function(){var n=[i],t={actionName:"Customspaymentsmaster_PropertiesDetails",names:["pkId"],values:n};dataService.callAjax("Post",JSON.stringify(t),sUrl+"GetDataList",l,commonManger.errorException)},y=function(n){var t={actionName:"Customspaymentsmaster_ContainerByDist",value:n};dataService.callAjax("Post",JSON.stringify(t),mainServiceUrl+"GetData",function(n){var t=JSON.parse(n.d);$.each(t,function(n,t){t.tbl_name==1&&$("#ContainerNo").append("<option value='"+t.ID+"'>"+t.Name+"<\/option>")})},commonManger.errorException)},p=function(t){var i=[],r=[];i=commonManger.returnFiledsNames("detailsForm");$.each(t,function(t,u){var f,e;if(u.tbl_name=="160"){for(f=0;f<i.length;f++)i[f].substring(0,4)=="hide"?r.push("<td>hide"+u[i[f].replace("hide","")]+"<\/td>"):(e=$("#"+i[f]).prop("type"),e=="checkbox"?u[i[f]]==!0?r.push('<td><span class="label label-success"><i class="fa fa-check"><\/i><\/span><\/td>'):u[i[f]]==!1&&r.push('<td><span class="label label-danger"><i class="fa fa-remove"><\/i><\/span><\/td>'):r.push("<td>"+u[i[f]]+"<\/td>"));r.push('<button class="btn btn-minier btn-danger remove" data-rel="tooltip" data-placement="top" data-original-title="حــذف"><i class="icon-remove"><\/i><\/button>');n.row.add(r).draw(!1);r=[]}});$("#listItems tbody").find("tr").find("td").each(function(){$(this).text().substring(0,4)=="hide"&&($(this).html($(this).text().replace("hide","")),$(this).hide())})},v=function(n,t,i){title=t+": "+i;message=JSON.parse(n.responseText).Message;commonManger.showMessage(title,message)};return{Init:u}}();
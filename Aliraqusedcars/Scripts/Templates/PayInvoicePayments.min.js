var PayInvoicePayments=PayInvoicePayments||{},PayInvoicePayments=function(){var t=null,i=null,r=null,u=null,n=0,e=function(){a();l();h();o()},o=function(){$("#SearchAll").click(function(n){n.preventDefault();t=$("#Buyer").val();i=$("#ExchangeCompanyID").val();r=commonManger.dateFormat($("#From").val());u=commonManger.dateFormat($("#To").val());f()});$(".bntCancelInvoice").click(function(n){n.preventDefault();var t={id:$("#PayInvoicePaymentsID").val(),reason:$("#deleteReason").val()},i={actionName:"PayInvoicePayments_Delete",names:["ID","Reason"],values:[t.id,t.reason],setUserIP:!0};t.id!=""&&t.reason!=""?dataService.callAjax("Post",JSON.stringify(i),sUrl+"saveDataByUser",s,commonManger.errorException):(commonManger.showMessage("بيانات مطلوبة:","يرجي ادخال سبب الحذف، والتأكد من كود الحوالة.."),$("#deleteReason").focus())})},s=function(n){n=n.d;n.Status?(f(),$(".modal").modal("hide"),commonManger.showMessage("تم الحذف بنجاح:","تم حذف البيان بنجاح.")):commonManger.showMessage("خطأ بالحذف:","لقد حدث خطأ أثناء الحذف: "+n.message)},h=function(){n=commonManger.getQueryStrs().pend;n>0&&($(".title").text("عرض حوالات الشراء قيد الدفع"),$(".table-header").css({"border-color":"#666",background:"#404040"}))},c=function(n){var t=commonManger.comp2json(n.d),i=t.list,r=t.list1;i&&$("#ExchangeCompanyID").append($.map(i,function(n){return $("<option />").text(n.Name).val(n.ID)}));r&&$("#Buyer").append($.map(r,function(n){return $("<option />").text(n.BuyerName).val(n.BuyerName)}));$(".chzn-select").trigger("chosen:updated").trigger("liszt:updated")},l=function(){dataService.callAjax("Post",JSON.stringify({actionName:"PayInvoicePayments_Properties"}),sUrl+"GetDataDirect",c,commonManger.errorException)},f=function(){$("#listItems").DataTable().draw()},a=function(){n=commonManger.getQueryStrs().pend;n=n>0?1:0;var f=$("#listItems").DataTable({sDom:"<'row-fluid'<'span6'l><'span6 lft-pane'BT>r>t<'row-fluid'<'span6'i><'span6'p>>",buttons:[{extend:"csv",text:"تصدير إكسيل"},{extend:"copy",text:"نسـخ"},{text:"طباعة",action:function(){$(".dataTables_length,.form-horizontal").closest("div.row-fluid").addClass("hidden-print");window.print()}}],bServerSide:!0,bRetrieve:!1,bDestroy:!0,sAjaxSource:"PayInvoicePayments.aspx/GetPayInvoicePayments",fnServerData:function(n,t,i){dataService.callAjax("GET",t,n,function(n){commonManger.setData2Grid(n,t.sEcho,i)},commonManger.errorException)},fnServerParams:function(f){f.push({name:"ExchangeCompanyID",value:i},{name:"Buyer",value:t},{name:"From",value:r},{name:"To",value:u},{name:"Pend",value:n})},footerCallback:function(){var n=this.api(),t=n.column(6).data().reduce(function(n,t){return numeral().unformat(n)+numeral().unformat(t)},0);$(n.column(6).footer()).html(numeral(t).format("0,0.00"))},iDisplayLength:50,aaSorting:[],aoColumns:[{mDataProp:"PayInvoicePaymentsID",bSortable:!0},{mData:function(n){return commonManger.dateFormat(n.PaymentsDates,"YYYY/M/D","DD/MM/YYYY")},bSortable:!0},{mDataProp:"ExchangeCompanyNameAr",bSortable:!0,mData:function(n){return n.CheckNo?n.ExchangeCompanyNameAr?n.ExchangeCompanyNameAr:'<a href="payinvoicepaymentsprint.aspx?id='+n.PayInvoicePaymentsID+'&review=1">تصفير الحوالة<\/a>':'<a href="payinvoicepaymentspendingprint.aspx">سند صرف<\/a>'}},{mDataProp:"AuctionNameAr",bSortable:!0},{mDataProp:"BuyerName",bSortable:!0},{mData:"Notes",bSortable:!1},{mDataProp:"TotalAmount",bSortable:!1,mData:function(n){return numeral(n.TotalAmount).format("0,0.00")}},{bSortable:!1,mData:function(n){return'<a href="PayInvoicePaymentsPrint.aspx?id='+n.PayInvoicePaymentsID+'" class="btn btn-mini" data-rel="tooltip" title="طباعة"><i class="icon-print"><\/i><\/a>'+(n.CheckNo?"":' <a href="PayInvoicePaymentDetails.aspx?id='+n.PayInvoicePaymentsID+'" class="btn btn-mini btn-info" data-rel="tooltip" title="تعديل"><i class="icon-edit"><\/i><\/a>')+(n.ExchangeCompanyNameAr?"":' <button class="btn btn-mini btn-danger remove" data-rel="tooltip" data-placement="top" title="حــذف"><i class="icon-remove icon-only"><\/i><\/button>')}}]});$("#listItems tbody").delegate("tr button.remove","click",function(n){n.preventDefault();var r=$(this),i=r.closest("tr"),t;i!=null&&(t=f.row(i).data(),$('#cancelForm textarea, #cancelForm input[type="text"]').val(""),$("#PayInvoicePaymentsID").val(t.PayInvoicePaymentsID),$("#buyer").val(t.BuyerName),$("#auction").val(t.AuctionNameAr),$("#cancelModal").modal("show"))})};return{Init:e}}();
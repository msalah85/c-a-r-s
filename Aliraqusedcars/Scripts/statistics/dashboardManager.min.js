var dashboardManager=function(){var t=[],i=[],u="#shippers-charts",n=$(u),o=function(){r()},f=function(n){var t=new Date(parseInt(n)),i=t.getMonth()+1,r=t.getFullYear();return i+"-"+r},s=function(t){var r=commonManger.comp2json(t.d),i=r.list;n.data("chart-main-data",JSON.stringify(i));e(i)},e=function(t,i){var e=$(".YearMonth").val(),f=_.groupBy(t,"ShipCompanyNameEn"),r=[],u=[];$.each(f,function(n,t){r.push({label:n,data:$.map(t,function(n){var t=[];return t.push([moment((n.InvMonth||1)+"/"+n.InvYear,"MM/YYYY").valueOf(),i==="of"?n.ShipAvg:n.LoadAvg]),t})});u.push({label:n,data:t.reduce(function(n,t){return n*1+t.InvCount*1},0)})});n.data("json",r);h();l(u)},h=function(){function e(){var n=[];t.find("input:checked").each(function(){var t=$(this).attr("name");t&&i[t]&&n.push(i[t])});n.length>0&&o(n)}var s=n.css({width:"100%",height:"270px"}),i=n.data("json"),r=$(".YearMonth").val(),o=function(n){$.plot(u,n,{shadowSize:0,series:{lines:{show:!0},points:{show:!0},label:{show:!0}},legend:{noColumns:4,position:"se",margin:[0,-99]},xaxes:[{mode:"time",minTickSize:[1,r?r:"month"]}],grid:{backgroundColor:{colors:["#fff","#fff"]},borderWidth:1,borderColor:"#d9d9d9",clickable:!0,hoverable:!0},selection:{mode:"x"}})},f=0,t;$.each(i,function(n,t){t.color=f;++f});t=$("#choices");t.html("");$.each(i,function(n,i){t.append(`<label for='id${n}' class="inline">
                                                <input type='checkbox' name='${n}' ${n<3?"checked":""} id='id${n}' />
                                                <span class="lbl">${i.label}</span></label>`)});t.find("input").click(e);e();c()},c=function(){var o=$("<div class='tooltip top in hide'><div class='tooltip-inner'><\/div><\/div>").appendTo("body"),s=null,u=$(".Year"),c=$(".YearMonth"),h;$(".ExpTypes").change(function(){var i=$(this),r=i.val(),t=n.data("chart-main-data");t=t.length?JSON.parse(t):[];e(t,r)});c.change(function(){var f=$(this),n=f.val();u.prop("disabled",!0);t=i=[];n==="month"?(u.prop("disabled",!1),t=["ChartType","Year"],i=[n,u.val()]):(t=["ChartType"],i=[n]);r()});u.change(function(){var n=$(this),f=n.val();f*1>0&&(t=["ChartType","Year"],i=[c.val(),u.val()]);r()});n.on("plothover",function(n,t,i){var r,u,e;i?(r=i.datapoint[0].toFixed(2),u=i.datapoint[1].toFixed(2),s!=i.seriesIndex&&(s=i.seriesIndex,r=r.split(".")[0],r=f(r),e=`${i.series.label} in: ${r} = ${u}$`,o.show().children(0).text(e)),o.css({top:t.pageY+10,left:t.pageX+10})):(o.hide(),s=null)});if(n.bind("plotclick",function(n,t,i){if(i){var r=i.datapoint[0].toFixed(2),u=i.datapoint[1].toFixed(2),r=r.split(".")[0],r=f(r);tip=`${i.series.label} in: ${r} = ${u}$`;alert(tip)}}),h=navigator.userAgent.toLowerCase(),"ontouchstart"in document&&/applewebkit/.test(h)&&/android/.test(h))$("#tasks").on("touchstart",function(n){var i=$(n.target).closest("#tasks li"),t;i.length!=0&&(t=i.find("label.inline").get(0),(t==n.target||$.contains(t,n.target))&&n.stopImmediatePropagation())})},r=function(){var n={actionName:"HomeShipperExpStatistics",names:t,values:i};dataService.callAjax("Post",JSON.stringify(n),sUrl+"GetDataList",s,commonManger.errorException)},a=function(n,t){return"<div style='font-size:8pt; text-align:center; padding:2px; color:white;'>"+n+"<br/>"+Math.round(t.percent)+"%<\/div>"},l=function(n){var r=".shippers-counts-charts",u=$(r).css({width:"100%",height:"350px"}),t,i;$.plot(r,n,{series:{pie:{tilt:.8,highlight:{opacity:.25},startAngle:2,innerRadius:.5,show:!0,radius:1,stroke:{color:"#fff",width:2}}},legend:{show:!0},grid:{hoverable:!0,clickable:!0}});t=$("<div class='tooltip top in hide'><div class='tooltip-inner'><\/div><\/div>").appendTo("body");i=null;u.on("plothover",function(n,r,u){if(u){if(i!=u.seriesIndex){i=u.seriesIndex;var f=u.series.label+" : "+parseFloat(u.series.percent).toFixed(1)+"%  => #"+u.series.data[0][1];t.show().children(0).text(f)}t.css({top:r.pageY+10,left:r.pageX+10})}else t.hide(),i=null})};return{Init:o}}();dashboardManager.Init();